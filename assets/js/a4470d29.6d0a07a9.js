"use strict";(self.webpackChunkk_8_s_god=self.webpackChunkk_8_s_god||[]).push([[4164],{28453:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>r});var t=s(96540);const l={},p=t.createContext(l);function i(n){const e=t.useContext(p);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:i(n.components),t.createElement(p.Provider,{value:e},n.children)}},45573:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>r,default:()=>o,frontMatter:()=>i,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"dpdk/nxp\u8fd0\u884cvpp","title":"nxp\u8fd0\u884cvpp","description":"\u521d\u6b21\u8fd0\u884c","source":"@site/docs/dpdk/nxp\u8fd0\u884cvpp.md","sourceDirName":"dpdk","slug":"/dpdk/nxp\u8fd0\u884cvpp","permalink":"/blog/docs/dpdk/nxp\u8fd0\u884cvpp","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/dpdk/nxp\u8fd0\u884cvpp.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nxp\u6d4b\u8bd5\u62a5\u544a","permalink":"/blog/docs/dpdk/nxp\u6d4b\u8bd5\u62a5\u544a"},"next":{"title":"pktgen","permalink":"/blog/docs/dpdk/pktgen"}}');var l=s(74848),p=s(28453);const i={},r="nxp\u8fd0\u884cvpp",d={},a=[{value:"\u521d\u6b21\u8fd0\u884c",id:"\u521d\u6b21\u8fd0\u884c",level:2},{value:"vpp\u914d\u7f6e",id:"vpp\u914d\u7f6e",level:3},{value:"\u8c03\u8bd5",id:"\u8c03\u8bd5",level:3},{value:"\u6293\u5305",id:"\u6293\u5305",level:4},{value:"\u542f\u52a8\u65f6\u4e22\u5305",id:"\u542f\u52a8\u65f6\u4e22\u5305",level:4},{value:"\u539f\u56e0",id:"\u539f\u56e0",level:4},{value:"\u65e0\u56de\u8c03",id:"\u65e0\u56de\u8c03",level:5},{value:"\u6709\u56de\u8c03",id:"\u6709\u56de\u8c03",level:5}];function c(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,p.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"nxp\u8fd0\u884cvpp",children:"nxp\u8fd0\u884cvpp"})}),"\n",(0,l.jsx)(e.h2,{id:"\u521d\u6b21\u8fd0\u884c",children:"\u521d\u6b21\u8fd0\u884c"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e0d\u5e26dpdk"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"./vpp[1276]: clib_elf_parse_file: open `linux-vdso.so.1': No such file or directory\nFASTGTPU_STUB_ENABLE unset (null)!!\nuse spin_lock to access mbuf share memory!\nBH: SHMA(/tmp/bh0.shma) created: key 0x00162c1b shmid 2\nBH: SHMA(/tmp/bh0.shma.m) created: key 0x00162c1d shmid 3\nset fastgtpu_speed affinity with core[0]\n#BH Warn: cpuid[27] is too large, should smaller than 16 on this system!\ncuup_timer: Waring: sched_setaffinity failed.\nSet cuup_timer affinity with core[27]\nBH: SHMA(/tmp/rlc1.shma) created: key 0x00162c27 shmid 4\nBH: SHMA(/tmp/rlc1.shma.m) created: key 0x00162c29 shmid 5\nregister gtpu send callback = 0xffff7d926a68 successful!\nMeta is Available!\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: nat_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: lb_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: lacp_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: mactime_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: nsim_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: stn_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: avf_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: acl_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: nsh_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: cdp_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: memif_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: pppoe_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: ioam_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: gtpu_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: flowprobe_test_plugin.so\n./vpp[1276]: load_one_vat_plugin:67: Loaded plugin: vmxnet3_test_plugin.so\nBH: Set cuup_dispatcher affinity with Core[0]\nBH: Set bh-worker0 affinity with Core[15]\n2021/07/06 UTC 04:45:10.876997 cuup[1276] ERROR 0 sendto() failed 2 (No such file or directory)\n./vpp[1276]: CRITICAL 0 odsServer.cc:120 sendto() failed 2 (No such file or directory)\ncuup_timer is successful!\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u8fd0\u884c\u6210\u529f\uff0c\u4f46\u5b58\u5728\u5982\u4e0b\u62a5\u9519\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"BH Warn: cpuid[27] is too large, should smaller than 16 on this system!"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u76ee\u524d\u6682\u4e0d\u6e05\u695a\u8be5\u65e5\u5fd7\u7531\u4f55\u5904\u6253\u5370"}),"\n",(0,l.jsxs)(e.ol,{start:"2",children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"cuup_timer: Waring: sched_setaffinity failed."}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"2021/07/06 UTC 04:45:10.876997 cuup[1276] ERROR 0 sendto() failed 2 (No such file or directory)"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"./vpp[1276]: CRITICAL 0 odsServer.cc:120 sendto() failed 2 (No such file or directory)"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5e26dpdk"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"nxp\u677f\u5b50\u9ed8\u8ba4\u914d\u7f6e\u4e86\u56db\u4e2a\u5c3a\u5bf8\u7684\u5927\u9875\uff0c\u4f46vpp\u8fd0\u884c\u52a0\u8f7ddpdk\u63d2\u4ef6\u65f6\uff0c\u6700\u591a\u652f\u6301\u8bfb\u53d6\u4e09\u4e2a\u5c3a\u5bf8\u7684\u5927\u9875\uff0c\u5bfc\u81f4\u5728nxp\u677f\u5b50\u4e0a\u8fd0\u884c\u652f\u6301dpdk\u63d2\u4ef6\u7684vpp\u542f\u52a8\u5931\u8d25\uff0c\u65e0\u6cd5\u83b7\u53d6\u5230\u5927\u9875\u5185\u5b58\u4fe1\u606f\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u89e3\u51b3\u65b9\u6cd5\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u4fee\u6539dpdk\u6e90\u7801\uff0c\u53d6\u6d88\u53ea\u8bfb\u53d6\u4e09\u4e2a\u5c3a\u5bf8\u5927\u9875\u7684\u9650\u5236\uff0c\u5177\u4f53\u4e3a\u4fee\u6539lib/librte_eal/common/eal_internal_cfg.h"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"#define MAX_HUGEPAGE_SIZES 3  /**< support up to 3 page sizes */\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5c06\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u76843\u4fee\u6539\u4e3a\u5927\u4e8e3\u7684\u503c\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"vpp\u914d\u7f6e",children:"vpp\u914d\u7f6e"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u73af\u5883\u8bbe\u7f6e"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"dpdk\u8d44\u6e90\u914d\u7f6e"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"default"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"root@HX-Technical-A:~/tools# restool dprc show dprc.2\ndprc.2 contains 25 objects:\nobject          label           plugged-state\ndpni.4                          plugged\ndpbp.7                          plugged\ndpbp.6                          plugged\ndpbp.5                          plugged\ndpbp.4                          plugged\ndpci.1                          plugged\ndpci.0                          plugged\ndpseci.8                        plugged\ndpseci.7                        plugged\ndpseci.6                        plugged\ndpseci.5                        plugged\ndpseci.4                        plugged\ndpseci.3                        plugged\ndpseci.2                        plugged\ndpseci.1                        plugged\ndpdmai.1                        plugged\ndpdmai.0                        plugged\ndpmcp.39                        plugged\ndpio.19                         plugged\ndpio.18                         plugged\ndpio.17                         plugged\ndpio.16                         plugged\ndpcon.66                        plugged\ndpcon.65                        plugged\ndpcon.64                        plugged\n\nexport DPCON_COUNT=3\nexport DPBP_COUNT=4\nexport DPMCP_COUNT=1\nexport DPSECI_COUNT=8\nexport DPIO_COUNT=4\nexport DPCI_COUNT=2\nexport DPDMAI_COUNT=2\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"export ROOT_DPRC=dprc.1\nexport PARENT_DPRC=dprc.2\n\nexport DPCON_COUNT=3\nexport DPBP_COUNT=4\nexport DPMCP_COUNT=1\nexport DPSECI_COUNT=8\nexport DPIO_COUNT=4\nexport DPCI_COUNT=2\nexport DPDMAI_COUNT=2\necho 1024 > /proc/sys/vm/nr_hugepages\necho 0 > /proc/sys/vm/swappiness\nexport DPRC=dprc.2\n"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"vpp \u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"#!/bin/bash\n#rm -rf /mnt/hugepages\n#mkdir -p /mnt/hugepages\n#mount -t hugetlbfs none /mnt/hugepages\necho 6 > /proc/sys/vm/nr_hugepages\necho 0 > /proc/sys/vm/swappiness\nexport LD_LIBRARY_PATH=/root/vpp/lib\nexport PATH=/root/vpp/bin:$PATH\ngroupadd -f -r vpp\n"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"startup.conf"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"heapsize 256M\nplugin_path /root/vpp/lib/vpp_plugins\n\nunix {\n  interactive\n  #nodaemon\n  gid vpp\n  log /tmp/vpp.log\n  full-coredump\n  cli-listen /run/vpp/cli.sock\n  #startup-config /etc/vpp/interface.txt\n}\n\napi-trace {\n  on\n}\n\napi-segment {\n  gid vpp\n}\n\nsession {\n  evt_qs_memfd_seg\n}\n\nsocksvr {\n  socket-name /tmp/vpp-api.sock\n}\n\ncpu {\n\tmain-core 1\n\tcorelist-workers 3\n}\n\ndpdk {\n        ## Change default settings for all intefaces\n        huge-dir /mnt/hugepages\n        no-pci\n        num-mem-channels 1\n         dev default {\n                ## Number of receive queues, enables RSS\n                ## Default is 1\n                num-rx-queues 1\n\t\t\t\tnum-rx-desc 8912\n                # rss { ipv4 }\n\n                ## Number of transmit queues, Default is equal\n                ## to number of worker threads or 1 if no workers treads\n                num-tx-queues 1\n\t}\n\tproc-type primary\n        #log-level  8\n}\n\nplugins {\n        ## Adjusting the plugin path depending on where the VPP plugins are\n        path /root/vpp/lib/vpp_plugins\n        vat-path /root/vpp/lib/vpp_api_test_plugins\n\n        plugin default { enable }\n        plugin gtpu_plugin.so { disable }\n        #plugin fastgtpu_plugin.so { disable }\n\n}\n"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"interface.txt"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u8f6c\u53d1"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"set int state TenGigabitEthernet0 up\nset int ip address TenGigabitEthernet0 192.168.8.24/24\nset int ip address TenGigabitEthernet0 192.168.9.24/24\nset interface mac address TenGigabitEthernet0 42:4b:54:ae:6e:05\nset int mtu 1500 TenGigabitEthernet0\nset ip arp static TenGigabitEthernet0 192.168.8.25 90:e2:ba:8d:02:f0\n"})}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"libup"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"netmask 16"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"set int state TenGigabitEthernet0 up\nset int ip address TenGigabitEthernet0 192.168.8.25/16\nset interface mac address TenGigabitEthernet0 42:4b:54:ae:6e:05\nset int mtu 1500 TenGigabitEthernet0\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)("font",{color:"red",children:"\u4f7f\u7528fastup\u65f6\uff08\u52a0\u8f7dfastgtpu\u63d2\u4ef6\uff09\uff0c\u9700\u8981\u6ce8\u610fip\u5e94\u5728\u540c\u4e00\u7f51\u7edc\u4e2d\u4ee5\u4fdd\u8bc1\u8054\u901a\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5982\u4f7f\u7528pktgen\u8fdb\u884c\u62a5\u6587\u56de\u653e\u65f6\uff0c\u56e0\u62a5\u6587\u4e2d\u6e90ip\u4e3a192.168.9.243\uff0c\u76ee\u7684ip\u4e3a192.168.8.25\uff0c\u4e3a\u4fdd\u8bc1\u7f51\u7edc\u8054\u901a\uff0c\u5728vpp\u4fa7\u8bbe\u7f6eIP\u65f6\u5e94\u5c06\u5b50\u7f51\u63a9\u7801\u8bbe\u7f6e\u4e3a16\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u8c03\u8bd5",children:"\u8c03\u8bd5"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"# \u4ecedpdk-input\u8ddf\u8e2a1\u4e2a\u62a5\u6587\u7684\u8f68\u8ff9\ntrace add dpdk-input 1\n# \u5c55\u793a\u8868\u683c\nshow trace\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"00:02:51:352581: dpdk-input\n  TenGigabitEthernet0 rx queue 0\n  buffer 0x9be79: current data 0, length 1486, free-list 0, clone-count 0, totlen-nifb 0, trace 0x0\n                  ext-hdr-valid\n                  l4-cksum-computed l4-cksum-correct\n  PKT MBUF: port 0, nb_segs 1, pkt_len 1486\n    buf_len 2176, data_len 1486, ol_flags 0x2, data_off 128, phys_addr 0x9d4f9ec0\n    packet_type 0x611 l2_len 0 l3_len 0 outer_l2_len 0 outer_l3_len 0\n    rss 0xcb1c70c9 fdir.hi 0x0 fdir.lo 0xcb1c70c9\n    Packet Offload Flags\n      PKT_RX_RSS_HASH (0x0002) RX packet with RSS hash result\n    Packet Types\n      RTE_PTYPE_L2_ETHER (0x0001) Ethernet packet\n      RTE_PTYPE_L3_IPV4 (0x0010) IPv4 packet without extension headers\n      RTE_PTYPE_L4_NONFRAG (0x0600) Non-fragmented IP packet\n  IP4: 90:e2:ba:8d:02:f0 -> 42:4b:54:ae:6e:05\n  UDP: 192.168.9.243 -> 192.168.8.25\n    tos 0x00, ttl 64, length 1472, checksum 0xf304\n    fragment id 0xaecb, flags DONT_FRAGMENT\n  UDP: 2152 -> 2152\n    length 1452, checksum 0x991a\n00:02:51:352606: ethernet-input\n  frame: flags 0x3, hw-if-index 1, sw-if-index 1\n  IP4: 90:e2:ba:8d:02:f0 -> 42:4b:54:ae:6e:05\n00:02:51:352614: ip4-input-no-checksum\n  UDP: 192.168.9.243 -> 192.168.8.25\n    tos 0x00, ttl 64, length 1472, checksum 0xf304\n    fragment id 0xaecb, flags DONT_FRAGMENT\n  UDP: 2152 -> 2152\n    length 1452, checksum 0x991a\n00:02:51:352623: ip4-lookup\n  fib 0 dpo-idx 5 flow hash: 0x00000000\n  UDP: 192.168.9.243 -> 192.168.8.25\n    tos 0x00, ttl 64, length 1472, checksum 0xf304\n    fragment id 0xaecb, flags DONT_FRAGMENT\n  UDP: 2152 -> 2152\n    length 1452, checksum 0x991a\n00:02:51:352629: ip4-local\n    UDP: 192.168.9.243 -> 192.168.8.25\n      tos 0x00, ttl 64, length 1472, checksum 0xf304\n fragment id 0xaecb, flags DONT_FRAGMENT\n    UDP: 2152 -> 2152\n      length 1452, checksum 0x991a\n00:02:51:352635: ip4-drop\n    UDP: 192.168.9.243 -> 192.168.8.25\n      tos 0x00, ttl 64, length 1472, checksum 0xf304\n      fragment id 0xaecb, flags DONT_FRAGMENT\n    UDP: 2152 -> 2152\n      length 1452, checksum 0x991a\n00:02:51:352641: error-drop\n  ip4-input: ip4 source lookup miss\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"vpp -localExtGnbNgUpAddr 192.168.8.25  -pdcpCoreIpAddress 192.0.2.2 -cellNumber 1 -l2IpAddress1 192.0.2.10 -loglevel 6 -log_max_num 10 -c  /etc/vpp/startup.conf\n\n------------------- Start of thread 0 vpp_main -------------------\nPacket 1\n\n00:00:50:840492: dpdk-input\n  TenGigabitEthernet0 rx queue 0\n  buffer 0x9c04d: current data 0, length 1486, free-list 0, clone-count 0, totlen-nifb 0, trace 0x0\n                  ext-hdr-valid\n                  l4-cksum-computed l4-cksum-correct\n  PKT MBUF: port 0, nb_segs 1, pkt_len 1486\n    buf_len 2176, data_len 1486, ol_flags 0x2, data_off 128, phys_addr 0xa63013c0\n    packet_type 0x611 l2_len 0 l3_len 0 outer_l2_len 0 outer_l3_len 0\n    rss 0xcb1c70c9 fdir.hi 0x0 fdir.lo 0xcb1c70c9\n    Packet Offload Flags\n      PKT_RX_RSS_HASH (0x0002) RX packet with RSS hash result\n    Packet Types\n      RTE_PTYPE_L2_ETHER (0x0001) Ethernet packet\n      RTE_PTYPE_L3_IPV4 (0x0010) IPv4 packet without extension headers\n      RTE_PTYPE_L4_NONFRAG (0x0600) Non-fragmented IP packet\n  IP4: 90:e2:ba:8d:02:f0 -> 42:4b:54:ae:6e:05\n  UDP: 192.168.9.243 -> 192.168.8.25\n    tos 0x00, ttl 64, length 1472, checksum 0xef41\n    fragment id 0xb28e, flags DONT_FRAGMENT\n  UDP: 2152 -> 2152\n    length 1452, checksum 0x991a\n00:00:50:840508: ethernet-input\n  frame: flags 0x3, hw-if-index 1, sw-if-index 1\n  IP4: 90:e2:ba:8d:02:f0 -> 42:4b:54:ae:6e:05\n00:00:50:840521: ip4-input-no-checksum\n  UDP: 192.168.9.243 -> 192.168.8.25\n    tos 0x00, ttl 64, length 1472, checksum 0xef41\n    fragment id 0xb28e, flags DONT_FRAGMENT\n  UDP: 2152 -> 2152\n    length 1452, checksum 0x991a\n00:00:50:840533: ip4-lookup\n  fib 0 dpo-idx 5 flow hash: 0x00000000\n  UDP: 192.168.9.243 -> 192.168.8.25\n    tos 0x00, ttl 64, length 1472, checksum 0xef41\n    fragment id 0xb28e, flags DONT_FRAGMENT\n  UDP: 2152 -> 2152\n    length 1452, checksum 0x991a\n00:00:50:840549: ip4-local\n    UDP: 192.168.9.243 -> 192.168.8.25\n      tos 0x00, ttl 64, length 1472, checksum 0xef41\n      fragment id 0xb28e, flags DONT_FRAGMENT\n    UDP: 2152 -> 2152\n      length 1452, checksum 0x991a\n00:00:50:840554: ip4-drop\n    UDP: 192.168.9.243 -> 192.168.8.25\n      tos 0x00, ttl 64, length 1472, checksum 0xef41\n      fragment id 0xb28e, flags DONT_FRAGMENT\n    UDP: 2152 -> 2152\n      length 1452, checksum 0x991a\n00:00:50:840561: error-drop\n  ip4-input: ip4 source lookup miss\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u6293\u5305",children:"\u6293\u5305"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:" # \u6293\u5305\npcap tx trace status\npcap tx trace on max 1000 intfc TenGigabitEthernet0 file vppTest.pcap\npcap tx trace status\npcap tx trace off\n   # \u5199\u5165\u7684\u4f4d\u7f6e\u4f4d\u4e8e/tmp\uff0c\u4e0d\u80fd\u6307\u5b9a\u6587\u4ef6\u5939\uff0c\u65e7\u7684\u4f1a\u88ab\u65b0\u7684\u540c\u540d\u6587\u4ef6\u8986\u76d6\u3002pcap dispatch trace off\u540epcap\u5305\u5c06\u622a\u6b62\u3002\u5305\u6587\u4ef6\u4e3avppcapture\npcap rx trace status\npcap rx trace on max 1000 intfc TenGigabitEthernet0 file vppTest.pcap\npcap rx trace status\npcap rx trace off\n"})}),"\n",(0,l.jsx)(e.h4,{id:"\u542f\u52a8\u65f6\u4e22\u5305",children:"\u542f\u52a8\u65f6\u4e22\u5305"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"\n    tx frames ok                                     2423618\n    tx bytes ok                                   3601496348\n    rx frames ok                                     2423623\n    rx bytes ok                                   3601496898\n    rx errors                                            126\n    extended stats:\n      rx good packets                                2423623\n      tx good packets                                2423618\n      rx good bytes                               3601496898\n      tx good bytes                               3601496348\n      rx errors                                          126\n      rx q0packets                                   2423618\n      rx q1packets                                         5\n      tx q0packets                                   2423618\n      ingress multicast frames                             5\n      ingress multicast bytes                            550\n      ingress discarded frames                           126\n      cgr reject frames                                  126\n      cgr reject bytes                                187236\n\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u4e22\u5305\u5728rx-errors\uff0c\u8fdb\u4e00\u6b65\u5b9a\u4f4d\u4e22\u5305\u5728dpdk\u7684ierror\u662f\u3002"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4f7f\u7528dpdk\u8fdb\u884c\u8f6c\u53d1\u65e0\u4e22\u5305","\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8bf4\u660e\u6027\u80fd\u6ca1\u6709\u95ee\u9898\uff0c\u67d0\u4e2a\u53c2\u6570\u6ca1\u6709\u6700\u4f18"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:"\u4f7f\u7528vpp\u5728\u521a\u542f\u52a8\u65f6\u4e22\u5305"}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"\u539f\u56e0",children:"\u539f\u56e0"}),"\n",(0,l.jsxs)(e.p,{children:["dpdk\u7684rx ring\u8fc7\u5c0f\uff0c\u5bfc\u81f4\u521a\u542f\u52a8\u65f6\u6d41\u91cf\u8fc7\u5927\u65e0\u6cd5\u5c06\u5305\u5168\u90e8\u6536\u4e0a\u6765\u3002",(0,l.jsx)("font",{color:"red",children:"\u4fee\u6539vpp\u542f\u52a8\u6587\u4ef6\u4e2ddpdk\u7684rx ring\u5927\u5c0f\u53ef\u89e3\u51b3\u4e22\u5305\u3002"})]}),"\n",(0,l.jsx)(e.p,{children:"\u5728startup.conf\u6587\u4ef6\u4e2d\u8bbe\u7f6enum-rx-desc\uff0c\u9ed8\u8ba4\u503c\u4e3a1024\uff0c\u6309\u5b9e\u9645\u6d4b\u8bd5\u60c5\u51b5\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"dev default {\n                ## Number of receive queues, enables RSS\n                ## Default is 1\n                num-rx-queues 1\n                # dpdk rx ring size\n                num-rx-desc 8912\n\n                # rss { ipv4 }\n                ## to number of worker threads or 1 if no workers treads\n                num-tx-queues 1\n}\n"})}),"\n",(0,l.jsx)(e.h5,{id:"\u65e0\u56de\u8c03",children:"\u65e0\u56de\u8c03"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"1g\u7ebf\u901f1024\u5927\u5c0f\u4e0d\u4e22\u5305"}),"\n",(0,l.jsx)(e.li,{children:"5g\u7ebf\u901f4096\u5927\u5c0f\u4e0d\u4e22\u5305"}),"\n",(0,l.jsx)(e.li,{children:"10g\u7ebf\u901f8912\u5927\u5c0f\u4e0d\u4e22\u5305"}),"\n"]}),"\n",(0,l.jsx)(e.h5,{id:"\u6709\u56de\u8c03",children:"\u6709\u56de\u8c03"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"5g\u7ebf\u901f8192\u5927\u5c0f\u4e0d\u4e22\u5305"}),"\n",(0,l.jsx)(e.li,{children:"6g\u7ebf\u901f40960\u5927\u5c0f\u4e0d\u4e22\u5305"}),"\n",(0,l.jsx)(e.li,{children:"7g\u7ebf\u901f40960\u4f1a\u51fa\u73b0rx-miss"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"vpp# show interface\n              Name               Idx    State  MTU (L3/IP4/IP6/MPLS)     Counter          Count\nTenGigabitEthernet0               1      up          1500/0/0/0     rx packets             111049438\n                                                                    rx bytes            165019456612\n                                                                    drops                          6\n                                                                    ip4                    111049432\n                                                                    rx-miss                  1672902\nlocal0                            0     down          0/0/0/0\n\n"})}),"\n",(0,l.jsx)(e.p,{children:"rx-miss\u8868\u793a\u7f51\u5361\u6536\u5230\u4e86\u5305\uff0c\u8868\u793arte_rx_queue\u5df2\u7ecf\u585e\u6ee1\u4e86\u6570\u636e\u5305\uff0c\u6240\u4ee5\u8be5\u5305\u88ab\u4e22\u5931\u3002\u6b64\u65f6\u8be5\u5305\u5b58\u5728\u4e8e\u7269\u7406\u7f51\u5361\u7684RX FIFO\u4e2d\uff0c\u4f46\u662f\u4e0d\u4f1a\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\u7684rte_rx_queue\u4e2d\u3002"}),"\n",(0,l.jsx)(e.p,{children:"rx-miss\u8868\u793a\u4ece\u7f51\u5361\u5230\u5185\u5b58\u5199\u5165\u6570\u636e\u5305\u65f6\u7684\u4e22\u5305\u4e2a\u6570\uff0c\u56e0\u6b64\u9700\u8981\u4ece\u4ee5\u4e0b2\u4e2a\u65b9\u9762\u8fdb\u884c\u8c03\u8bd5\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"PCIe\u662f\u5426\u5b58\u5728\u74f6\u9888"}),"\n",(0,l.jsxs)(e.li,{children:["rte_rx_queue\u4e2d\u7684\u6570\u636e\u5305\u6ca1\u6709\u53ca\u65f6\u6d88\u8d39\u6389","\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u68c0\u67e5cpu\u8fd0\u884c\u6a21\u5f0f\uff0c\u5982\u679c\u5f53\u524d\u8fd0\u884c\u5728powersave\u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u5c06\u5176\u4fee\u6539\u4e3aperformance\uff0c\u63d0\u5347CPU\u9891\u7387"}),"\n",(0,l.jsx)(e.li,{children:"\u7a0b\u5e8f\u6027\u80fd\u4e0d\u4f73\uff0c\u65e0\u6cd5\u53ca\u65f6\u6d88\u8017\u6389rte_rx_queue\u4e2d\u7684\u6570\u636e\u5305"}),"\n"]}),"\n"]}),"\n"]})]})}function o(n={}){const{wrapper:e}={...(0,p.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(c,{...n})}):c(n)}}}]);