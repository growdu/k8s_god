"use strict";(self.webpackChunkk_8_s_god=self.webpackChunkk_8_s_god||[]).push([[7141],{26585:(t,s,e)=>{e.r(s),e.d(s,{assets:()=>o,contentTitle:()=>_,default:()=>p,frontMatter:()=>l,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"pgsql/stats/stats","title":"stats","description":"1.","source":"@site/docs/pgsql/stats/stats.md","sourceDirName":"pgsql/stats","slug":"/pgsql/stats/","permalink":"/blog/docs/pgsql/stats/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/pgsql/stats/stats.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"sql_test","permalink":"/blog/docs/pgsql/sql_test"},"next":{"title":"PosgreSQL FSM\u6587\u4ef6\u89e3\u6790 \u2013 \u86cb\u631e","permalink":"/blog/docs/pgsql/storage/PosgreSQL FSM\u6587\u4ef6\u89e3\u6790 \u2013 \u86cb\u631e"}}');var a=e(74848),r=e(28453);const l={},_=void 0,o={},c=[];function i(t){const s={code:"code",li:"li",ol:"ol",pre:"pre",...(0,r.R)(),...t.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"\u8bbe\u7f6e\u5b58\u50a8\u4e34\u65f6\u7edf\u8ba1\u6570\u636e\u7684\u76ee\u5f55\u3002\u8fd9\u53ef\u4ee5\u662f\u4e00\u4e2a\u76f8\u5bf9\u4e8e\u6570\u636e\u76ee\u5f55\u7684\u8def\u5f84\u6216\u4e00\u4e2a\u7edd\u5bf9\u8def\u5f84\u3002\u9ed8\u8ba4\u503c\u662fpg_stat_tmp\u3002\u5728\u4e00\u4e2a\u57fa\u4e8e RAM \u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u6307\u660e\u8fd9\u4e2a\u53c2\u6570\u5c06\u964d\u4f4e\u7269\u7406 I/O \u9700\u6c42\uff0c\u5e76\u4e14\u63d0\u9ad8\u6027\u80fd\u3002\u8fd9\u4e2a\u53c2\u6570\u53ea\u80fd\u5728postgresql.conf\u6587\u4ef6\u4e2d\u6216\u5728\u670d\u52a1\u5668\u547d\u4ee4\u884c\u4e0a\u8bbe\u7f6e\u3002\n\u5bf9\u8d85\u5927\u5bb9\u91cf\u6570\u636e\u5e93\u5f88\u6709\u7528\uff1bstats \u4e34\u65f6\u76ee\u5f55\u53ef\u4ee5\u8bbe\u7f6e\u4e3a RAMdisk \u6216\u5176\u4ed6\u9ad8\u901f\u8d44\u6e90\uff08\u4ee5\u53ef\u80fd\u4e22\u5931\u4e00\u4e9b\u7edf\u8ba1\u4fe1\u606f\u4e3a\u4ee3\u4ef7\uff09\uff0c\u56e0\u4e3a\u8be5\u6587\u4ef6\u6bcf\u79d2\u66f4\u65b0\u6570\u767e\u6b21\u3002\n"})}),"\n",(0,a.jsxs)(s.ol,{start:"2",children:["\n",(0,a.jsx)(s.li,{}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"1.pg_stat_activity \u6bcf\u4e2a\u670d\u52a1\u8fdb\u7a0b\u4e00\u884c,\u663e\u793a\u4e0e\u90a3\u4e2a\u8fdb\u7a0b\u7684\u5f53\u524d\u6d3b\u52a8\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\u72b6\u6001\u548c\u5f53\u524d\u72b6\u6001\u548c\u67e5\u8be2\n2.pg_stat_replication \u6bcf\u4e00\u4e2aWAL\u53d1\u9001\u8fdb\u7a0b\u4e00\u884c\uff0c\u663e\u793a\u6709\u5173\u5230\u8be5\u53d1\u9001\u8fdb\u7a0b\u8fde\u63a5\u7684\u540e\u5907\u52a1\u5668\u7684\u590d\u5236\u7684\u7edf\u8ba1\u4fe1\u606f\n3.pg_stat_wal_receiver \u53ea\u6709\u4e00\u884c\uff0c\u663e\u793a\u6765\u81eaWAL\u63a5\u6536\u5668\u6240\u8fde\u63a5\u670d\u52a1\u5668\u7684\u6709\u5173\u8be5\u63a5\u6536\u5668\u7684\u7edf\u8ba1\u4fe1\u606f\n4.pg_stat_subscripition \u6bcf\u4e2a\u8ba2\u9605\u81f3\u5c11\u4e00\u884c\uff0c\u663e\u793a\u6709\u5173\u8be5\u8ba2\u9605\u7684\u5de5\u4f5c\u8005\u7684\u4fe1\u606f\n5. pg_stat_ssl \u6bcf\u4e2a\u8fde\u63a5\uff08\u5e38\u89c4\u7684\u6216\u8005\u590d\u5236\uff09\u4e00\u884c\uff0c\u663e\u793a\u5728\u8fd9\u4e2a\u8fde\u63a5\u4e0a\u4f7f\u7528\u7684ssl\u7684\u4fe1\u606f\n6.pg_stat_gssapi \u6bcf\u4e2a\u8fde\u63a5\uff08\u5e38\u89c4\u7684\u6216\u8005\u590d\u5236\uff09\u4e00\u884c\uff0c\u663e\u793a\u5173\u4e8egassapi\u52a0\u5bc6\u6216\u8005\u9a8c\u8bc1\u7684\u4fe1\u606f\n7. pg_stat_progress_create_index \u6bcf\u4e2a\u540e\u53f0\u8fd0\u884ccreate index\u6216reindex\u7684\u540e\u7aef\u90fd\u6709\u4e00\u884c\uff0c\u663e\u793a\u5f53\u524d\u8fdb\u5ea6\n8. pg_stat_progress_vacuum \u6bcf\u4e2a\u540e\u53f0\u8fd0\u884cVACUUM\u7684\u540e\u7aef\uff08\u6216\u8005autovacuum\u5de5\u4f5c\u8fdb\u7a0b\uff09\u4e00\u884c\uff0c\u663e\u793a\u5f53\u524d\u8fdb\u5ea6\n9. pg_stat_progress_cluster \u6bcf\u4e2a\u540e\u53f0\u8fd0\u884cCLUSTER\u6216VACUUM FULL\u7684\u540e\u7aef\u4e00\u884c\uff0c\u663e\u793a\u5f53\u524d\u8fdb\u5ea6\n"})}),"\n",(0,a.jsxs)(s.ol,{start:"2",children:["\n",(0,a.jsx)(s.li,{}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"1.pg_stat_archiver \u53ea\u6709\u4e00\u884c\uff0e\u663e\u793a\u6709\u5173WAL\u5f52\u67fd\u8fdb\u7a0b\u6d3b\u52a8\u7684\u7edf\u8ba1\u4fe1\u606f\n2. pg_stat_bgwritter \u53ea\u6709\u4e00\u884c\uff0c\u663e\u793a\u6709\u5173\u540e\u53f0\u5199\u8fdb\u7a0b\u7684\u6d3b\u52a8\u7684\u7edf\u8ba1\u4fe1\u606f\n3. pg_stat_database \u6bcf\u4e2a\u6570\u636e\u5e93\u4e00\u884c\uff0c\u663e\u793a\u6570\u636e\u5e93\u8303\u56f4\u7684\u7edf\u8ba1\u4fe1\u606f\n4. pg_stat_database_conflicts \u6bcf\u4e2a\u6570\u636e\u5e93\u4e00\u884c\uff1a\u7531\u4e8e\u4e0e\u540e\u5907\u670d\u52a1\u5668\u7684\u590d\u8fc7\u7a0b\u53d1\u751f\u51b2\u7a81\u800c\u88ab\u53d6\u6d88\u7684\u67e5\u8be2\n5. pg_stat_all_tables \u5f53\u524d\u6570\u636e\u5e93\u4e2d\u6bcf\u4e2a\u8868\u4e00\u884c\uff0c\u663e\u793a\u6709\u5173\u8bbf\u95ee\u6307\u5b9a\u8868\u7684\u7edf\u8ba1\u4fe1\u606f\n6.pg_stat_xact_all_tables \u8ba1\u6570\u52a8\u4f5c\u53ea\u5728\u5f53\u524d\u4e8b\u52a1\u5185\u53d1\u751f\uff08\u8fd8\u6ca1\u6709\u88ab\u5305\u62ec\u5728pg_stat_all_tables \u548c\u76f8\u5173\u89c6\u56fe\n\u4e2d\uff09\n7. pg_stat_all_indexes \u5f53\u524d\u6570\u636e\u5e93\u4e2d\u7684\u6bcf\u4e2a\u7d22\u5f15\u4e00\u884c\uff0c\u663e\u793a\u4e0e\u8bbf\u95ee\u6307\u5b9a\u7d22\u5f15\u6709\u5173\u7684\u7edf\u8ba1\u4fe1\u606f\n8. pg_statio_all_tables \u5f53\u524d\u6570\u636e\u5cb8\u4e2d\u7684\u6bcf\u4e2a\u8868\u4e00\u884c\uff0c\u663e\u793a\u6709\u5173\u5728\u6307\u5b9a\u8868\u4e0aI/O\u7684\u7edf\u8ba1\u4fe1\u606f\n9. pg_statio_all_indexes  \u5f53\u524d\u6570\u636e\u5e93\u4e2d\u7684\u6bcf\u4e2a\u7d22\u5f15\u4e00\u884c\uff0c\u663e\u793a\u4e0e\u6307\u5b9a\u7d22\u5f15\u4e0a\u7684I/O\u6709\u5173\u7684\u7edf\u8ba1\u4fe1\u606f\n10. pg_statio_all_seauence \u5f53\u524d\u6570\u636e\u5cb8\u4e2d\u7684\u6bcf\u4e2a\u5217\u4e00\u884c\uff0c\u663e\u793a\u4e0e\u6307\u5b9a\u5e8f\u5217\u4e0a\u7684I/O\u6709\u5173\u7684\u7edf\u8ba1\u4fe1\u606f\n11. pg_stat_user_function \u4e00\u4e2a\u88ab\u8ddf\u8e2a\u7684\u51fd\u6570\u4e00\u884c\uff0c\u663e\u793a\u4e0e\u6267\u884c\u8be5\u51fd\u6570\u6709\u5173\u7684\u7edf\u8ba1\u4fe1\u606f \n"})}),"\n",(0,a.jsxs)(s.ol,{start:"2",children:["\n",(0,a.jsx)(s.li,{}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"pg_stat_statements.save = on\n2. \u67e5\u8be2\nselect queryid, substr(query,0,30) as query, parses, plans, calls, round(total_plan_time + total_exec_time) as times,rows from pg_stat_statements order by times desc;\n3.\u6e05\u7406\npg_stat_statements_reset\n"})}),"\n",(0,a.jsxs)(s.ol,{start:"2",children:["\n",(0,a.jsx)(s.li,{}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"1. \u901a\u8fc7pg_stat_database\u53ef\u4ee5\u5927\u6982\u4e86\u89e3\u6570\u636e\u5e93\u7684\u5386\u53f2\u60c5\u51b5;pg_stat_statements\u6a21\u5757\u63d0\u4f9b\u4e00\u79cd\u8ddf\u8e2a\u6267\u884c\u7edf\u8ba1\u670d\u52a1\u5668\u6267\u884c\u7684\u6240\u6709SQL\u8bed\u53e5\u7684\u624b;\n2. pg_stat_database\u66f4\u591a\u7684\u662f\u5173\u6ce8\u5386\u53f2\u6570\u636e\uff0c\u5373\u8fc7\u53bb\u7684\u6570\u636e\u5e93\u72b6\u6001\uff1b\u800cpg_stat_statements\u5173\u6ce8\u7684\u662f\u5b9e\u65f6\u6570\u636e\uff0c\u5373\u6570\u636e\u5e93\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u5b9e\u65f6\u7edf\u8ba1\u6570\u636e\u3002\n"})}),"\n",(0,a.jsxs)(s.ol,{start:"6",children:["\n",(0,a.jsx)(s.li,{}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"1. \u53ef\u4ee5\u901a\u8fc7pg_stat_activity\u67e5\u770b\u6b63\u5728\u6267\u884c\u7684SQL\uff1b\n2.\u5c5e\u4e8e\u5b9e\u65f6\u7edf\u8ba1\u4fe1\u606f\uff1b\n3.\u4f7f\u7528PgBackendStatus\u6570\u7ec4\u5b58\u50a8\n"})}),"\n",(0,a.jsxs)(s.ol,{start:"7",children:["\n",(0,a.jsx)(s.li,{}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"1.\u4fee\u6539\u6570\u636e\u5e93\u914d\u7f6e\uff0c\u6253\u5f00pg_stat_statements,\u91cd\u542f\u6570\u636e\u5e93\nshared_preload_libraries = 'liboracle_parser, pg_stats_statements'\npg_stat_statements.track_utility = on\npg_stat_statements.track = 'top'\npg_stat_statements.max = 5000\npg_stat_statements.save = on\n2. \u521b\u5efapg_stat_statements\u6269\u5c55\nCREATE EXTENSION pg_stat_statements;\n3.\u5728\u6570\u636e\u5e93shell\u4e2d\u6839\u636e\u76f8\u5173\u6761\u4ef6\u67e5\u8be2pg_stat_statements\u89c6\u56fe\uff0c\u83b7\u53d6\u6267\u884c\u6b21\u6570\u548c\u6267\u884c\u65f6\u95f4\n\n"})}),"\n",(0,a.jsxs)(s.ol,{start:"8",children:["\n",(0,a.jsx)(s.li,{}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"1.\u65e0\uff1b\n2.\u5bfb\u6c42\u5e2e\u52a9\u7684\u65b9\u6cd5\u6709\uff1a\n a. \u6c42\u52a9\u516c\u53f8\u76f8\u5173\u6a21\u5757\u7684\u540c\u4e8b\uff1b\n b. \u4e0a\u7f51\u67e5\u9605\u8d44\u6599\uff0c\u5305\u62ecpg\u5b98\u7f51\uff1b\n c.\u9605\u8bfb\u6570\u636e\u5e93\u624b\u518c\uff1b\n d.\u9605\u8bfb\u5f00\u53d1\u8005\u6587\u6863\u548c\u6e90\u7801\n"})})]})}function p(t={}){const{wrapper:s}={...(0,r.R)(),...t.components};return s?(0,a.jsx)(s,{...t,children:(0,a.jsx)(i,{...t})}):i(t)}},28453:(t,s,e)=>{e.d(s,{R:()=>l,x:()=>_});var n=e(96540);const a={},r=n.createContext(a);function l(t){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof t?t(s):{...s,...t}}),[s,t])}function _(t){let s;return s=t.disableParentContext?"function"==typeof t.components?t.components(a):t.components||a:l(t.components),n.createElement(r.Provider,{value:s},t.children)}}}]);