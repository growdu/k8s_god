"use strict";(self.webpackChunkk_8_s_god=self.webpackChunkk_8_s_god||[]).push([[3935],{20807:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>o,contentTitle:()=>d,default:()=>_,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"vpp/vpp\u4e3b\u8981\u6570\u636e\u7ed3\u6784","title":"vpp \u4e3b\u8981\u6570\u636e\u7ed3\u6784","description":"- vlibmaint","source":"@site/docs/vpp/vpp\u4e3b\u8981\u6570\u636e\u7ed3\u6784.md","sourceDirName":"vpp","slug":"/vpp/vpp\u4e3b\u8981\u6570\u636e\u7ed3\u6784","permalink":"/blog/docs/vpp/vpp\u4e3b\u8981\u6570\u636e\u7ed3\u6784","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/vpp/vpp\u4e3b\u8981\u6570\u636e\u7ed3\u6784.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"vpp vector\u6307\u5317","permalink":"/blog/docs/vpp/vpp vector\u6307\u5317"},"next":{"title":"vpp\u4ee3\u7801\u6d41\u7a0b\u5206\u6790","permalink":"/blog/docs/vpp/vpp\u4ee3\u7801\u6d41\u7a0b\u56fe"}}');var s=r(74848),t=r(28453);const l={},d="vpp \u4e3b\u8981\u6570\u636e\u7ed3\u6784",o={},c=[{value:"\u62a5\u6587\u6d41\u8f6c",id:"\u62a5\u6587\u6d41\u8f6c",level:2}];function a(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"vpp-\u4e3b\u8981\u6570\u636e\u7ed3\u6784",children:"vpp \u4e3b\u8981\u6570\u636e\u7ed3\u6784"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"vlib_main_t"}),"\n",(0,s.jsx)(e.p,{children:"vpp\u6700\u9876\u5c42\u7ed3\u6784\uff0c\u5176\u4e2d\u5305\u542b\u4e86vpp\u6267\u884c\u7684\u7edd\u5927\u90e8\u5206\u4fe1\u606f\uff0c\u540e\u7eed\u6ce8\u518c\u52a0\u8f7d\u90fd\u662f\u586b\u5145\u8be5\u6570\u636e\u7ed3\u6784\u3002\u6267\u884c\u90fd\u9700\u8981\u4ece\u8be5\u6570\u636e\u7ed3\u6784\u4e2d\u83b7\u53d6\u76f8\u5173\u4fe1\u606f\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5176\u4e2d\u8282\u70b9\u5b58\u5728node_main\u4e2d\uff0c\u5373\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"/* Node graph main structure. */\nvlib_node_main_t node_main;\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"vlib_node_main_t"}),"\n",(0,s.jsx)(e.p,{children:"\u5b58\u653e\u8282\u70b9\u56fe\u3002\u5176\u4e2d\u8282\u70b9\u5b9e\u9645\u5b58\u653e\u4f4d\u7f6e\u4e3a\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"/* Public nodes. */\nvlib_node_t **nodes; // \u5b58\u50a8\u975eVLIB_NODE_TYPE_PROCESS\u8282\u70b9\n\n/* Vector of process nodes.\n     One for each node of type VLIB_NODE_TYPE_PROCESS. */\nvlib_process_t **processes; // \u5b58\u50a8VLIB_NODE_TYPE_PROCESS\u8282\u70b9\n\n/* Node index hashed by node name. */\nuword *node_by_name; // \u6839\u636e\u540d\u5b57\u53d6\u8282\u70b9\n\n/* Nodes segregated by type for cache locality.\n     Does not apply to nodes of type VLIB_NODE_TYPE_INTERNAL. */\nvlib_node_runtime_t *nodes_by_type[VLIB_N_NODE_TYPE]; // \u5b58\u653e\u5404\u8282\u70b9\u5bf9\u5e94\u7684runtime\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"vlib_process_t"}),"\n",(0,s.jsx)(e.p,{children:"\u5b58\u653eVLIB_NODE_TYPE_PROCESS\u7c7b\u578b\u7684\u8282\u70b9\u7684\u4fe1\u606f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:" /* Node runtime for this process. */\n  vlib_node_runtime_t node_runtime;\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"vlib_node_t"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"/* Vector processing function for this node. */\nvlib_node_function_t *function;\n\n /* Index of corresponding node runtime. */\n u32 runtime_index; // \u5bf9\u4e8eVLIB_NODE_TYPE_PROCESS\u8282\u70b9\u662f\u5728vlib_node_main_t\u7684proceses\u4e2d\u7684\u7d22\u5f15\n\t\t\t\t\t// \u5bf9\u4e8e\u975eVLIB_NODE_TYPE_PROCESS\u8282\u70b9\u662f\u5728vlib_node_main_t\u7684nodes\u4e2d\u7684\u7d22\u5f15\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"vlib_node_runtime_t"}),"\n",(0,s.jsx)(e.p,{children:"\u8c03\u5ea6\u6846\u67b6\u5b9e\u9645\u9891\u7e41\u4f7f\u7528\u7684\u7ed3\u6784\uff0c\u4ecevlib_node_t\u62f7\u8d1d\u4e86\u90e8\u5206\u4fe1\u606f\uff0c\u4ee5\u53ca\u79c1\u6709\u7684\u9891\u7e41\u53d8\u52a8\u7684\u4fe1\u606f\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"vlib_frame_t"}),"\n",(0,s.jsx)(e.p,{children:"\u6bcf\u4e2anode\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684vlib_frame_t\uff0c\u7528\u6765\u4fdd\u5b58\u4f9bnode\u4f7f\u7528\u7684\u6570\u636e\u5305\u96c6\u5408\u3002\u8fd9\u662f\u6bcf\u4e2anode\u6700\u7ec8\u5904\u7406\u6570\u636e\u7684\u5185\u5b58\u6240\u5728\u5730\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"  /* Frame flags. */\n  u16 frame_flags;\n\n  /* User flags. Used for sending hints to the next node. */\n  u16 flags;\n\n  /* Number of scalar bytes in arguments. */\n  u8 scalar_size;\n \n  /* Number of bytes per vector argument. */\n  u8 vector_size;\n\n  /* Number of vector elements currently in frame. */\n  u16 n_vectors;\n\n/* Scalar and vector arguments to next node. */\n  u8 arguments[0];\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"vlib_pending_frame_t"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u4e00\u4e2anode\u5904\u7406\u5b8c\u6570\u636e\u5305\uff0c\u5219\u586b\u5145\u8be5\u6570\u636e\u7ed3\u6784\uff0c\u5e76\u52a0\u5165\u5230\u5168\u5c40\u94fe\u8868\uff0c\u8c03\u5ea6\u6846\u67b6\u4fbf\u80fd\u5728\u4e0b\u4e00\u6b21\u8c03\u5ea6\u65f6\u627e\u5230\u9700\u8981 \u63a5\u624b\u8be5\u6570\u636e\u5305\u7684\u4e0b\u4e00\u4e2anode"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"/* A frame pending dispatch by main loop. */\ntypedef struct\n{\n  /* Node and runtime for this frame. */\n  u32 node_runtime_index;\n\n  /* Frame index (in the heap). */\n  u32 frame_index;\n    /* Start of next frames for this node. */\n  u32 next_frame_index;\n\n  /* Special value for next_frame_index when there is no next frame. */\n#define VLIB_PENDING_FRAME_NO_NEXT_FRAME ((u32) ~0)\n} vlib_pending_frame_t;\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"vlib_next_frame_t"}),"\n",(0,s.jsx)(e.p,{children:"\u4e3b\u8981\u662fnode\u5185\u90e8\u903b\u8f91\u4f7f\u7528\uff0c\u5b9a\u4f4d\u8be5node\u7684\u4e0b\u4e00\u6761\u4fe1\u606f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"/* Frame index. */\n  u32 frame_index;\n\n  /* Node runtime for this next. */\n  u32 node_runtime_index;\n\n  /* Next frame flags. */\n  u32 flags;\n\n /* Number of vectors enqueue to this next since last overflow. */\n  u32 vectors_since_last_overflow;\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u62a5\u6587\u6d41\u8f6c",children:"\u62a5\u6587\u6d41\u8f6c"}),"\n",(0,s.jsx)(e.p,{children:"\u62a5\u6587\u5904\u7406\u4e3b\u8981\u5305\u542b\u5982\u4e0b\u4e09\u4e2a\u65b9\u9762\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5b58\u50a8\u8282\u70b9"}),"\n",(0,s.jsx)(e.li,{children:"\u5b58\u50a8\u62a5\u6587"}),"\n",(0,s.jsx)(e.li,{children:"\u62a5\u6587\u4f20\u9001"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u62a5\u6587\u6d41\u8f6c\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u786e\u5b9a\u62a5\u6587\u53d1\u9001\u7ed9\u54ea\u4e2a\u5b69\u5b50\u8282\u70b9"}),"\n",(0,s.jsx)(e.p,{children:"\u786e\u5b9a\u628a\u62a5\u6587\u9001\u7ed9\u54ea\u4e2a\u5b69\u5b50\u8282\u70b9\u5904\u7406\uff0c\u662f\u7531\u8be5 node \u7684\u4e1a\u52a1\u903b\u8f91\u51b3\u5b9a\u7684\uff0c\u901a\u5e38\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a\u4e00\u662f\u901a\u8fc7\u89e3\u6790\u62a5\u6587\u7684\u5185\u5bb9\u6765\u51b3\u5b9a\uff0c\u6bd4\u5982 ethernet-input \u8282\u70b9\u901a\u8fc7\u89e3\u6790\u62a5\u6587\u662f ipv4 \u8fd8\u662f ipv6 \u62a5\u6587\u628a\u62a5\u6587\u53d1\u9001\u7ed9ip4-input \u6216 ip6-input \u53bb\u5904\u7406\uff1b\u4e8c\u662f\u901a\u8fc7\u67e5\u627e\u8f6c\u53d1\u8868\u6765\u51b3\u5b9a\uff0c\u6bd4\u5982 ip4-lookup \u901a\u8fc7\u67e5\u627e\u8def\u7531\u8868\u6765\u51b3\u5b9a\n\u628a\u62a5\u6587\u53d1\u9001\u7ed9 ip4-arp \u8fd8\u662f ip4-rewrite \u8282\u70b9\u6765\u5904\u7406\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u627e\u5230\u5b69\u5b50\u8282\u70b9\u5bf9\u5e94\u7684\u7528\u4e8e\u5b58\u653e\u62a5\u6587\u7684\u7ed3\u6784vlib_frame_t"}),"\n",(0,s.jsx)(e.p,{children:"\u786e\u5b9a\u628a\u62a5\u6587\u53d1\u9001\u7ed9\u7b2c\u51e0\u4e2a\u5b69\u5b50\u8282\u70b9\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u8be5\u5b69\u5b50\u8282\u70b9\u5bf9\u5e94\u7684 vlib_next_frame_t \u7ed3\u6784\u4e86\u3002vlib_next_frame_t \u7ed3\u6784\u4e2d\u7684 frame_index \u5b57\u6bb5\u6307\u5411vlib_frame_t \u7ed3\u6784\uff0cvlib_frame_t \u7ed3\u6784\u662f\u5b58\u653e\u62a5\u6587\u7684\u5730\u65b9"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u628a\u62a5\u6587\u653e\u5165vlib_frame_t\u7ed3\u6784"}),"\n",(0,s.jsx)(e.p,{children:"vlib_frame_t \u7ed3\u6784\u6700\u540e\u4e00\u4e2a\u5b57\u6bb5\u4e3a\u53ef\u53d8\u6570\u7ec4\uff0c\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u5206\u914d\u4e00\u5757\u5185\u5b58\uff0c\u7528\u4e8e\u5b58\u653e\u62a5\u6587\u7684\u7d22\u5f15\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u521b\u5efa vlib_pending_frame_t \u7ed3\u6784\uff0c\u5e76\u628a\u5b83\u52a0\u5165\u6570\u7ec4 vm->node_main. pending_frames \u7b49\u5f85\u8c03\u5ea6"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"vlib_pending_frame_t \u7ed3\u6784\u8bb0\u5f55\u62a5\u6587\u6240\u5728\u7684\u7ed3\u6784 vlib_next_frame_t \u7684 index\uff0c\u4ee5\u53ca\u5904\u7406\u8fd9\u4e9b\u62a5\u6587\u7684node \u7684 vlib_node_runtime_t \u7ed3\u6784\u7684\u7d22\u5f15\uff0c\u8fd9\u6837\u901a\u8fc7 vlib_pending_frame_t \u7ed3\u6784\u91cc\u9762\u7684\u4fe1\u606f\u5c31\u53ef\u4ee5\u628a\u62a5\u6587\u5206\u53d1\u7ed9\u6307\u5b9a\u7684 node \u5904\u7406\u4e86"}),"\n",(0,s.jsx)(e.mermaid,{value:"graph TB\nvlib_get_next_frame--\x3evlib_get_next_frame_internal--\x3evlib_frame_alloc--\x3evlib_frame_alloc_to_node--\x3evlib_put_next_frame"})]})}function _(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>l,x:()=>d});var i=r(96540);const s={},t=i.createContext(s);function l(n){const e=i.useContext(t);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);