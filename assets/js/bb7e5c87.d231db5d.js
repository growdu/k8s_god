"use strict";(self.webpackChunkk_8_s_god=self.webpackChunkk_8_s_god||[]).push([[9056],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var s=t(96540);const a={},r=s.createContext(a);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},76467:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"pgsql/replication/PostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790 - \u5173\u7cfb\u578b\u6570\u636e\u5e93 - \u4ebf\u901f\u4e91","title":"PostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790 - \u5173\u7cfb\u578b\u6570\u636e\u5e93 - \u4ebf\u901f\u4e91","description":"\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u4ecb\u7ecd\u201cPostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790\u201d\uff0c\u5728\u65e5\u5e38\u64cd\u4f5c\u4e2d\uff0c\u76f8\u4fe1\u5f88\u591a\u4eba\u5728PostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790\u95ee\u9898\u4e0a\u5b58\u5728\u7591\u60d1\uff0c\u5c0f\u7f16\u67e5\u9605\u4e86\u5404\u5f0f\u8d44\u6599\uff0c\u6574\u7406\u51fa\u7b80\u5355\u597d\u7528\u7684\u64cd\u4f5c\u65b9\u6cd5\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u89e3\u7b54\u201dPostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790\u201d\u7684\u7591\u60d1\u6709\u6240\u5e2e\u52a9\uff01\u63a5\u4e0b\u6765\uff0c\u8bf7\u8ddf\u7740\u5c0f\u7f16\u4e00\u8d77\u6765\u5b66\u4e60\u5427\uff01","source":"@site/docs/pgsql/replication/PostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790 - \u5173\u7cfb\u578b\u6570\u636e\u5e93 - \u4ebf\u901f\u4e91.md","sourceDirName":"pgsql/replication","slug":"/pgsql/replication/PostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790 - \u5173\u7cfb\u578b\u6570\u636e\u5e93 - \u4ebf\u901f\u4e91","permalink":"/blog/docs/pgsql/replication/PostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790 - \u5173\u7cfb\u578b\u6570\u636e\u5e93 - \u4ebf\u901f\u4e91","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/pgsql/replication/PostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790 - \u5173\u7cfb\u578b\u6570\u636e\u5e93 - \u4ebf\u901f\u4e91.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"PostgreSQL\u6570\u636e\u5e93\u590d\u5236\u2014\u2014\u540e\u53f0\u4e00\u7b49\u516c\u6c11\u8fdb\u7a0bWalReceiver&startup\u4ea4\u4e92_postgressql walreceive\u7ebf\u7a0b_\u80a5\u53d4\u83cc\u7684\u535a\u5ba2-CSDN\u535a\u5ba2","permalink":"/blog/docs/pgsql/replication/PostgreSQL\u6570\u636e\u5e93\u590d\u5236\u2014\u2014\u540e\u53f0\u4e00\u7b49\u516c\u6c11\u8fdb\u7a0bWalReceiver&startup\u4ea4\u4e92_postgressql walreceive\u7ebf\u7a0b_\u80a5\u53d4\u83cc\u7684\u535a\u5ba2-CSDN\u535a\u5ba2"},"next":{"title":"0 Postgresql\u5b58\u50a8\u3001\u7d22\u5f15\u53ca\u7cfb\u7edf\u4f18\u5316\u3001\u4e3b\u5907\u5207\u6362","permalink":"/blog/docs/pgsql/replication/Postgresql\u5b58\u50a8\u3001\u7d22\u5f15\u53ca\u7cfb\u7edf\u4f18\u5316\u3001\u4e3b\u5907\u5207\u6362"}}');var a=t(74848),r=t(28453);const o={},i=void 0,d={},c=[{value:"\u4e00\u3001\u6570\u636e\u7ed3\u6784",id:"\u4e00\u6570\u636e\u7ed3\u6784",level:4},{value:"\u4e8c\u3001\u6e90\u7801\u89e3\u8bfb",id:"\u4e8c\u6e90\u7801\u89e3\u8bfb",level:4},{value:"\u4e09\u3001\u8ddf\u8e2a\u5206\u6790",id:"\u4e09\u8ddf\u8e2a\u5206\u6790",level:4}];function l(e){const n={br:"br",code:"code",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u4ecb\u7ecd\u201cPostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790\u201d\uff0c\u5728\u65e5\u5e38\u64cd\u4f5c\u4e2d\uff0c\u76f8\u4fe1\u5f88\u591a\u4eba\u5728PostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790\u95ee\u9898\u4e0a\u5b58\u5728\u7591\u60d1\uff0c\u5c0f\u7f16\u67e5\u9605\u4e86\u5404\u5f0f\u8d44\u6599\uff0c\u6574\u7406\u51fa\u7b80\u5355\u597d\u7528\u7684\u64cd\u4f5c\u65b9\u6cd5\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u89e3\u7b54\u201dPostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790\u201d\u7684\u7591\u60d1\u6709\u6240\u5e2e\u52a9\uff01\u63a5\u4e0b\u6765\uff0c\u8bf7\u8ddf\u7740\u5c0f\u7f16\u4e00\u8d77\u6765\u5b66\u4e60\u5427\uff01"}),"\n",(0,a.jsxs)(n.p,{children:["\u8be5\u8fdb\u7a0b\u5b9e\u8d28\u4e0a\u662fstreaming replication\u73af\u5883\u4e2dmaster\u8282\u70b9\u4e0a\u666e\u901a\u7684backend\u8fdb\u7a0b,\u5728standby\u8282\u70b9\u542f\u52a8\u65f6,standby\u8282\u70b9\u5411master\u53d1\u9001\u8fde\u63a5\u8bf7\u6c42,master\u8282\u70b9\u7684postmaster\u8fdb\u7a0b\u63a5\u6536\u5230\u8bf7\u6c42\u540e,\u542f\u52a8\u8be5\u8fdb\u7a0b\u4e0estandby\u8282\u70b9\u7684walreceiver\u8fdb\u7a0b\u5efa\u7acb\u901a\u8baf\u8fde\u63a5,\u7528\u4e8e\u4f20\u8f93WAL Record.",(0,a.jsx)(n.br,{}),"\n","walsender\u542f\u52a8\u540e,\u4f7f\u7528gdb\u8ddf\u8e2a\u6b64\u8fdb\u7a0b,\u5176\u8c03\u7528\u6808\u5982\u4e0b:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'(gdb)\xa0bt\n#0\xa0\xa00x00007fb6e6390903\xa0in\xa0__epoll_wait_nocancel\xa0()\xa0from\xa0/lib64/libc.so.6\n#1\xa0\xa00x000000000088e668\xa0in\xa0WaitEventSetWaitBlock\xa0(set=0x10ac808,\xa0cur_timeout=29999,\xa0occurred_events=0x7ffd634441b0,\xa0\n\xa0\xa0\xa0\xa0nevents=1)\xa0at\xa0latch.c:1048\n#2\xa0\xa00x000000000088e543\xa0in\xa0WaitEventSetWait\xa0(set=0x10ac808,\xa0timeout=29999,\xa0occurred_events=0x7ffd634441b0,\xa0nevents=1,\xa0\n\xa0\xa0\xa0\xa0wait_event_info=83886092)\xa0at\xa0latch.c:1000\n#3\xa0\xa00x000000000088dcec\xa0in\xa0WaitLatchOrSocket\xa0(latch=0x7fb6dcbfc4d4,\xa0wakeEvents=27,\xa0sock=10,\xa0timeout=29999,\xa0\n\xa0\xa0\xa0\xa0wait_event_info=83886092)\xa0at\xa0latch.c:385\n#4\xa0\xa00x000000000085405b\xa0in\xa0WalSndLoop\xa0(send_data=0x8547fe\xa0<XLogSendPhysical>)\xa0at\xa0walsender.c:2229\n#5\xa0\xa00x0000000000851c93\xa0in\xa0StartReplication\xa0(cmd=0x10ab750)\xa0at\xa0walsender.c:684\n#6\xa0\xa00x00000000008532f0\xa0in\xa0exec_replication_command\xa0(cmd_string=0x101dd78\xa0"START_REPLICATION\xa00/5D000000\xa0TIMELINE\xa016")\n\xa0\xa0\xa0\xa0at\xa0walsender.c:1539\n#7\xa0\xa00x00000000008c0170\xa0in\xa0PostgresMain\xa0(argc=1,\xa0argv=0x1049cb8,\xa0dbname=0x1049ba8\xa0"",\xa0username=0x1049b80\xa0"replicator")\n\xa0\xa0\xa0\xa0at\xa0postgres.c:4178\n#8\xa0\xa00x000000000081e06c\xa0in\xa0BackendRun\xa0(port=0x103fb50)\xa0at\xa0postmaster.c:4361\n#9\xa0\xa00x000000000081d7df\xa0in\xa0BackendStartup\xa0(port=0x103fb50)\xa0at\xa0postmaster.c:4033\n#10\xa00x0000000000819bd9\xa0in\xa0ServerLoop\xa0()\xa0at\xa0postmaster.c:1706\n#11\xa00x000000000081948f\xa0in\xa0PostmasterMain\xa0(argc=1,\xa0argv=0x1018a50)\xa0at\xa0postmaster.c:1379\n#12\xa00x0000000000742931\xa0in\xa0main\xa0(argc=1,\xa0argv=0x1018a50)\xa0at\xa0main.c:228\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u672c\u8282\u9996\u5148\u4ecb\u7ecd\u8c03\u7528\u6808\u4e2dPostgresMain\u51fd\u6570."}),"\n",(0,a.jsx)(n.h4,{id:"\u4e00\u6570\u636e\u7ed3\u6784",children:"\u4e00\u3001\u6570\u636e\u7ed3\u6784"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"StringInfo"}),(0,a.jsx)(n.br,{}),"\n","StringInfoData\u7ed3\u6784\u4f53\u4fdd\u5b58\u5173\u4e8e\u6269\u5c55\u5b57\u7b26\u4e32\u7684\u76f8\u5173\u4fe1\u606f."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"/*-------------------------\n\xa0*\xa0StringInfoData\xa0holds\xa0information\xa0about\xa0an\xa0extensible\xa0string.\n\xa0*\xa0StringInfoData\u7ed3\u6784\u4f53\u4fdd\u5b58\u5173\u4e8e\u6269\u5c55\u5b57\u7b26\u4e32\u7684\u76f8\u5173\u4fe1\u606f.\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0data\xa0\xa0\xa0\xa0is\xa0the\xa0current\xa0buffer\xa0for\xa0the\xa0string\xa0(allocated\xa0with\xa0palloc).\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0data\xa0\xa0\xa0\xa0\u901a\u8fc7palloc\u5206\u914d\u7684\u5b57\u7b26\u4e32\u7f13\u5b58\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0len\xa0\xa0\xa0\xa0\xa0is\xa0the\xa0current\xa0string\xa0length.\xa0\xa0There\xa0is\xa0guaranteed\xa0to\xa0be\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0a\xa0terminating\xa0'\\0'\xa0at\xa0data[len],\xa0although\xa0this\xa0is\xa0not\xa0very\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0useful\xa0when\xa0the\xa0string\xa0holds\xa0binary\xa0data\xa0rather\xa0than\xa0text.\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0len\xa0\xa0\xa0\xa0\xa0\u662f\u5f53\u524d\u5b57\u7b26\u4e32\u7684\u957f\u5ea6.\u4fdd\u8bc1\u4ee5ASCII\xa00(\\0)\u7ed3\u675f(data[len]\xa0=\xa0'\\0').\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u867d\u7136\u5982\u679c\u5b58\u50a8\u7684\u662f\u4e8c\u8fdb\u5236\u6570\u636e\u800c\u4e0d\u662f\u6587\u672c\u65f6\u4e0d\u592a\u597d\u4f7f.\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0maxlen\xa0\xa0is\xa0the\xa0allocated\xa0size\xa0in\xa0bytes\xa0of\xa0'data',\xa0i.e.\xa0the\xa0maximum\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0string\xa0size\xa0(including\xa0the\xa0terminating\xa0'\\0'\xa0char)\xa0that\xa0we\xa0can\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0currently\xa0store\xa0in\xa0'data'\xa0without\xa0having\xa0to\xa0reallocate\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0more\xa0space.\xa0\xa0We\xa0must\xa0always\xa0have\xa0maxlen\xa0>\xa0len.\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0maxlen\xa0\xa0\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u5df2\u5206\u914d\u7684'data'\u7684\u5927\u5c0f,\u9650\u5b9a\u4e86\u6700\u5927\u7684\u5b57\u7b26\u4e32\u5927\u5c0f(\u5305\u62ec\u7ed3\u5c3e\u7684ASCII\xa00)\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u5c0f\u4e8e\u6b64\u5c3a\u5bf8\u7684\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u5b58\u50a8\u800c\u65e0\u9700\u91cd\u65b0\u5206\u914d.\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0cursor\xa0\xa0is\xa0initialized\xa0to\xa0zero\xa0by\xa0makeStringInfo\xa0or\xa0initStringInfo,\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0but\xa0is\xa0not\xa0otherwise\xa0touched\xa0by\xa0the\xa0stringinfo.c\xa0routines.\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Some\xa0routines\xa0use\xa0it\xa0to\xa0scan\xa0through\xa0a\xa0StringInfo.\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0cursor\xa0\xa0\u901a\u8fc7makeStringInfo\u6216initStringInfo\u521d\u59cb\u5316\u4e3a0,\u4f46\u4e0d\u53d7stringinfo.c\u4f8b\u7a0b\u7684\u5f71\u54cd.\n\xa0*\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u67d0\u4e9b\u4f8b\u7a0b\u4f7f\u7528\u8be5\u5b57\u6bb5\u626b\u63cfStringInfo\n\xa0*-------------------------\n\xa0*/\ntypedef\xa0struct\xa0StringInfoData\n{\n\xa0\xa0\xa0\xa0char\xa0\xa0\xa0\xa0\xa0\xa0\xa0*data;\n\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0len;\n\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0maxlen;\n\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0cursor;\n}\xa0StringInfoData;\ntypedef\xa0StringInfoData\xa0*StringInfo;\n"})}),"\n",(0,a.jsx)(n.h4,{id:"\u4e8c\u6e90\u7801\u89e3\u8bfb",children:"\u4e8c\u3001\u6e90\u7801\u89e3\u8bfb"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"PostgresMain"}),(0,a.jsx)(n.br,{}),"\n","\u540e\u53f0\u8fdb\u7a0bpostgres\u7684\u4e3b\u5faa\u73af\u5165\u53e3 \u2014 \u6240\u6709\u7684\u4ea4\u4e92\u5f0f\u6216\u5176\u4ed6\u5f62\u5f0f\u7684\u540e\u53f0\u8fdb\u7a0b\u5728\u8fd9\u91cc\u542f\u52a8.",(0,a.jsx)(n.br,{}),"\n","\u5176\u4e3b\u8981\u903b\u8f91\u5982\u4e0b:",(0,a.jsx)(n.br,{}),"\n","1.\u521d\u59cb\u5316\u76f8\u5173\u53d8\u91cf",(0,a.jsx)(n.br,{}),"\n","2.\u521d\u59cb\u5316\u8fdb\u7a0b\u4fe1\u606f,\u8bbe\u7f6e\u8fdb\u7a0b\u72b6\u6001,\u521d\u59cb\u5316GUC\u53c2\u6570",(0,a.jsx)(n.br,{}),"\n","3.\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570\u5e76\u4f5c\u76f8\u5173\u6821\u9a8c",(0,a.jsx)(n.br,{}),"\n","4.\u5982\u4e3awalsender\u8fdb\u7a0b,\u5219\u8c03\u7528WalSndSignals\u521d\u59cb\u5316,\u5426\u5219\u6267\u884c\u5176\u4ed6\u4fe1\u53f7\u521d\u59cb\u5316",(0,a.jsx)(n.br,{}),"\n","5.\u521d\u59cb\u5316BlockSig/UnBlockSig/StartupBlockSig",(0,a.jsx)(n.br,{}),"\n","6.\u975ePostmaster,\u5219\u68c0\u67e5\u6570\u636e\u5e93\u8def\u5f84/\u5207\u6362\u8def\u5f84/\u521b\u5efa\u9501\u5b9a\u6587\u4ef6\u7b49\u64cd\u4f5c",(0,a.jsx)(n.br,{}),"\n","7.\u8c03\u7528BaseInit\u6267\u884c\u57fa\u672c\u7684\u521d\u59cb\u5316",(0,a.jsx)(n.br,{}),"\n","8.\u8c03\u7528InitProcess/InitPostgres\u521d\u59cb\u5316\u8fdb\u7a0b",(0,a.jsx)(n.br,{}),"\n","9.\u91cd\u7f6e\u5185\u5b58\u4e0a\u4e0b\u6587,\u5904\u7406\u52a0\u8f7d\u5e93\u548c\u524d\u540e\u53f0\u6d88\u606f\u4ea4\u4e92\u7b49",(0,a.jsx)(n.br,{}),"\n","10.\u521d\u59cb\u5316\u5185\u5b58\u4e0a\u4e0b\u6587",(0,a.jsx)(n.br,{}),"\n","11.\u8fdb\u5165\u4e3b\u5faa\u73af",(0,a.jsx)(n.br,{}),"\n","11.1\u5207\u6362\u81f3MessageContext\u4e0a\u4e0b\u6587",(0,a.jsx)(n.br,{}),"\n","11.2\u521d\u59cb\u5316\u8f93\u5165\u7684\u6d88\u606f",(0,a.jsx)(n.br,{}),"\n","11.3\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u53ef\u4ee5\u6267\u884c\u67e5\u8be2\u7b49\u6d88\u606f",(0,a.jsx)(n.br,{}),"\n","11.4\u8bfb\u53d6\u547d\u4ee4",(0,a.jsx)(n.br,{}),"\n","11.5\u6839\u636e\u547d\u4ee4\u7c7b\u578b\u6267\u884c\u76f8\u5173\u64cd\u4f5c"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"/*\xa0----------------------------------------------------------------\n\xa0*\xa0PostgresMain\n\xa0*\xa0\xa0\xa0\xa0\xa0postgres\xa0main\xa0loop\xa0--\xa0all\xa0backends,\xa0interactive\xa0or\xa0otherwise\xa0start\xa0here\n\xa0*\xa0\xa0\xa0\xa0\xa0postgres\u4e3b\u5faa\u73af\xa0--\xa0\u6240\u6709\u7684\u4ea4\u4e92\u5f0f\u6216\u5176\u4ed6\u5f62\u5f0f\u7684\u540e\u53f0\u8fdb\u7a0b\u5728\u8fd9\u91cc\u542f\u52a8\xa0\n\xa0*\n\xa0*\xa0argc/argv\xa0are\xa0the\xa0command\xa0line\xa0arguments\xa0to\xa0be\xa0used.\xa0\xa0(When\xa0being\xa0forked\n\xa0*\xa0by\xa0the\xa0postmaster,\xa0these\xa0are\xa0not\xa0the\xa0original\xa0argv\xa0array\xa0of\xa0the\xa0process.)\n\xa0*\xa0dbname\xa0is\xa0the\xa0name\xa0of\xa0the\xa0database\xa0to\xa0connect\xa0to,\xa0or\xa0NULL\xa0if\xa0the\xa0database\n\xa0*\xa0name\xa0should\xa0be\xa0extracted\xa0from\xa0the\xa0command\xa0line\xa0arguments\xa0or\xa0defaulted.\n\xa0*\xa0username\xa0is\xa0the\xa0PostgreSQL\xa0user\xa0name\xa0to\xa0be\xa0used\xa0for\xa0the\xa0session.\n\xa0*\xa0argc/argv\u662f\u547d\u4ee4\u884c\u53c2\u6570(postmaster\xa0fork\u8fdb\u7a0b\u65f6,\u4e0d\u5b58\u5728\u539f\u6709\u7684\u8fdb\u7a0bargv\u6570\u7ec4).\n\xa0*\xa0dbname\u662f\u8fde\u63a5\u7684\u6570\u636e\u5e93\u540d\u79f0,\u5982\u9700\u8981\u4ece\u547d\u4ee4\u884c\u53c2\u6570\u4e2d\u89e3\u6790\u6216\u8005\u4e3a\u9ed8\u8ba4\u7684\u6570\u636e\u5e93\u540d\u79f0,\u5219\u4e3aNULL.\n\xa0*\xa0username\u662fPostgreSQL\u4f1a\u8bdd\u7684\u7528\u6237\u540d.\n\xa0*\xa0----------------------------------------------------------------\n\xa0*/\n/*\n\u8f93\u5165\uff1a\n\xa0\xa0\xa0\xa0argc/argv-Main\u51fd\u6570\u7684\u8f93\u5165\u53c2\u6570\n\xa0\xa0\xa0\xa0dbname-\u6570\u636e\u5e93\u540d\u79f0\n\xa0\xa0\xa0\xa0username-\u7528\u6237\u540d\n\u8f93\u51fa\uff1a\n\xa0\xa0\xa0\xa0\u65e0\n*/\nvoid\nPostgresMain(int\xa0argc,\xa0char\xa0*argv[],\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0const\xa0char\xa0*dbname,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0const\xa0char\xa0*username)\n{\n\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0firstchar;//\u4e34\u65f6\u53d8\u91cf\uff0c\u8bfb\u53d6\u8f93\u5165\u7684Command\n\xa0\xa0\xa0\xa0StringInfoData\xa0input_message;//\u5b57\u7b26\u4e32\u589e\u5f3a\u7ed3\u6784\u4f53\n\xa0\xa0\xa0\xa0sigjmp_buf\xa0\xa0local_sigjmp_buf;//\u7cfb\u7edf\u53d8\u91cf\n\xa0\xa0\xa0\xa0volatile\xa0bool\xa0send_ready_for_query\xa0=\xa0true;//\n\xa0\xa0\xa0\xa0bool\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0disable_idle_in_transaction_timeout\xa0=\xa0false;\n\xa0\xa0\xa0\xa0/*\xa0Initialize\xa0startup\xa0process\xa0environment\xa0if\xa0necessary.\xa0*/\n\xa0\xa0\xa0\xa0//\u5982\u9700\u8981,\u521d\u59cb\u5316\u542f\u52a8\u8fdb\u7a0b\u73af\u5883\n\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster//\u672a\u521d\u59cb\u5316\uff1finitialized\xa0for\xa0the\xa0bootstrap/standalone\xa0case\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitStandaloneProcess(argv[0]);//\u521d\u59cb\u5316\u8fdb\u7a0b\n\xa0\xa0\xa0\xa0SetProcessingMode(InitProcessing);//\u8bbe\u7f6e\u8fdb\u7a0b\u72b6\u6001\u4e3aInitProcessing\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Set\xa0default\xa0values\xa0for\xa0command-line\xa0options.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u8bbe\u7f6e\u547d\u4ee4\u884c\u9009\u9879\u9ed8\u8ba4\u503c\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitializeGUCOptions();//\u521d\u59cb\u5316GUC\u53c2\u6570\uff0cGUC=Grand\xa0Unified\xa0Configuration\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Parse\xa0command-line\xa0options.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u89e3\u6790\u547d\u4ee4\u884c\u9009\u9879\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0process_postgres_switches(argc,\xa0argv,\xa0PGC_POSTMASTER,\xa0&dbname);//\u89e3\u6790\u8f93\u5165\u53c2\u6570\n\xa0\xa0\xa0\xa0/*\xa0Must\xa0have\xa0gotten\xa0a\xa0database\xa0name,\xa0or\xa0have\xa0a\xa0default\xa0(the\xa0username)\xa0*/\n\xa0\xa0\xa0\xa0//\u5fc5\u987b\u5305\u542b\u6570\u636e\u5e93\u540d\u79f0\u6216\u8005\u5b58\u5728\u9ed8\u8ba4\u503c\n\xa0\xa0\xa0\xa0if\xa0(dbname\xa0==\xa0NULL)//\u8f93\u5165\u7684dbname\u4e3a\u7a7a\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0dbname\xa0=\xa0username;//\u8bbe\u7f6e\u4e3a\u7528\u6237\u540d\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(dbname\xa0==\xa0NULL)//\u5982\u4ecd\u4e3a\u7a7a\uff0c\u62a5\u9519\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ereport(FATAL,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0(errcode(ERRCODE_INVALID_PARAMETER_VALUE),\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0errmsg(\"%s:\xa0no\xa0database\xa0nor\xa0user\xa0name\xa0specified\",\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0progname)));\n\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0/*\xa0Acquire\xa0configuration\xa0parameters,\xa0unless\xa0inherited\xa0from\xa0postmaster\xa0*/\n\xa0\xa0\xa0\xa0//\u8bf7\u6c42\u914d\u7f6e\u53c2\u6570,\u9664\u975e\u4ecepostmaster\u4e2d\u7ee7\u627f\n\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!SelectConfigFiles(userDoption,\xa0progname))//\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6conf/hba\u6587\u4ef6&\u5b9a\u4f4d\u6570\u636e\u76ee\u5f55\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0proc_exit(1);\n\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Set\xa0up\xa0signal\xa0handlers\xa0and\xa0masks.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u914d\u7f6e\u4fe1\u53f7handlers\u548cmasks.\n\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0*\xa0Note\xa0that\xa0postmaster\xa0blocked\xa0all\xa0signals\xa0before\xa0forking\xa0child\xa0process,\n\xa0\xa0\xa0\xa0\xa0*\xa0so\xa0there\xa0is\xa0no\xa0race\xa0condition\xa0whereby\xa0we\xa0might\xa0receive\xa0a\xa0signal\xa0before\n\xa0\xa0\xa0\xa0\xa0*\xa0we\xa0have\xa0set\xa0up\xa0the\xa0handler.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u6ce8\u610f\u5728fork\u5b50\u8fdb\u7a0b\u524dpostmaster\u5df2\u963b\u585e\u4e86\u6240\u6709\u4fe1\u53f7,\n\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\xa0\u56e0\u6b64\u5c31\u7b97\u63a5\u6536\u5230\u4fe1\u53f7,\u4f46\u5728\u5b8c\u6210\u914d\u7f6ehandler\u524d\u4e0d\u4f1a\u5b58\u5728\u6761\u4ef6\u4e89\u7528.\n\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0*\xa0Also\xa0note:\xa0it's\xa0best\xa0not\xa0to\xa0use\xa0any\xa0signals\xa0that\xa0are\xa0SIG_IGNored\xa0in\xa0the\n\xa0\xa0\xa0\xa0\xa0*\xa0postmaster.\xa0\xa0If\xa0such\xa0a\xa0signal\xa0arrives\xa0before\xa0we\xa0are\xa0able\xa0to\xa0change\xa0the\n\xa0\xa0\xa0\xa0\xa0*\xa0handler\xa0to\xa0non-SIG_IGN,\xa0it'll\xa0get\xa0dropped.\xa0\xa0Instead,\xa0make\xa0a\xa0dummy\n\xa0\xa0\xa0\xa0\xa0*\xa0handler\xa0in\xa0the\xa0postmaster\xa0to\xa0reserve\xa0the\xa0signal.\xa0(Of\xa0course,\xa0this\xa0isn't\n\xa0\xa0\xa0\xa0\xa0*\xa0an\xa0issue\xa0for\xa0signals\xa0that\xa0are\xa0locally\xa0generated,\xa0such\xa0as\xa0SIGALRM\xa0and\n\xa0\xa0\xa0\xa0\xa0*\xa0SIGPIPE.)\n\xa0\xa0\xa0\xa0\xa0*\xa0\u540c\u65f6\u6ce8\u610f:\u6700\u597d\u4e0d\u8981\u4f7f\u7528\u5728postmaster\u4e2d\u6807\u8bb0\u4e3aSIG_IGNored\u7684\u4fe1\u53f7.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5982\u679c\u5728\u6539\u53d8\u5904\u7406\u5668\u4e3anon-SIG_IGN\u524d,\u63a5\u6536\u5230\u8fd9\u6837\u7684\u4fe1\u53f7,\u4f1a\u88ab\u6e05\u9664.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u76f8\u53cd,\u53ef\u4ee5\u5728postmaster\u4e2d\u521b\u5efadummy\xa0handler\u6765\u4fdd\u7559\u8fd9\u6837\u7684\u4fe1\u53f7.\n\xa0\xa0\xa0\xa0\xa0*\xa0(\u5f53\u7136,\u5bf9\u4e8e\u672c\u5730\u4ea7\u751f\u7684\u4fe1\u53f7,\u6bd4\u5982SIGALRM\u548cSIGPIPE,\u8fd9\u4e0d\u4f1a\u662f\u95ee\u9898)\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0if\xa0(am_walsender)//wal\xa0sender\u8fdb\u7a0b\uff1f\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0WalSndSignals();//\u5982\u679c\u662f\uff0c\u5219\u8c03\u7528WalSndSignals\n\xa0\xa0\xa0\xa0else//\u4e0d\u662fwal\xa0sender\u8fdb\u7a0b\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u8bbe\u7f6e\u6807\u8bb0,\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGHUP,\xa0PostgresSigHupHandler);\xa0\xa0\xa0\xa0/*\xa0set\xa0flag\xa0to\xa0read\xa0config\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0file\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u4e2d\u65ad\u4fe1\u53f7\u5904\u7406\u5668(\u4e2d\u65ad\u5f53\u524d\u67e5\u8be2)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGINT,\xa0StatementCancelHandler);\xa0\xa0\xa0/*\xa0cancel\xa0current\xa0query\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u7ec8\u6b62\u5f53\u524d\u67e5\u8be2\u5e76\u9000\u51fa\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGTERM,\xa0die);\xa0/*\xa0cancel\xa0current\xa0query\xa0and\xa0exit\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0In\xa0a\xa0standalone\xa0backend,\xa0SIGQUIT\xa0can\xa0be\xa0generated\xa0from\xa0the\xa0keyboard\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0easily,\xa0while\xa0SIGTERM\xa0cannot,\xa0so\xa0we\xa0make\xa0both\xa0signals\xa0do\xa0die()\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0rather\xa0than\xa0quickdie().\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5728standalone\u8fdb\u7a0b,SIGQUIT\u53ef\u5f88\u5bb9\u6613\u7684\u901a\u8fc7\u952e\u76d8\u751f\u6210,\u800cSIGTERM\u5219\u4e0d\u597d\u751f\u6210,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\xa0\u56e0\u6b64\u8ba9\u8fd9\u4e24\u4e2a\u4fe1\u53f7\u6267\u884cdie()\u800c\u4e0d\u662fquickdie().\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//bool\xa0IsUnderPostmaster\xa0=\xa0false\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(IsUnderPostmaster)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u60b2\u50ac\u65f6\u523b,\u6267\u884cquickdie()\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGQUIT,\xa0quickdie);\xa0\xa0\xa0\xa0/*\xa0hard\xa0crash\xa0time\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0else\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u6267\u884cdie()\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGQUIT,\xa0die);\xa0/*\xa0cancel\xa0current\xa0query\xa0and\xa0exit\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u5efa\u7acbSIGALRM\u5904\u7406\u5668\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitializeTimeouts();\xa0\xa0\xa0/*\xa0establishes\xa0SIGALRM\xa0handler\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Ignore\xa0failure\xa0to\xa0write\xa0to\xa0frontend.\xa0Note:\xa0if\xa0frontend\xa0closes\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0connection,\xa0we\xa0will\xa0notice\xa0it\xa0and\xa0exit\xa0cleanly\xa0when\xa0control\xa0next\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0returns\xa0to\xa0outer\xa0loop.\xa0\xa0This\xa0seems\xa0safer\xa0than\xa0forcing\xa0exit\xa0in\xa0the\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0midst\xa0of\xa0output\xa0during\xa0who-knows-what\xa0operation...\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5ffd\u7565\u5199\u5165\u524d\u7aef\u7684\u9519\u8bef.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u6ce8\u610f:\u5982\u679c\u524d\u7aef\u5173\u95ed\u4e86\u8fde\u63a5,\u4f1a\u901a\u77e5\u5e76\u5728\u7a7a\u4e2d\u4e0b\u4e00\u6b21\u8fd4\u56de\u7ed9\u5916\u5c42\u5faa\u73af\u65f6\u9000\u51fa.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u8fd9\u770b\u8d77\u6765\u4f1a\u6bd4\u5728who-knows-what\u64cd\u4f5c\u671f\u95f4\u5f3a\u5236\u9000\u51fa\u5b89\u5168\u4e00\u4e9b.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGPIPE,\xa0SIG_IGN);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGUSR1,\xa0procsignal_sigusr1_handler);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGUSR2,\xa0SIG_IGN);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGFPE,\xa0FloatExceptionHandler);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Reset\xa0some\xa0signals\xa0that\xa0are\xa0accepted\xa0by\xa0postmaster\xa0but\xa0not\xa0by\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0backend\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u91cd\u7f6e\u4e00\u4e9bpostmaster\u63a5\u6536\u800c\u540e\u53f0\u8fdb\u7a0b\u4e0d\u4f1a\u63a5\u6536\u7684\u4fe1\u53f7\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u5728\u67d0\u4e9b\u5e73\u53f0\u4e0a,system()\u9700\u8981\u8fd9\u4e2a\u4fe1\u53f7\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqsignal(SIGCHLD,\xa0SIG_DFL);\xa0/*\xa0system()\xa0requires\xa0this\xa0on\xa0some\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0platforms\xa0*/\n\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0//\u521d\u59cb\u5316BlockSig/UnBlockSig/StartupBlockSig\n\xa0\xa0\xa0\xa0pqinitmask();//Initialize\xa0BlockSig,\xa0UnBlockSig,\xa0and\xa0StartupBlockSig.\n\xa0\xa0\xa0\xa0if\xa0(IsUnderPostmaster)\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0We\xa0allow\xa0SIGQUIT\xa0(quickdie)\xa0at\xa0all\xa0times\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u653e\u5f00SIGQUIT(quickdie)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0sigdelset(&BlockSig,\xa0SIGQUIT);\n\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0//\u9664\u4e86SIGQUIT,\u963b\u585e\u5176\u4ed6\n\xa0\xa0\xa0\xa0PG_SETMASK(&BlockSig);\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0block\xa0everything\xa0except\xa0SIGQUIT\xa0*/\n\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Validate\xa0we\xa0have\xa0been\xa0given\xa0a\xa0reasonable-looking\xa0DataDir\xa0(if\xa0under\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0postmaster,\xa0assume\xa0postmaster\xa0did\xa0this\xa0already).\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u9a8c\u8bc1\u5df2\u7ed9\u51fa\u4e86reasonable-looking\xa0DataDir\xa0\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(\u5982\u5728postmaster\u4e0b,\u5047\u5b9apostmaster\u5df2\u5b8c\u6210\u4e86\u8fd9\u4e2a\u4e8b\u60c5)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0checkDataDir();//\u786e\u8ba4\u6570\u636e\u5e93\u8def\u5f84OK\uff0c\u4f7f\u7528stat\u547d\u4ee4\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Change\xa0into\xa0DataDir\xa0(if\xa0under\xa0postmaster,\xa0was\xa0done\xa0already)\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u5207\u6362\u81f3\u6570\u636e\u5e93\u8def\u5f84\uff0c\u4f7f\u7528chdir\u547d\u4ee4\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ChangeToDataDir();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Create\xa0lockfile\xa0for\xa0data\xa0directory.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u521b\u5efa\u9501\u5b9a\u6587\u4ef6\uff0cCreateLockFile(DIRECTORY_LOCK_FILE,\xa0amPostmaster,\xa0\"\",\xa0true,\xa0DataDir);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0CreateDataDirLockFile(false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0read\xa0control\xa0file\xa0(error\xa0checking\xa0and\xa0contains\xa0config\xa0)\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u8bfb\u53d6\u63a7\u5236\u6587\u4ef6(\u9519\u8bef\u68c0\u67e5\u548c\u5305\u542b\u914d\u7f6e)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0LocalProcessControlFile(false);//Read\xa0the\xa0control\xa0file,\xa0set\xa0respective\xa0GUCs.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Initialize\xa0MaxBackends\xa0(if\xa0under\xa0postmaster,\xa0was\xa0done\xa0already)\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u4ece\u914d\u7f6e\u9009\u9879\u4e2d\u521d\u59cb\u5316MaxBackends\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitializeMaxBackends();//Initialize\xa0MaxBackends\xa0value\xa0from\xa0config\xa0options.\n\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0/*\xa0Early\xa0initialization\xa0*/\n\xa0\xa0\xa0\xa0BaseInit();//\u6267\u884c\u57fa\u672c\u7684\u521d\u59cb\u5316\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Create\xa0a\xa0per-backend\xa0PGPROC\xa0struct\xa0in\xa0shared\xa0memory,\xa0except\xa0in\xa0the\n\xa0\xa0\xa0\xa0\xa0*\xa0EXEC_BACKEND\xa0case\xa0where\xa0this\xa0was\xa0done\xa0in\xa0SubPostmasterMain.\xa0We\xa0must\xa0do\n\xa0\xa0\xa0\xa0\xa0*\xa0this\xa0before\xa0we\xa0can\xa0use\xa0LWLocks\xa0(and\xa0in\xa0the\xa0EXEC_BACKEND\xa0case\xa0we\xa0already\n\xa0\xa0\xa0\xa0\xa0*\xa0had\xa0to\xa0do\xa0some\xa0stuff\xa0with\xa0LWLocks).\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u521b\u5efa\u6bcf\u4e2abackend\u90fd\u6709\u7684PGPROC\u7ed3\u6784\u4f53,\u9664\u4e86\u5728SubPostmasterMain\u7684EXEC_BACKEND\u60c5\u51b5.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5728\u53ef\u4ee5\u4f7f\u7528LWLocks\u524d\u5fc5\u987b\u6267\u884c\u8be5\u64cd\u4f5c.\n\xa0\xa0\xa0\xa0\xa0*\xa0(\u5728EXEC_BACKEND\u4e2d,\u5df2\u4f7f\u7528\u4e86LWLocks\u6267\u884c\u8fd9\u4e2a\u573a\u666f)\n\xa0\xa0\xa0\xa0\xa0*/\n//\xa0initialize\xa0a\xa0per-process\xa0data\xa0structure\xa0for\xa0this\xa0backend\n#ifdef\xa0EXEC_BACKEND\n\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitProcess();\n#else\n\xa0\xa0\xa0\xa0InitProcess();\n#endif\n\xa0\xa0\xa0\xa0/*\xa0We\xa0need\xa0to\xa0allow\xa0SIGINT,\xa0etc\xa0during\xa0the\xa0initial\xa0transaction\xa0*/\n\xa0\xa0\xa0\xa0//\u5728\u521d\u59cb\u5316\u4e8b\u52a1\u671f\u95f4\u9700\u8981\u5141\u8bb8SIGINT\u7b49\u7b49\n\xa0\xa0\xa0\xa0PG_SETMASK(&UnBlockSig);\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0General\xa0initialization.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5e38\u89c4\u7684\u521d\u59cb\u5316.\n\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0*\xa0NOTE:\xa0if\xa0you\xa0are\xa0tempted\xa0to\xa0add\xa0code\xa0in\xa0this\xa0vicinity,\xa0consider\xa0putting\n\xa0\xa0\xa0\xa0\xa0*\xa0it\xa0inside\xa0InitPostgres()\xa0instead.\xa0\xa0In\xa0particular,\xa0anything\xa0that\n\xa0\xa0\xa0\xa0\xa0*\xa0involves\xa0database\xa0access\xa0should\xa0be\xa0there,\xa0not\xa0here.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u6ce8\u610f:\u5982\u679c\u5e0c\u671b\u5728\u6b64\u5904\u6dfb\u52a0\u4ee3\u7801,\u8bf7\u8003\u8651\u5c06\u5176\u653e\u5165InitPostgres()\u4e2d.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u7279\u522b\u7684,\u4efb\u4f55\u6d89\u53ca\u5230\u6570\u636e\u5e93\u8bbf\u95ee\u7684\u5185\u5bb9\u90fd\u5e94\u8be5\u5728InitPostgres\u4e2d,\u800c\u4e0d\u662f\u5728\u8fd9\u91cc.\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0InitPostgres(dbname,\xa0InvalidOid,\xa0username,\xa0InvalidOid,\xa0NULL,\xa0false);//Initialize\xa0POSTGRES\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0If\xa0the\xa0PostmasterContext\xa0is\xa0still\xa0around,\xa0recycle\xa0the\xa0space;\xa0we\xa0don't\n\xa0\xa0\xa0\xa0\xa0*\xa0need\xa0it\xa0anymore\xa0after\xa0InitPostgres\xa0completes.\xa0\xa0Note\xa0this\xa0does\xa0not\xa0trash\n\xa0\xa0\xa0\xa0\xa0*\xa0*MyProcPort,\xa0because\xa0ConnCreate()\xa0allocated\xa0that\xa0space\xa0with\xa0malloc()\n\xa0\xa0\xa0\xa0\xa0*\xa0...\xa0else\xa0we'd\xa0need\xa0to\xa0copy\xa0the\xa0Port\xa0data\xa0first.\xa0\xa0Also,\xa0subsidiary\xa0data\n\xa0\xa0\xa0\xa0\xa0*\xa0such\xa0as\xa0the\xa0username\xa0isn't\xa0lost\xa0either;\xa0see\xa0ProcessStartupPacket().\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5982\u679cPostmasterContext\u4ecd\u7136\u5b58\u5728,\u56de\u6536\u7a7a\u95f4;\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5728InitPostgres\u5b8c\u6210\u540e,\u6211\u4eec\u4e0d\u518d\u9700\u8981\u8fd9\u4e9b\u7a7a\u95f4.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u6ce8\u610f:\u8fd9\u4e2a\u64cd\u4f5c\u4e0d\u4f1a\u56de\u6536*MyProcPort,\u56e0\u4e3aConnCreate()\u5206\u914d\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0if\xa0(PostmasterContext)\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextDelete(PostmasterContext);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0PostmasterContext\xa0=\xa0NULL;\n\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0//\u5b8c\u6210\u521d\u59cb\u5316\u540e\uff0c\u8bbe\u7f6e\u8fdb\u7a0b\u6a21\u5f0f\u4e3aNormalProcessing\n\xa0\xa0\xa0\xa0SetProcessingMode(NormalProcessing);\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Now\xa0all\xa0GUC\xa0states\xa0are\xa0fully\xa0set\xa0up.\xa0\xa0Report\xa0them\xa0to\xa0client\xa0if\n\xa0\xa0\xa0\xa0\xa0*\xa0appropriate.\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0//Report\xa0GUC\n\xa0\xa0\xa0\xa0BeginReportingGUCOptions();\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Also\xa0set\xa0up\xa0handler\xa0to\xa0log\xa0session\xa0end;\xa0we\xa0have\xa0to\xa0wait\xa0till\xa0now\xa0to\xa0be\n\xa0\xa0\xa0\xa0\xa0*\xa0sure\xa0Log_disconnections\xa0has\xa0its\xa0final\xa0value.\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0//\u8bbe\u7f6e\u5904\u7406\u5668,\u7528\u4e8e\u8bb0\u5f55\u4f1a\u8bdd\u7ed3\u675f;\n\xa0\xa0\xa0\xa0//\u7b49\u5f85\u76f4\u81f3\u786e\u4fddLog_disconnections\u6700\u7ec8\u6709\u503c\u5b58\u5728\n\xa0\xa0\xa0\xa0if\xa0(IsUnderPostmaster\xa0&&\xa0Log_disconnections)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0on_proc_exit(log_disconnections,\xa00);//this\xa0function\xa0adds\xa0a\xa0callback\xa0function\xa0to\xa0the\xa0list\xa0of\xa0functions\xa0invoked\xa0by\xa0proc_exit()\n\xa0\xa0\xa0\xa0/*\xa0Perform\xa0initialization\xa0specific\xa0to\xa0a\xa0WAL\xa0sender\xa0process.\xa0*/\n\xa0\xa0\xa0\xa0//\u4e3aWAL\xa0sender\u8fdb\u7a0b\u6267\u884c\u7279\u522b\u7684\u521d\u59cb\u5316\n\xa0\xa0\xa0\xa0if\xa0(am_walsender)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitWalSender();//\u521d\u59cb\u5316\xa0WAL\xa0sender\xa0process\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0process\xa0any\xa0libraries\xa0that\xa0should\xa0be\xa0preloaded\xa0at\xa0backend\xa0start\xa0(this\n\xa0\xa0\xa0\xa0\xa0*\xa0likewise\xa0can't\xa0be\xa0done\xa0until\xa0GUC\xa0settings\xa0are\xa0complete)\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5904\u7406\u5728\u540e\u53f0\u8fdb\u7a0b\u542f\u52a8\u65f6\u9700\u8981\u63d0\u524d\u9884\u88c5\u8f7d\u7684\u5e93(\u8fd9\u4e2a\u6b65\u9aa4\u5728GUC\u914d\u7f6e\u5b8c\u6210\u540e\u624d\u80fd\u591f\u6267\u884c)\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0process_session_preload_libraries();//\u52a0\u8f7dLIB\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Send\xa0this\xa0backend's\xa0cancellation\xa0info\xa0to\xa0the\xa0frontend.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u53d1\u9001\u540e\u7aef\u7684\u53d6\u6d88\u4fe1\u606f\u5230\u524d\u53f0\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0if\xa0(whereToSendOutput\xa0==\xa0DestRemote)\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0StringInfoData\xa0buf;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_beginmessage(&buf,\xa0'K');\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_sendint32(&buf,\xa0(int32)\xa0MyProcPid);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_sendint32(&buf,\xa0(int32)\xa0MyCancelKey);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_endmessage(&buf);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Need\xa0not\xa0flush\xa0since\xa0ReadyForQuery\xa0will\xa0do\xa0it.\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u4e0d\u9700\u8981flush,\u56e0\u4e3aReadyForQuery\u4f1a\u6267\u884c\u8be5\u64cd\u4f5c\n\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0/*\xa0Welcome\xa0banner\xa0for\xa0\xa0case\xa0*/\n\xa0\xa0\xa0\xa0//standalone\u7684\u6b22\u8fce\u4fe1\u606f\n\xa0\xa0\xa0\xa0if\xa0(whereToSendOutput\xa0==\xa0DestDebug)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0printf(\"\\nPostgreSQL\xa0stand-alone\xa0backend\xa0%s\\n\",\xa0PG_VERSION);\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Create\xa0the\xa0memory\xa0context\xa0we\xa0will\xa0use\xa0in\xa0the\xa0main\xa0loop.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u521b\u5efa\u4e3b\u5faa\u73af\u4e2d\u4f7f\u7528\u7684\u5185\u5b58\u4e0a\u4e0b\u6587\n\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0*\xa0MessageContext\xa0is\xa0reset\xa0once\xa0per\xa0iteration\xa0of\xa0the\xa0main\xa0loop,\xa0ie,\xa0upon\n\xa0\xa0\xa0\xa0\xa0*\xa0completion\xa0of\xa0processing\xa0of\xa0each\xa0command\xa0message\xa0from\xa0the\xa0client.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u4e3b\u5faa\u73af\u4e2d,\u6bcf\u4e00\u6b21\u8fed\u4ee3\u90fd\u4f1a\u91cd\u7f6eMessageContext,\u6bd4\u5982\u5b8c\u6210\u4e86\u6bcf\u4e2a\u547d\u4ee4\u7684\u5904\u7406,\u5df2\u4ece\u5ba2\u6237\u7aef\u8fd4\u56de\u4e86\u4fe1\u606f\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0//\u521d\u59cb\u5316\u5185\u5b58\u4e0a\u4e0b\u6587\uff1aMessageContext\n\xa0\xa0\xa0\xa0MessageContext\xa0=\xa0AllocSetContextCreate(TopMemoryContext,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\"MessageContext\",\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ALLOCSET_DEFAULT_SIZES);\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Create\xa0memory\xa0context\xa0and\xa0buffer\xa0used\xa0for\xa0RowDescription\xa0messages.\xa0As\n\xa0\xa0\xa0\xa0\xa0*\xa0SendRowDescriptionMessage(),\xa0via\xa0exec_describe_statement_message(),\xa0is\n\xa0\xa0\xa0\xa0\xa0*\xa0frequently\xa0executed\xa0for\xa0ever\xa0single\xa0statement,\xa0we\xa0don't\xa0want\xa0to\n\xa0\xa0\xa0\xa0\xa0*\xa0allocate\xa0a\xa0separate\xa0buffer\xa0every\xa0time.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u521b\u5efaRowDescription\u6d88\u606f\u7684\u5185\u5b58\u4e0a\u4e0b\u6587\u548c\u7f13\u5b58.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u6bcf\u4e00\u6761\u5355\u72ec\u7684\u8bed\u53e5\u6267\u884c\u65f6\u90fd\u4f1a\u9891\u7e41\u7684\u901a\u8fc7exec_describe_statement_message()\u51fd\u6570\n\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\xa0\u8c03\u7528SendRowDescriptionMessage(),\u4e0d\u5e0c\u671b\u5728\u6bcf\u6b21\u90fd\u5206\u914d\u5355\u72ec\u7684\u7f13\u5b58.\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0//TODO\xa0\u4f20\u8f93RowDescription\xa0messages\uff1f\n\xa0\xa0\xa0\xa0row_description_context\xa0=\xa0AllocSetContextCreate(TopMemoryContext,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\"RowDescriptionContext\",\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ALLOCSET_DEFAULT_SIZES);\n\xa0\xa0\xa0\xa0MemoryContextSwitchTo(row_description_context);\n\xa0\xa0\xa0\xa0initStringInfo(&row_description_buf);\n\xa0\xa0\xa0\xa0MemoryContextSwitchTo(TopMemoryContext);\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Remember\xa0stand-alone\xa0backend\xa0startup\xa0time\n\xa0\xa0\xa0\xa0\xa0*\xa0\u8bb0\u5f55stand-alone\u540e\u53f0\u8fdb\u7a0b\u7684\u542f\u52a8\u65f6\u95f4\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0PgStartTime\xa0=\xa0GetCurrentTimestamp();//\u8bb0\u5f55\u542f\u52a8\u65f6\u95f4\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0POSTGRES\xa0main\xa0processing\xa0loop\xa0begins\xa0here\n\xa0\xa0\xa0\xa0\xa0*\xa0POSTGRES\u7684\u4e3b\u5904\u7406\u5faa\u73af\u5728\u8fd9\u91cc\u5f00\u59cb\n\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0*\xa0If\xa0an\xa0exception\xa0is\xa0encountered,\xa0processing\xa0resumes\xa0here\xa0so\xa0we\xa0abort\xa0the\n\xa0\xa0\xa0\xa0\xa0*\xa0current\xa0transaction\xa0and\xa0start\xa0a\xa0new\xa0one.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5982\u679c\u51fa\u73b0\u4e86\u5f02\u5e38,\u5904\u7406\u8fc7\u7a0b\u4f1a\u5728\u8fd9\u91cc\u6062\u590d\u56e0\u6b64PG\u53ef\u4ee5\u56de\u6eda\u5f53\u524d\u4e8b\u52a1\u5e76\u542f\u52a8\u65b0\u4e8b\u52a1\n\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0*\xa0You\xa0might\xa0wonder\xa0why\xa0this\xa0isn't\xa0coded\xa0as\xa0an\xa0infinite\xa0loop\xa0around\xa0a\n\xa0\xa0\xa0\xa0\xa0*\xa0PG_TRY\xa0construct.\xa0\xa0The\xa0reason\xa0is\xa0that\xa0this\xa0is\xa0the\xa0bottom\xa0of\xa0the\n\xa0\xa0\xa0\xa0\xa0*\xa0exception\xa0stack,\xa0and\xa0so\xa0with\xa0PG_TRY\xa0there\xa0would\xa0be\xa0no\xa0exception\xa0handler\n\xa0\xa0\xa0\xa0\xa0*\xa0in\xa0force\xa0at\xa0all\xa0during\xa0the\xa0CATCH\xa0part.\xa0\xa0By\xa0leaving\xa0the\xa0outermost\xa0setjmp\n\xa0\xa0\xa0\xa0\xa0*\xa0always\xa0active,\xa0we\xa0have\xa0at\xa0least\xa0some\xa0chance\xa0of\xa0recovering\xa0from\xa0an\xa0error\n\xa0\xa0\xa0\xa0\xa0*\xa0during\xa0error\xa0recovery.\xa0\xa0(If\xa0we\xa0get\xa0into\xa0an\xa0infinite\xa0loop\xa0thereby,\xa0it\n\xa0\xa0\xa0\xa0\xa0*\xa0will\xa0soon\xa0be\xa0stopped\xa0by\xa0overflow\xa0of\xa0elog.c's\xa0internal\xa0state\xa0stack.)\n\xa0\xa0\xa0\xa0\xa0*\xa0\u4f60\u53ef\u80fd\u4f1a\u5bf9\u8fd9\u91cc\u4e0d\u7528PG_TRY\u6784\u9020\u4e00\u4e2a\u65e0\u9650\u5faa\u73af\u611f\u5230\u56f0\u60d1.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u7406\u7531\u662f\u8fd9\u662f\u5f02\u5e38\u6808\u7684\u5e95,\u56e0\u6b64\u5728\u8fd9\u91cc\u4f7f\u7528PG_TRY\u4f1a\u5bfc\u81f4\u5728CATCH\u90e8\u5206\u6ca1\u6709\u4efb\u4f55\u7684\u5f02\u5e38\u5904\u7406\u5668.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u901a\u8fc7\u8ba9\u6700\u5916\u5c42\u7684setjmp\u59cb\u7ec8\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001,\u6211\u4eec\u8d77\u7801\u6709\u673a\u4f1a\u5728\u9519\u8bef\u6062\u590d\u7684\u9519\u8bef\u4e2d\u8fdb\u884c\u6062\u590d.\n\xa0\xa0\xa0\xa0\xa0*\xa0(\u5982\u679c\u8fdb\u5165\u4e86\u65e0\u7ebf\u5faa\u73af,\u4f1a\u5f88\u5feb\u56e0\u4e3aelog's\u5185\u90e8\u72b6\u6001\u6808\u7684\u6ea2\u51fa\u800c\u505c\u6b62)\n\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0*\xa0Note\xa0that\xa0we\xa0use\xa0sigsetjmp(...,\xa01),\xa0so\xa0that\xa0this\xa0function's\xa0signal\xa0mask\n\xa0\xa0\xa0\xa0\xa0*\xa0(to\xa0wit,\xa0UnBlockSig)\xa0will\xa0be\xa0restored\xa0when\xa0longjmp'ing\xa0to\xa0here.\xa0\xa0This\n\xa0\xa0\xa0\xa0\xa0*\xa0is\xa0essential\xa0in\xa0case\xa0we\xa0longjmp'd\xa0out\xa0of\xa0a\xa0signal\xa0handler\xa0on\xa0a\xa0platform\n\xa0\xa0\xa0\xa0\xa0*\xa0where\xa0that\xa0leaves\xa0the\xa0signal\xa0blocked.\xa0\xa0It's\xa0not\xa0redundant\xa0with\xa0the\n\xa0\xa0\xa0\xa0\xa0*\xa0unblock\xa0in\xa0AbortTransaction()\xa0because\xa0the\xa0latter\xa0is\xa0only\xa0called\xa0if\xa0we\n\xa0\xa0\xa0\xa0\xa0*\xa0were\xa0inside\xa0a\xa0transaction.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u6ce8\u610f\u6211\u4eec\u4f7f\u7528sigsetjmp(...,1),\n\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\xa0\u4ee5\u4fbf\u8be5\u51fd\u6570\u7684\u4fe1\u53f7mask(\u4e5f\u5c31\u662f\u8bf4,UnBlockSig)\u5728longjmp\u5230\u8fd9\u91cc\u7684\u65f6\u5019\u53ef\u4ee5\u88ab\u8fd8\u539f.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u5728\u67d0\u4e2a\u8ba9\u4fe1\u53f7\u7ee7\u7eed\u963b\u585e\u7684\u5e73\u53f0\u4e0a\u901a\u8fc7longjmp\u8df3\u51fa\u4fe1\u53f7\u5904\u7406\u5668\u65f6\u8fd9\u6837\u7684\u5904\u7406\u662f\u9700\u8981\u7684.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u8fd9\u4e0eAbortTransaction()\u8bbe\u7f6eunblock\u5e76\u4e0d\u591a\u4f59\u56e0\u4e3a\u5982\u679c\u6211\u4eec\u5728\u4e8b\u52a1\u4e2d\u4fdd\u8bc1\u53ea\u6267\u884c\u4e86\u4e00\u6b21.\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0if\xa0(sigsetjmp(local_sigjmp_buf,\xa01)\xa0!=\xa00)//\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0NOTE:\xa0if\xa0you\xa0are\xa0tempted\xa0to\xa0add\xa0more\xa0code\xa0in\xa0this\xa0if-block,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0consider\xa0the\xa0high\xa0probability\xa0that\xa0it\xa0should\xa0be\xa0in\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0AbortTransaction()\xa0instead.\xa0\xa0The\xa0only\xa0stuff\xa0done\xa0directly\xa0here\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0should\xa0be\xa0stuff\xa0that\xa0is\xa0guaranteed\xa0to\xa0apply\xa0*only*\xa0for\xa0outer-level\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0error\xa0recovery,\xa0such\xa0as\xa0adjusting\xa0the\xa0FE/BE\xa0protocol\xa0status.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u6ce8\u610f:\u5982\u679c\u4f60\u5e0c\u671b\u5728if-block\u4e2d\u6dfb\u52a0\u4ee3\u7801,\u5efa\u8bae\u5728AbortTransaction()\u4e2d\u6dfb\u52a0.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u76f4\u63a5\u6dfb\u52a0\u5728\u8fd9\u91cc\u7684\u552f\u4e00\u7406\u7531\u662f\u53ef\u4ee5\u5e94\u7528\u5bf9\u9ad8\u5c42\u7684\u9519\u8bef\u6062\u590d,\u6bd4\u5982\u8c03\u6574FE/BE\u534f\u8bae\u72b6\u6001.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Since\xa0not\xa0using\xa0PG_TRY,\xa0must\xa0reset\xa0error\xa0stack\xa0by\xa0hand\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u4e0d\u4f7f\u7528PG_TRY,\u5fc5\u987b\u91cd\u7f6e\u9519\u8bef\u6808\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0error_context_stack\xa0=\xa0NULL;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Prevent\xa0interrupts\xa0while\xa0cleaning\xa0up\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u6e05\u7406\u65f6\u7981\u6b62\u4e2d\u65ad\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0HOLD_INTERRUPTS();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Forget\xa0any\xa0pending\xa0QueryCancel\xa0request,\xa0since\xa0we're\xa0returning\xa0to\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0the\xa0idle\xa0loop\xa0anyway,\xa0and\xa0cancel\xa0any\xa0active\xa0timeout\xa0requests.\xa0\xa0(In\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0future\xa0we\xa0might\xa0want\xa0to\xa0allow\xa0some\xa0timeout\xa0requests\xa0to\xa0survive,\xa0but\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0at\xa0minimum\xa0it'd\xa0be\xa0necessary\xa0to\xa0do\xa0reschedule_timeouts(),\xa0in\xa0case\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0we\xa0got\xa0here\xa0because\xa0of\xa0a\xa0query\xa0cancel\xa0interrupting\xa0the\xa0SIGALRM\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0interrupt\xa0handler.)\xa0\xa0Note\xa0in\xa0particular\xa0that\xa0we\xa0must\xa0clear\xa0the\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0statement\xa0and\xa0lock\xa0timeout\xa0indicators,\xa0to\xa0prevent\xa0any\xa0future\xa0plain\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0query\xa0cancels\xa0from\xa0being\xa0misreported\xa0as\xa0timeouts\xa0in\xa0case\xa0we're\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0forgetting\xa0a\xa0timeout\xa0cancel.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5e9f\u5f03\u6b63\u5728\u5904\u7406\u4e2dQueryCancel\u8bf7\u6c42,\u56e0\u4e3a\u8fdb\u7a0b\u4f1a\u8fd4\u56de\u5230\u7a7a\u95f2\u5faa\u73af\u4e2d,\u540c\u65f6\u53d6\u6d88\u6240\u6709\u6d3b\u52a8\u7684\u8d85\u65f6\u8bf7\u6c42.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(\u5728\u672a\u6765,\u6211\u4eec\u53ef\u80fd\u5e0c\u671b\u8fd0\u884c\u67d0\u4e9b\u8d85\u65f6\u8bf7\u6c42\u4ecd\u7136\u5b58\u6d3b,\u4f46\u6700\u8d77\u7801\u6709\u9700\u8981\u6267\u884creschedule_timeouts(),\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5230\u8fbe\u8fd9\u91cc\u7684\u539f\u56e0\u662f\u67e5\u8be2\u53d6\u6d88\u662f\u901a\u8fc7SIGALRM\u7ec8\u7aef\u5904\u7406\u5668\u4e2d\u65ad\u7684).\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u6ce8\u610f\u7279\u522b\u7684,\u5fc5\u987b\u6e05\u7406\u8bed\u53e5\u548c\u9501\u8d85\u65f6\u63d0\u793a\u5668,\u5df2\u907f\u514d\u5728\u53d6\u6d88\u8d85\u65f6\u540e\u540e\u7eed\u7684\u666e\u901a\u67e5\u8be2\u51fa\u73b0\u8d85\u65f6\u65f6\u6ca1\u6709\u62a5\u544a.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0disable_all_timeouts(false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0QueryCancelPending\xa0=\xa0false;\xa0/*\xa0second\xa0to\xa0avoid\xa0race\xa0condition\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0stmt_timeout_active\xa0=\xa0false;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Not\xa0reading\xa0from\xa0the\xa0client\xa0anymore.\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u4e0d\u518d\u4ece\u5ba2\u6237\u7aef\u8bfb\u53d6\u4fe1\u606f\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0DoingCommandRead\xa0=\xa0false;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Make\xa0sure\xa0libpq\xa0is\xa0in\xa0a\xa0good\xa0state\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u786e\u4fddlibq\u72b6\u6001OK\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_comm_reset();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Report\xa0the\xa0error\xa0to\xa0the\xa0client\xa0and/or\xa0server\xa0log\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u5411\u5ba2\u6237\u7aef\u548c/\u6216\u670d\u52a1\u5668\u65e5\u5fd7\u62a5\u544a\u9519\u8bef\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0EmitErrorReport();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Make\xa0sure\xa0debug_query_string\xa0gets\xa0reset\xa0before\xa0we\xa0possibly\xa0clobber\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0the\xa0storage\xa0it\xa0points\xa0at.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u786e\u4fdddebug_query_string\u5728\u53ef\u80fd\u7834\u574f\u5b83\u6240\u6307\u5411\u7684\u5b58\u50a8\u4e4b\u524d\u91cd\u7f6e\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0debug_query_string\xa0=\xa0NULL;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Abort\xa0the\xa0current\xa0transaction\xa0in\xa0order\xa0to\xa0recover.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u53d6\u6d88\u5f53\u524d\u4e8b\u52a1\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0AbortCurrentTransaction();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(am_walsender)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u5982\u4e3awalsender,\u5219\u6267\u884c\u6e05\u7406\u5de5\u4f5c\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0WalSndErrorCleanup();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u9519\u8bef\u6e05\u7406\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0PortalErrorCleanup();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SPICleanup();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0We\xa0can't\xa0release\xa0replication\xa0slots\xa0inside\xa0AbortTransaction()\xa0as\xa0we\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0need\xa0to\xa0be\xa0able\xa0to\xa0start\xa0and\xa0abort\xa0transactions\xa0while\xa0having\xa0a\xa0slot\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0acquired.\xa0But\xa0we\xa0never\xa0need\xa0to\xa0hold\xa0them\xa0across\xa0top\xa0level\xa0errors,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0so\xa0releasing\xa0here\xa0is\xa0fine.\xa0There's\xa0another\xa0cleanup\xa0in\xa0ProcKill()\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0ensuring\xa0we'll\xa0correctly\xa0cleanup\xa0on\xa0FATAL\xa0errors\xa0as\xa0well.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5728AbortTransaction()\u4e2d\u4e0d\u80fd\u91ca\u653ereplication\xa0slots\u56e0\u4e3a\u9700\u8981\u5728\u6301\u6709slot\u65f6\u542f\u52a8\u548c\u56de\u6eda\u4e8b\u52a1.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u4f46\u4e0d\u9650\u4e8e\u5728\u9876\u5c42\u51fa\u73b0\u9519\u8bef\u65f6\u6301\u6709\u8fd9\u4e9bslots,\u56e0\u6b64\u5728\u8fd9\u91cc\u91ca\u653e\u8fd9\u4e9bslots\u662fOK\u7684.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u8fd9\u91cc\u5728ProcKill()\u4e2d\u5b58\u5728\u53e6\u5916\u4e00\u4e2a\u6e05\u7406\u786e\u4fdd\u6211\u4eec\u53ef\u4ee5\u5728FATAL\u9519\u8bef\u4e2d\u6b63\u786e\u7684\u6062\u590d.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(MyReplicationSlot\xa0!=\xa0NULL)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ReplicationSlotRelease();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0We\xa0also\xa0want\xa0to\xa0cleanup\xa0temporary\xa0slots\xa0on\xa0error.\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u51fa\u73b0\u9519\u8bef\u65f6,\u6e05\u7406\u4e34\u65f6slots\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ReplicationSlotCleanup();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u91cd\u7f6eJIT\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0jit_reset_after_error();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Now\xa0return\xa0to\xa0normal\xa0top-level\xa0context\xa0and\xa0clear\xa0ErrorContext\xa0for\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0next\xa0time.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u73b0\u5728\u53ef\u4ee5\u56de\u5230\u6b63\u5e38\u7684\u9876\u5c42\u4e0a\u4e0b\u6587\u4e2d\u5e76\u4e3a\u4e0b\u6b21\u5faa\u73af\u6e05\u7406ErrorContext\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextSwitchTo(TopMemoryContext);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0FlushErrorState();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0If\xa0we\xa0were\xa0handling\xa0an\xa0extended-query-protocol\xa0message,\xa0initiate\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0skip\xa0till\xa0next\xa0Sync.\xa0\xa0This\xa0also\xa0causes\xa0us\xa0not\xa0to\xa0issue\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0ReadyForQuery\xa0(until\xa0we\xa0get\xa0Sync).\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5982\u679c\u6211\u4eec\u6b63\u5728\u5904\u7406extended-query-protocol\u6d88\u606f,\u542f\u52a8\u8df3\u8fc7\u76f4\u81f3\u4e0b\u6b21Sync.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u8fd9\u540c\u65f6\u4f1a\u5bfc\u81f4\u6211\u4eec\u4e0d\u4f1a\u89e6\u53d1ReadyForQuery(\u76f4\u81f3\u63a5\u6536\u5230Sync)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(doing_extended_query_message)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ignore_till_sync\xa0=\xa0true;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0We\xa0don't\xa0have\xa0a\xa0transaction\xa0command\xa0open\xa0anymore\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u4e0d\u518d\u6709\u6253\u5f00\u7684\u4e8b\u52a1\u547d\u4ee4\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0xact_started\xa0=\xa0false;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0If\xa0an\xa0error\xa0occurred\xa0while\xa0we\xa0were\xa0reading\xa0a\xa0message\xa0from\xa0the\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0client,\xa0we\xa0have\xa0potentially\xa0lost\xa0track\xa0of\xa0where\xa0the\xa0previous\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0message\xa0ends\xa0and\xa0the\xa0next\xa0one\xa0begins.\xa0\xa0Even\xa0though\xa0we\xa0have\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0otherwise\xa0recovered\xa0from\xa0the\xa0error,\xa0we\xa0cannot\xa0safely\xa0read\xa0any\xa0more\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0messages\xa0from\xa0the\xa0client,\xa0so\xa0there\xa0isn't\xa0much\xa0we\xa0can\xa0do\xa0with\xa0the\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0connection\xa0anymore.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5982\u679c\u5728\u8bfb\u53d6\u5ba2\u6237\u7aef\u6d88\u606f\u65f6\u51fa\u73b0\u9519\u8bef,\u8fdb\u7a0b\u53ef\u80fd\u5df2\u7ecf\u4e22\u5931\u4e86\u4e0a\u4e00\u6761\u6d88\u606f\u7ed3\u675f\u548c\u4e0b\u4e00\u6761\u6d88\u606f\u5f00\u59cb\u7684\u4f4d\u7f6e.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u867d\u7136\u4ece\u9519\u8bef\u4e2d\u6062\u590d\u4e86,\u4f46\u6211\u4eec\u4ecd\u7136\u4e0d\u80fd\u5b89\u5168\u7684\u4ece\u5ba2\u6237\u7aef\u8bfb\u53d6\u6d88\u606f,\u56e0\u6b64\u6211\u4eec\u5bf9\u8be5\u8fde\u63a5\u5df2\u65e0\u80fd\u65e0\u529b.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(pq_is_reading_msg())\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ereport(FATAL,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0(errcode(ERRCODE_PROTOCOL_VIOLATION),\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0errmsg(\"terminating\xa0connection\xa0because\xa0protocol\xa0synchronization\xa0was\xa0lost\")));\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Now\xa0we\xa0can\xa0allow\xa0interrupts\xa0again\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u5141\u8bb8\u4e2d\u65ad\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0RESUME_INTERRUPTS();\n\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0/*\xa0We\xa0can\xa0now\xa0handle\xa0ereport(ERROR)\xa0*/\n\xa0\xa0\xa0\xa0//\u73b0\u5728\u53ef\u4ee5\u5904\u7406ereport(ERROR)\u4e86\n\xa0\xa0\xa0\xa0PG_exception_stack\xa0=\xa0&local_sigjmp_buf;\n\xa0\xa0\xa0\xa0if\xa0(!ignore_till_sync)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u9519\u8bef\u6062\u590d\u540e\u91cd\u65b0\u521d\u59cb\u5316\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0send_ready_for_query\xa0=\xa0true;\xa0\xa0\xa0\xa0/*\xa0initially,\xa0or\xa0after\xa0error\xa0*/\n\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0*\xa0Non-error\xa0queries\xa0loop\xa0here.\n\xa0\xa0\xa0\xa0\xa0*\xa0\u4e16\u754c\u6e05\u51c0\u4e86...\n\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0for\xa0(;;)//\u4e3b\u5faa\u73af\n\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0At\xa0top\xa0of\xa0loop,\xa0reset\xa0extended-query-message\xa0flag,\xa0so\xa0that\xa0any\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0errors\xa0encountered\xa0in\xa0\"idle\"\xa0state\xa0don't\xa0provoke\xa0skip.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5728\u5faa\u73af\u7684\u6700\u5f00\u59cb\u5904,\u91cd\u7f6eextended-query-message\u6807\u8bb0,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u4ee5\u4fbf\u5728\"idle\"\u72b6\u6001\u9047\u5230\u9519\u8bef\u65f6\u4e0d\u4f1a\u8df3\u8fc7\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0doing_extended_query_message\xa0=\xa0false;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Release\xa0storage\xa0left\xa0over\xa0from\xa0prior\xa0query\xa0cycle,\xa0and\xa0create\xa0a\xa0new\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0query\xa0input\xa0buffer\xa0in\xa0the\xa0cleared\xa0MessageContext.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u91ca\u653e\u4e0a\u4e00\u4e2a\u67e5\u8be2\u5468\u671f\u4e2d\u6b8b\u4f59\u7684\u5b58\u50a8\u7a7a\u95f4,\u5e76\u5728\u5e72\u51c0\u7684MessageContext\u4e2d\u521b\u5efa\u65b0\u7684\u67e5\u8be2\u8f93\u5165\u7f13\u5b58\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextSwitchTo(MessageContext);//\u5207\u6362\u81f3MessageContext\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextResetAndDeleteChildren(MessageContext);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0initStringInfo(&input_message);//\u521d\u59cb\u5316\u8f93\u5165\u7684\u4fe1\u606f\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Also\xa0consider\xa0releasing\xa0our\xa0catalog\xa0snapshot\xa0if\xa0any,\xa0so\xa0that\xa0it's\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0not\xa0preventing\xa0advance\xa0of\xa0global\xa0xmin\xa0while\xa0we\xa0wait\xa0for\xa0the\xa0client.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5c1d\u8bd5\u91ca\u653ecatalog\xa0snapshot,\u4ee5\u4fbf\u5728\u7b49\u5f85\u5ba2\u6237\u7aef\u8fd4\u56de\u65f6\u4e0d\u4f1a\u963b\u788d\u5168\u5c40xmin\u7684\u589e\u52a0.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InvalidateCatalogSnapshotConditionally();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(1)\xa0If\xa0we've\xa0reached\xa0idle\xa0state,\xa0tell\xa0the\xa0frontend\xa0we're\xa0ready\xa0for\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0a\xa0new\xa0query.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(1)\xa0\u5982\u679c\u662fidle\u72b6\u6001,\u544a\u8bc9\u524d\u53f0\u5df2\u51c6\u5907\u63a5\u53d7\u65b0\u67e5\u8be2\u8bf7\u6c42\u4e86.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Note:\xa0this\xa0includes\xa0fflush()'ing\xa0the\xa0last\xa0of\xa0the\xa0prior\xa0output.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u6ce8\u610f:\u8fd9\u5305\u542b\u4e86fflush()'ing\u524d\u4e00\u4e2a\u8f93\u51fa\u7684\u6700\u540e\u4e00\u4e2a.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0This\xa0is\xa0also\xa0a\xa0good\xa0time\xa0to\xa0send\xa0collected\xa0statistics\xa0to\xa0the\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0collector,\xa0and\xa0to\xa0update\xa0the\xa0PS\xa0stats\xa0display.\xa0\xa0We\xa0avoid\xa0doing\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0those\xa0every\xa0time\xa0through\xa0the\xa0message\xa0loop\xa0because\xa0it'd\xa0slow\xa0down\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0processing\xa0of\xa0batched\xa0messages,\xa0and\xa0because\xa0we\xa0don't\xa0want\xa0to\xa0report\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0uncommitted\xa0updates\xa0(that\xa0confuses\xa0autovacuum).\xa0\xa0The\xa0notification\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0processor\xa0wants\xa0a\xa0call\xa0too,\xa0if\xa0we\xa0are\xa0not\xa0in\xa0a\xa0transaction\xa0block.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u53d1\u9001\u6536\u96c6\u7684\u7edf\u8ba1\u4fe1\u606f\u5230collector,\u6b63\u5f53\u5176\u65f6!\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5728\u6bcf\u6b21\u6d88\u606f\u5faa\u73af\u65f6\u90fd\u53d1\u9001\u7edf\u8ba1\u4fe1\u606f\u662f\u9700\u8981\u907f\u514d\u7684,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\xa0\u56e0\u4e3a\u6211\u4e0d\u5e0c\u671b\u62a5\u544a\u672a\u63d0\u4ea4\u7684\u66f4\u65b0(\u8fd9\u4f1a\u8ba9autoacuum\u51fa\u73b0\u6df7\u4e71).\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5982\u679c\u6211\u4eec\u4e0d\u5728\u4e8b\u52a1\u5757\u4e2d,\u90a3\u4e48\u901a\u77e5\u5904\u7406\u5668\u5e0c\u671b\u8c03\u7528\u4e00\u6b21.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(send_ready_for_query)//I\xa0am\xa0ready!\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(IsAbortedTransactionBlockState())\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0set_ps_display(\"idle\xa0in\xa0transaction\xa0(aborted)\",\xa0false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pgstat_report_activity(STATE_IDLEINTRANSACTION_ABORTED,\xa0NULL);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Start\xa0the\xa0idle-in-transaction\xa0timer\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(IdleInTransactionSessionTimeout\xa0>\xa00)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0disable_idle_in_transaction_timeout\xa0=\xa0true;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0enable_timeout_after(IDLE_IN_TRANSACTION_SESSION_TIMEOUT,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0IdleInTransactionSessionTimeout);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0else\xa0if\xa0(IsTransactionOrTransactionBlock())\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0set_ps_display(\"idle\xa0in\xa0transaction\",\xa0false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pgstat_report_activity(STATE_IDLEINTRANSACTION,\xa0NULL);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Start\xa0the\xa0idle-in-transaction\xa0timer\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(IdleInTransactionSessionTimeout\xa0>\xa00)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0disable_idle_in_transaction_timeout\xa0=\xa0true;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0enable_timeout_after(IDLE_IN_TRANSACTION_SESSION_TIMEOUT,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0IdleInTransactionSessionTimeout);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0else\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ProcessCompletedNotifies();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pgstat_report_stat(false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0set_ps_display(\"idle\",\xa0false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pgstat_report_activity(STATE_IDLE,\xa0NULL);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ReadyForQuery(whereToSendOutput);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0send_ready_for_query\xa0=\xa0false;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(2)\xa0Allow\xa0asynchronous\xa0signals\xa0to\xa0be\xa0executed\xa0immediately\xa0if\xa0they\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0come\xa0in\xa0while\xa0we\xa0are\xa0waiting\xa0for\xa0client\xa0input.\xa0(This\xa0must\xa0be\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0conditional\xa0since\xa0we\xa0don't\xa0want,\xa0say,\xa0reads\xa0on\xa0behalf\xa0of\xa0COPY\xa0FROM\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0STDIN\xa0doing\xa0the\xa0same\xa0thing.)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(2)\xa0\u5982\u679c\u5f02\u6b65\u4fe1\u53f7\u5728\u7b49\u5f85\u5ba2\u6237\u7aef\u8f93\u5165\u65f6\u63a5\u6536\u5230,\u90a3\u4e48\u5141\u8bb8\u9a6c\u4e0a\u6267\u884c.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\xa0\xa0\xa0(\u8fd9\u662f\u6709\u6761\u4ef6\u7684,\u56e0\u4e3a\u6211\u4eec\u4e0d\u5e0c\u671b\u6216\u8005\u8bf4\u6267\u884cCOPY\xa0FORM\xa0STDIN\u540c\u6837\u7684\u52a8\u4f5c)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0DoingCommandRead\xa0=\xa0true;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(3)\xa0read\xa0a\xa0command\xa0(loop\xa0blocks\xa0here)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(3)\xa0\u8bfb\u53d6\u547d\u4ee4(\u5faa\u73af\u5757)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0firstchar\xa0=\xa0ReadCommand(&input_message);//\u8bfb\u53d6\u547d\u4ee4\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(4)\xa0disable\xa0async\xa0signal\xa0conditions\xa0again.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(4)\xa0\u518d\u6b21\u7981\u7528\u5f02\u6b65\u4fe1\u53f7\u6761\u4ef6\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Query\xa0cancel\xa0is\xa0supposed\xa0to\xa0be\xa0a\xa0no-op\xa0when\xa0there\xa0is\xa0no\xa0query\xa0in\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0progress,\xa0so\xa0if\xa0a\xa0query\xa0cancel\xa0arrived\xa0while\xa0we\xa0were\xa0idle,\xa0just\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0reset\xa0QueryCancelPending.\xa0ProcessInterrupts()\xa0has\xa0that\xa0effect\xa0when\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0it's\xa0called\xa0when\xa0DoingCommandRead\xa0is\xa0set,\xa0so\xa0check\xa0for\xa0interrupts\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0before\xa0resetting\xa0DoingCommandRead.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\u5982\u65e0\u67e5\u8be2,\u90a3\u4e48\u53d6\u6d88\u67e5\u8be2\u88ab\u8ba4\u4e3a\u662fno-op\u7684,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\xa0\u56e0\u6b64\u5982\u679c\u5728\u7a7a\u95f2\u72b6\u6001\u4e0b\u63a5\u6536\u5230\u67e5\u8be2\u53d6\u6d88\u4fe1\u53f7,\u90a3\u4e48\u91cd\u7f6eQueryCancelPending.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0ProcessInterrupts()\u51fd\u6570\u5728DoingCommandRead\u8bbe\u7f6e\u7684\u65f6\u5019\u8c03\u7528\u4f1a\u6709\u7c7b\u4f3c\u7684\u5f71\u54cd,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\xa0\xa0\u56e0\u6b64\u5728\u91cd\u7f6eDoingCommandRead\u524d\u91cd\u65b0\u68c0\u67e5\u4e2d\u65ad.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0CHECK_FOR_INTERRUPTS();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0DoingCommandRead\xa0=\xa0false;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(5)\xa0turn\xa0off\xa0the\xa0idle-in-transaction\xa0timeout\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(5)\xa0\u5173\u95edidle-in-transaction\u8d85\u65f6\u63a7\u5236\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(disable_idle_in_transaction_timeout)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0disable_timeout(IDLE_IN_TRANSACTION_SESSION_TIMEOUT,\xa0false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0disable_idle_in_transaction_timeout\xa0=\xa0false;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(6)\xa0check\xa0for\xa0any\xa0other\xa0interesting\xa0events\xa0that\xa0happened\xa0while\xa0we\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0slept.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(6)\xa0\u5728\u4f11\u7720\u65f6\u68c0\u67e5\u611f\u5174\u8da3\u7684\u4e8b\u4ef6\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(ConfigReloadPending)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ConfigReloadPending\xa0=\xa0false;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ProcessConfigFile(PGC_SIGHUP);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(7)\xa0process\xa0the\xa0command.\xa0\xa0But\xa0ignore\xa0it\xa0if\xa0we're\xa0skipping\xa0till\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Sync.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0(7)\xa0\u5904\u7406\u547d\u4ee4.\u4f46\u5982\u679c\u6211\u4eec\u8bbe\u7f6e\u4e86ignore_till_sync\u5219\u5ffd\u7565\u4e4b.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(ignore_till_sync\xa0&&\xa0firstchar\xa0!=\xa0EOF)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0continue;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0switch\xa0(firstchar)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'Q':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0simple\xa0query\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//---------\xa0\u7b80\u5355\u67e5\u8be2\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0const\xa0char\xa0*query_string;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Set\xa0statement_timestamp()\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u8bbe\u7f6e\u65f6\u95f4\u6233\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetCurrentStatementStartTimestamp();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//SQL\u8bed\u53e5\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0query_string\xa0=\xa0pq_getmsgstring(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(am_walsender)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u5982\u4e3aWAL\xa0sender,\u6267\u884cexec_replication_command\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!exec_replication_command(query_string))\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0exec_simple_query(query_string);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0else\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u666e\u901a\u7684\u540e\u53f0\u8fdb\u7a0b\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0exec_simple_query(query_string);//\u6267\u884cSQL\u8bed\u53e5\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0send_ready_for_query\xa0=\xa0true;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'P':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0parse\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//----------\xa0\u89e3\u6790\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0const\xa0char\xa0*stmt_name;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0const\xa0char\xa0*query_string;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0numParams;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Oid\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*paramTypes\xa0=\xa0NULL;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0forbidden_in_wal_sender(firstchar);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Set\xa0statement_timestamp()\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetCurrentStatementStartTimestamp();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0stmt_name\xa0=\xa0pq_getmsgstring(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0query_string\xa0=\xa0pq_getmsgstring(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0numParams\xa0=\xa0pq_getmsgint(&input_message,\xa02);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(numParams\xa0>\xa00)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0i;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0paramTypes\xa0=\xa0(Oid\xa0*)\xa0palloc(numParams\xa0*\xa0sizeof(Oid));\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0for\xa0(i\xa0=\xa00;\xa0i\xa0<\xa0numParams;\xa0i++)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0paramTypes[i]\xa0=\xa0pq_getmsgint(&input_message,\xa04);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//\u6267\u884c\u89e3\u6790\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0exec_parse_message(query_string,\xa0stmt_name,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0paramTypes,\xa0numParams);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'B':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0bind\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//-------------\xa0\u7ed1\u5b9a\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0forbidden_in_wal_sender(firstchar);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Set\xa0statement_timestamp()\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetCurrentStatementStartTimestamp();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0this\xa0message\xa0is\xa0complex\xa0enough\xa0that\xa0it\xa0seems\xa0best\xa0to\xa0put\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0the\xa0field\xa0extraction\xa0out-of-line\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0\u8be5\u6d88\u606f\u770b\u8d77\u6765\u6bd4\u8f83\u590d\u6742,\u770b\u8d77\u6765\u6700\u597d\u7684\u505a\u6cd5\u662f\u63d0\u53d6\u5b57\u6bb5\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0exec_bind_message(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'E':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0execute\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//------------\xa0\u6267\u884c\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0const\xa0char\xa0*portal_name;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0max_rows;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0forbidden_in_wal_sender(firstchar);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Set\xa0statement_timestamp()\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetCurrentStatementStartTimestamp();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0portal_name\xa0=\xa0pq_getmsgstring(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0max_rows\xa0=\xa0pq_getmsgint(&input_message,\xa04);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0exec_execute_message(portal_name,\xa0max_rows);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'F':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0fastpath\xa0function\xa0call\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//-----------\xa0\u51fd\u6570\u8c03\u7528\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0forbidden_in_wal_sender(firstchar);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Set\xa0statement_timestamp()\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetCurrentStatementStartTimestamp();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Report\xa0query\xa0to\xa0various\xa0monitoring\xa0facilities.\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pgstat_report_activity(STATE_FASTPATH,\xa0NULL);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0set_ps_display(\"<FASTPATH>\",\xa0false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0start\xa0an\xa0xact\xa0for\xa0this\xa0function\xa0invocation\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0start_xact_command();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Note:\xa0we\xa0may\xa0at\xa0this\xa0point\xa0be\xa0inside\xa0an\xa0aborted\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0transaction.\xa0\xa0We\xa0can't\xa0throw\xa0error\xa0for\xa0that\xa0until\xa0we've\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0finished\xa0reading\xa0the\xa0function-call\xa0message,\xa0so\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0HandleFunctionRequest()\xa0must\xa0check\xa0for\xa0it\xa0after\xa0doing\xa0so.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Be\xa0careful\xa0not\xa0to\xa0do\xa0anything\xa0that\xa0assumes\xa0we're\xa0inside\xa0a\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0valid\xa0transaction\xa0here.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0switch\xa0back\xa0to\xa0message\xa0context\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextSwitchTo(MessageContext);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0HandleFunctionRequest(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0commit\xa0the\xa0function-invocation\xa0transaction\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0finish_xact_command();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0send_ready_for_query\xa0=\xa0true;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'C':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0close\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//----------\xa0\u5173\u95ed\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0close_type;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0const\xa0char\xa0*close_target;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0forbidden_in_wal_sender(firstchar);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0close_type\xa0=\xa0pq_getmsgbyte(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0close_target\xa0=\xa0pq_getmsgstring(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0switch\xa0(close_type)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'S':\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(close_target[0]\xa0!=\xa0'\\0')\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0DropPreparedStatement(close_target,\xa0false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0else\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0special-case\xa0the\xa0unnamed\xa0statement\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0drop_unnamed_stmt();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'P':\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0Portal\xa0\xa0\xa0\xa0\xa0\xa0portal;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0portal\xa0=\xa0GetPortalByName(close_target);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(PortalIsValid(portal))\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0PortalDrop(portal,\xa0false);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0default:\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ereport(ERROR,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0(errcode(ERRCODE_PROTOCOL_VIOLATION),\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0errmsg(\"invalid\xa0CLOSE\xa0message\xa0subtype\xa0%d\",\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0close_type)));\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(whereToSendOutput\xa0==\xa0DestRemote)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_putemptymessage('3');\xa0\xa0\xa0\xa0/*\xa0CloseComplete\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'D':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0describe\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//-------------\xa0\u63cf\u8ff0\u6bd4\u5982\\d\u7b49\u547d\u4ee4\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0describe_type;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0const\xa0char\xa0*describe_target;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0forbidden_in_wal_sender(firstchar);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0Set\xa0statement_timestamp()\xa0(needed\xa0for\xa0xact)\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetCurrentStatementStartTimestamp();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0describe_type\xa0=\xa0pq_getmsgbyte(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0describe_target\xa0=\xa0pq_getmsgstring(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0switch\xa0(describe_type)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0{\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'S':\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0exec_describe_statement_message(describe_target);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'P':\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0exec_describe_portal_message(describe_target);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0default:\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ereport(ERROR,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0(errcode(ERRCODE_PROTOCOL_VIOLATION),\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0errmsg(\"invalid\xa0DESCRIBE\xa0message\xa0subtype\xa0%d\",\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0describe_type)));\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'H':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0flush\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//---------\xa0flush\xa0\u5237\u65b0\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(whereToSendOutput\xa0==\xa0DestRemote)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_flush();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'S':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0sync\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0//----------\xa0Sync\xa0\u540c\u6b65\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0finish_xact_command();\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0send_ready_for_query\xa0=\xa0true;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0'X'\xa0means\xa0that\xa0the\xa0frontend\xa0is\xa0closing\xa0down\xa0the\xa0socket.\xa0EOF\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0means\xa0unexpected\xa0loss\xa0of\xa0frontend\xa0connection.\xa0Either\xa0way,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0perform\xa0normal\xa0shutdown.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'X':\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0EOF:\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Reset\xa0whereToSendOutput\xa0to\xa0prevent\xa0ereport\xa0from\xa0attempting\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0to\xa0send\xa0any\xa0more\xa0messages\xa0to\xa0client.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(whereToSendOutput\xa0==\xa0DestRemote)\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0whereToSendOutput\xa0=\xa0DestNone;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0NOTE:\xa0if\xa0you\xa0are\xa0tempted\xa0to\xa0add\xa0more\xa0code\xa0here,\xa0DON'T!\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Whatever\xa0you\xa0had\xa0in\xa0mind\xa0to\xa0do\xa0should\xa0be\xa0set\xa0up\xa0as\xa0an\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0on_proc_exit\xa0or\xa0on_shmem_exit\xa0callback,\xa0instead.\xa0Otherwise\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0it\xa0will\xa0fail\xa0to\xa0be\xa0called\xa0during\xa0other\xa0backend-shutdown\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0scenarios.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0proc_exit(0);\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'd':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0copy\xa0data\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'c':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0copy\xa0done\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0case\xa0'f':\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0copy\xa0fail\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0Accept\xa0but\xa0ignore\xa0these\xa0messages,\xa0per\xa0protocol\xa0spec;\xa0we\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0probably\xa0got\xa0here\xa0because\xa0a\xa0COPY\xa0failed,\xa0and\xa0the\xa0frontend\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*\xa0is\xa0still\xa0sending\xa0data.\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0*/\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0default:\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ereport(FATAL,\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0(errcode(ERRCODE_PROTOCOL_VIOLATION),\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0errmsg(\"invalid\xa0frontend\xa0message\xa0type\xa0%d\",\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0firstchar)));\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\n\xa0\xa0\xa0\xa0}\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0end\xa0of\xa0input-reading\xa0loop\xa0*/\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"\u4e09\u8ddf\u8e2a\u5206\u6790",children:"\u4e09\u3001\u8ddf\u8e2a\u5206\u6790"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u4e3b\u8282\u70b9\u4e0a\u7528gdb\u8ddf\u8e2apostmaster,\u5728PostgresMain\u4e0a\u8bbe\u7f6e\u65ad\u70b9\u540e\u542f\u52a8standby\u8282\u70b9,\u8fdb\u5165\u65ad\u70b9"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'[xdb@localhost\xa0~]$\xa0ps\xa0-ef|grep\xa0postgre\nxdb\xa0\xa0\xa0\xa0\xa0\xa0\xa01263\xa0\xa0\xa0\xa0\xa01\xa0\xa00\xa014:20\xa0pts/0\xa0\xa0\xa0\xa000:00:00\xa0/appdb/xdb/pg11.2/bin/postgres\n(gdb)\xa0b\xa0PostgresMain\nBreakpoint\xa01\xa0at\xa00x8bf9df:\xa0file\xa0postgres.c,\xa0line\xa03660.\n(gdb)\xa0set\xa0follow-fork-mode\xa0child\n(gdb)\xa0c\nContinuing.\n[New\xa0process\xa01332]\n[Thread\xa0debugging\xa0using\xa0libthread_db\xa0enabled]\nUsing\xa0host\xa0libthread_db\xa0library\xa0"/lib64/libthread_db.so.1".\n[Switching\xa0to\xa0Thread\xa00x7fb3885d98c0\xa0(LWP\xa01332)]\nBreakpoint\xa01,\xa0PostgresMain\xa0(argc=1,\xa0argv=0x1aa4c78,\xa0dbname=0x1aa4b68\xa0"",\xa0username=0x1aa4b40\xa0"replicator")\xa0at\xa0postgres.c:3660\n3660\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0volatile\xa0bool\xa0send_ready_for_query\xa0=\xa0true;\n(gdb)\n'})}),"\n",(0,a.jsxs)(n.p,{children:["1.\u521d\u59cb\u5316\u76f8\u5173\u53d8\u91cf",(0,a.jsx)(n.br,{}),"\n","\u6ce8\u610f\u53d8\u91cfIsUnderPostmaster,\u5982\u4e3aT\u5219\u8868\u793a\u8be5\u8fdb\u7a0b\u4e3apostmaster\u7684\u5b50\u8fdb\u7a0b"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'(gdb)\xa0p\xa0*argv\n$1\xa0=\xa00xc27715\xa0"postgres"\n(gdb)\xa0n\n3661\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0bool\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0disable_idle_in_transaction_timeout\xa0=\xa0false;\n(gdb)\xa0\n3664\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n(gdb)\xa0p\xa0IsUnderPostmaster\n$2\xa0=\xa0true\n'})}),"\n",(0,a.jsx)(n.p,{children:"2.\u521d\u59cb\u5316\u8fdb\u7a0b\u4fe1\u606f,\u8bbe\u7f6e\u8fdb\u7a0b\u72b6\u6001,\u521d\u59cb\u5316GUC\u53c2\u6570"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"(gdb)\xa0n\n3667\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetProcessingMode(InitProcessing);\n(gdb)\xa0\n3672\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n(gdb)\xa0p\xa0InitProcessing\n$3\xa0=\xa0InitProcessing\n"})}),"\n",(0,a.jsx)(n.p,{children:"3.\u89e3\u6790\u547d\u4ee4\u884c\u53c2\u6570\u5e76\u4f5c\u76f8\u5173\u6821\u9a8c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'(gdb)\xa0n\n3678\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0process_postgres_switches(argc,\xa0argv,\xa0PGC_POSTMASTER,\xa0&dbname);\n(gdb)\xa0\n3681\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(dbname\xa0==\xa0NULL)\n(gdb)\xa0p\xa0dbname\n$4\xa0=\xa00x1aa4b68\xa0""\n(gdb)\xa0p\xa0username\n$5\xa0=\xa00x1aa4b40\xa0"replicator"\n(gdb)\xa0n\n3692\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n(gdb)\n'})}),"\n",(0,a.jsx)(n.p,{children:"4.\u5982\u4e3awalsender\u8fdb\u7a0b,\u5219\u8c03\u7528WalSndSignals\u521d\u59cb\u5316,\u5426\u5219\u6267\u884c\u5176\u4ed6\u4fe1\u53f7\u521d\u59cb\u5316"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"3712\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(am_walsender)\n(gdb)\xa0\n3713\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0WalSndSignals();\n(gdb)\n"})}),"\n",(0,a.jsx)(n.p,{children:"5.\u521d\u59cb\u5316BlockSig/UnBlockSig/StartupBlockSig"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"(gdb)\xa0\n3751\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pqinitmask();\n(gdb)\xa0\n3753\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(IsUnderPostmaster)\n(gdb)\xa0\n3756\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0sigdelset(&BlockSig,\xa0SIGQUIT);\n(gdb)\xa0\n(gdb)\xa0\n3759\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0PG_SETMASK(&BlockSig);\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0block\xa0everything\xa0except\xa0SIGQUIT\xa0*/\n(gdb)\n"})}),"\n",(0,a.jsx)(n.p,{children:"6.\u975e\u5b50\u8fdb\u7a0b(\u4ecd\u4e3apostmaster\u8fdb\u7a0b),\u5219\u68c0\u67e5\u6570\u636e\u5e93\u8def\u5f84/\u5207\u6362\u8def\u5f84/\u521b\u5efa\u9501\u5b9a\u6587\u4ef6\u7b49\u64cd\u4f5c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"N/A\n"})}),"\n",(0,a.jsx)(n.p,{children:"7.\u8c03\u7528BaseInit\u6267\u884c\u57fa\u672c\u7684\u521d\u59cb\u5316"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"3785\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0BaseInit();\n(gdb)\n"})}),"\n",(0,a.jsx)(n.p,{children:"8.\u8c03\u7528InitProcess/InitPostgres\u521d\u59cb\u5316\u8fdb\u7a0b"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"3797\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitProcess();\n(gdb)\xa0\n3801\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0PG_SETMASK(&UnBlockSig);\n(gdb)\xa0\n3810\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitPostgres(dbname,\xa0InvalidOid,\xa0username,\xa0InvalidOid,\xa0NULL,\xa0false);\n(gdb)\n"})}),"\n",(0,a.jsx)(n.p,{children:"9.\u91cd\u7f6e\u5185\u5b58\u4e0a\u4e0b\u6587,\u5904\u7406\u52a0\u8f7d\u5e93\u548c\u524d\u540e\u53f0\u6d88\u606f\u4ea4\u4e92\u7b49"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"(gdb)\xa0\n3819\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(PostmasterContext)\n(gdb)\xa0\n3821\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextDelete(PostmasterContext);\n(gdb)\xa0P\xa0PostmasterContext\n$6\xa0=\xa0(MemoryContext)\xa00x1a78c60\n(gdb)\xa0P\xa0*PostmasterContext\n$7\xa0=\xa0{type\xa0=\xa0T_AllocSetContext,\xa0isReset\xa0=\xa0false,\xa0allowInCritSection\xa0=\xa0false,\xa0methods\xa0=\xa00xc93260\xa0<AllocSetMethods>,\xa0\n\xa0\xa0parent\xa0=\xa00x1a73aa0,\xa0firstchild\xa0=\xa00x1a9a700,\xa0prevchild\xa0=\xa00x1a7ac70,\xa0nextchild\xa0=\xa00x1a75ab0,\xa0name\xa0=\xa00xc2622a\xa0\"Postmaster\",\xa0\n\xa0\xa0ident\xa0=\xa00x0,\xa0reset_cbs\xa0=\xa00x0}\n(gdb)\xa0n\n3822\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0PostmasterContext\xa0=\xa0NULL;\n(gdb)\xa0\n3825\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetProcessingMode(NormalProcessing);\n(gdb)\xa0\n3831\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0BeginReportingGUCOptions();\n(gdb)\xa0\n3837\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(IsUnderPostmaster\xa0&&\xa0Log_disconnections)\n(gdb)\xa0p\xa0Log_disconnections\n$8\xa0=\xa0false\n(gdb)\xa0p\n$9\xa0=\xa0false\n(gdb)\xa0n\n3841\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(am_walsender)\n(gdb)\xa0\n3842\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InitWalSender();\n(gdb)\xa0\n3848\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0process_session_preload_libraries();\n(gdb)\xa0\n3853\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(whereToSendOutput\xa0==\xa0DestRemote)\n(gdb)\xa0\n3857\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_beginmessage(&buf,\xa0'K');\n(gdb)\xa0\n3858\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_sendint32(&buf,\xa0(int32)\xa0MyProcPid);\n(gdb)\xa0\n3859\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_sendint32(&buf,\xa0(int32)\xa0MyCancelKey);\n(gdb)\xa0\n3860\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_endmessage(&buf);\n(gdb)\xa0\n3865\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(whereToSendOutput\xa0==\xa0DestDebug)\n(gdb)\n"})}),"\n",(0,a.jsx)(n.p,{children:"10.\u521d\u59cb\u5316\u5185\u5b58\u4e0a\u4e0b\u6587"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"(gdb)\xa0\n3874\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MessageContext\xa0=\xa0AllocSetContextCreate(TopMemoryContext,\n(gdb)\xa0\n3884\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0row_description_context\xa0=\xa0AllocSetContextCreate(TopMemoryContext,\n(gdb)\xa0\n3887\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextSwitchTo(row_description_context);\n(gdb)\xa0\n3888\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0initStringInfo(&row_description_buf);\n(gdb)\xa0\n3889\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextSwitchTo(TopMemoryContext);\n(gdb)\xa0\n3894\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!IsUnderPostmaster)\n(gdb)\xa0\n3919\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(sigsetjmp(local_sigjmp_buf,\xa01)\xa0!=\xa00)\n(gdb)\xa0\n4027\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0PG_exception_stack\xa0=\xa0&local_sigjmp_buf;\n(gdb)\xa0\n4029\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!ignore_till_sync)\n(gdb)\xa0\n4030\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0send_ready_for_query\xa0=\xa0true;\xa0\xa0\xa0\xa0/*\xa0initially,\xa0or\xa0after\xa0error\xa0*/\n(gdb)\n"})}),"\n",(0,a.jsxs)(n.p,{children:["11.\u8fdb\u5165\u4e3b\u5faa\u73af",(0,a.jsx)(n.br,{}),"\n","11.1\u5207\u6362\u81f3MessageContext\u4e0a\u4e0b\u6587"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"(gdb)\xa0\n4042\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0doing_extended_query_message\xa0=\xa0false;\n(gdb)\xa0\n4048\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextSwitchTo(MessageContext);\n(gdb)\xa0\n4049\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0MemoryContextResetAndDeleteChildren(MessageContext);\n"})}),"\n",(0,a.jsx)(n.p,{children:"11.2\u521d\u59cb\u5316\u8f93\u5165\u7684\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'(gdb)\xa0\n4051\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0initStringInfo(&input_message);\n(gdb)\xa0\n4057\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0InvalidateCatalogSnapshotConditionally();\n(gdb)\xa0p\xa0input_message\n$10\xa0=\xa0{data\xa0=\xa00x1a78d78\xa0"",\xa0len\xa0=\xa00,\xa0maxlen\xa0=\xa01024,\xa0cursor\xa0=\xa00}\n(gdb)\n'})}),"\n",(0,a.jsx)(n.p,{children:"11.3\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u53ef\u4ee5\u6267\u884c\u67e5\u8be2\u7b49\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'(gdb)\xa0n\n4072\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(send_ready_for_query)\n(gdb)\xa0p\xa0send_ready_for_query\n$12\xa0=\xa0true\n(gdb)\xa0n\n4074\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(IsAbortedTransactionBlockState())\n(gdb)\xa0\n4087\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0else\xa0if\xa0(IsTransactionOrTransactionBlock())\n(gdb)\xa0\n4102\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ProcessCompletedNotifies();\n(gdb)\xa0\n4103\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pgstat_report_stat(false);\n(gdb)\xa0\n4105\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0set_ps_display("idle",\xa0false);\n(gdb)\xa0\n4106\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pgstat_report_activity(STATE_IDLE,\xa0NULL);\n(gdb)\xa0\n4109\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0ReadyForQuery(whereToSendOutput);\n(gdb)\xa0\n4110\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0send_ready_for_query\xa0=\xa0false;\n(gdb)\n'})}),"\n",(0,a.jsxs)(n.p,{children:["11.4\u8bfb\u53d6\u547d\u4ee4",(0,a.jsx)(n.br,{}),"\n","\u547d\u4ee4\u662fIDENTIFY_SYSTEM,\u5224\u65ad\u7cfb\u7edf\u6807\u8bc6\u662f\u5426OK",(0,a.jsx)(n.br,{}),"\n","firstchar -> ASCII 81 \u2014> \u5b57\u6bcd\u2019Q\u2019"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'(gdb)\xa0\n4119\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0DoingCommandRead\xa0=\xa0true;\n(gdb)\xa0\n4124\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0firstchar\xa0=\xa0ReadCommand(&input_message);\n(gdb)\xa0\n4135\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0CHECK_FOR_INTERRUPTS();\n(gdb)\xa0p\xa0input_message\n$13\xa0=\xa0{data\xa0=\xa00x1a78d78\xa0"IDENTIFY_SYSTEM",\xa0len\xa0=\xa016,\xa0maxlen\xa0=\xa01024,\xa0cursor\xa0=\xa00}\n(gdb)\xa0p\xa0firstchar\n$14\xa0=\xa081\n(gdb)\xa0\n$15\xa0=\xa081\n(gdb)\xa0n\n4136\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0DoingCommandRead\xa0=\xa0false;\n(gdb)\xa0\n4141\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(disable_idle_in_transaction_timeout)\n(gdb)\xa0\n4151\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(ConfigReloadPending)\n(gdb)\xa0\n4161\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(ignore_till_sync\xa0&&\xa0firstchar\xa0!=\xa0EOF)\n(gdb)\n'})}),"\n",(0,a.jsxs)(n.p,{children:["11.5\u6839\u636e\u547d\u4ee4\u7c7b\u578b\u6267\u884c\u76f8\u5173\u64cd\u4f5c",(0,a.jsx)(n.br,{}),"\n","walsender \u2014> \u6267\u884cexec_replication_command\u547d\u4ee4"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'(gdb)\xa0\n4164\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0switch\xa0(firstchar)\n(gdb)\xa0\n4171\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetCurrentStatementStartTimestamp();\n(gdb)\xa0\n4173\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0query_string\xa0=\xa0pq_getmsgstring(&input_message);\n(gdb)\xa0\n4174\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n(gdb)\xa0p\xa0query_string\n$16\xa0=\xa00x1a78d78\xa0"IDENTIFY_SYSTEM"\n(gdb)\xa0n\n4176\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(am_walsender)\n(gdb)\xa0\n4178\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!exec_replication_command(query_string))\n(gdb)\xa0\n4184\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0send_ready_for_query\xa0=\xa0true;\n(gdb)\xa0\n4186\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0break;\n(gdb)\xa0\n4411\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0}\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0/*\xa0end\xa0of\xa0input-reading\xa0loop\xa0*/\n(gdb)\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u7ee7\u7eed\u5faa\u73af,\u63a5\u6536\u547d\u4ee4,\u7b2c\u4e8c\u4e2a\u547d\u4ee4\u662fSTART_REPLICATION"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'...\n(gdb)\xa0\n4124\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0firstchar\xa0=\xa0ReadCommand(&input_message);\n(gdb)\xa0\n4135\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0CHECK_FOR_INTERRUPTS();\n(gdb)\xa0p\xa0input_message\n$18\xa0=\xa0{data\xa0=\xa00x1a78d78\xa0"START_REPLICATION\xa00/5D000000\xa0TIMELINE\xa016",\xa0len\xa0=\xa041,\xa0maxlen\xa0=\xa01024,\xa0cursor\xa0=\xa00}\n(gdb)\xa0p\xa0firstchar\n$19\xa0=\xa081\n...\n4164\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0switch\xa0(firstchar)\n(gdb)\xa0n\n4171\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0SetCurrentStatementStartTimestamp();\n(gdb)\xa0\n4173\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0query_string\xa0=\xa0pq_getmsgstring(&input_message);\n(gdb)\xa0\n4174\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0pq_getmsgend(&input_message);\n(gdb)\xa0\n4176\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(am_walsender)\n(gdb)\xa0p\xa0query_string\n$20\xa0=\xa00x1a78d78\xa0"START_REPLICATION\xa00/5D000000\xa0TIMELINE\xa016"\n(gdb)\xa0p\xa0input_message\n$21\xa0=\xa0{data\xa0=\xa00x1a78d78\xa0"START_REPLICATION\xa00/5D000000\xa0TIMELINE\xa016",\xa0len\xa0=\xa041,\xa0maxlen\xa0=\xa01024,\xa0cursor\xa0=\xa041}\n(gdb)\xa0n\n4178\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0if\xa0(!exec_replication_command(query_string))\n(gdb)\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5f00\u59cb\u6267\u884c\u590d\u5236,master\u8282\u70b9\u4f7f\u7528psql\u8fde\u63a5\u6570\u636e\u5e93,\u6267\u884csql\u8bed\u53e5,\u5b50\u8fdb\u7a0b\u4f1a\u63a5\u6536\u5230\u76f8\u5173\u4fe1\u53f7,\u6267\u884c\u76f8\u5173\u5904\u7406",(0,a.jsx)(n.br,{}),"\n","\u6267\u884c\u811a\u672c"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'[xdb@localhost\xa0~]$\xa0psql\xa0-d\xa0testdb\npsql\xa0(11.2)\nType\xa0"help"\xa0for\xa0help.\ntestdb=#\xa0drop\xa0table\xa0t1;\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u5b50\u8fdb\u7a0b\u8f93\u51fa"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"(gdb)\xa0\nProgram\xa0received\xa0signal\xa0SIGUSR1,\xa0User\xa0defined\xa0signal\xa01.\n0x00007fb38696c903\xa0in\xa0__epoll_wait_nocancel\xa0()\xa0from\xa0/lib64/libc.so.6\n(gdb)\xa0\nSingle\xa0stepping\xa0until\xa0exit\xa0from\xa0function\xa0__epoll_wait_nocancel,\nwhich\xa0has\xa0no\xa0line\xa0number\xa0information.\nprocsignal_sigusr1_handler\xa0(postgres_signal_arg=32766)\xa0at\xa0procsignal.c:262\n262\xa0{\n(gdb)\xa0n\n263\xa0\xa0\xa0\xa0\xa0int\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0save_errno\xa0=\xa0errno;\n(gdb)\xa0\nProgram\xa0received\xa0signal\xa0SIGTRAP,\xa0Trace/breakpoint\xa0trap.\n0x00007fb3881eecd0\xa0in\xa0__errno_location\xa0()\xa0from\xa0/lib64/libpthread.so.0\n(gdb)\xa0\nSingle\xa0stepping\xa0until\xa0exit\xa0from\xa0function\xa0__errno_location,\nwhich\xa0has\xa0no\xa0line\xa0number\xa0information.\nprocsignal_sigusr1_handler\xa0(postgres_signal_arg=10)\xa0at\xa0procsignal.c:265\n265\xa0\xa0\xa0\xa0\xa0if\xa0(CheckProcSignal(PROCSIG_CATCHUP_INTERRUPT))\n(gdb)\n"})}),"\n",(0,a.jsx)(n.p,{children:"DONE!"}),"\n",(0,a.jsx)(n.p,{children:"DEBUG\u9000\u51fagdb\u540e,psql\u4f1a\u8bddcrash:("}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'[xdb@localhost\xa0~]$\xa0psql\xa0-d\xa0testdb\npsql\xa0(11.2)\nType\xa0"help"\xa0for\xa0help.\ntestdb=#\xa0drop\xa0table\xa0t1;\nWARNING:\xa0\xa0terminating\xa0connection\xa0because\xa0of\xa0crash\xa0of\xa0another\xa0server\xa0process\nDETAIL:\xa0\xa0The\xa0postmaster\xa0has\xa0commanded\xa0this\xa0server\xa0process\xa0to\xa0roll\xa0back\xa0the\xa0current\xa0transaction\xa0and\xa0exit,\xa0because\xa0another\xa0server\xa0process\xa0exited\xa0abnormally\xa0and\xa0possibly\xa0corrupted\xa0shared\xa0memory.\nHINT:\xa0\xa0In\xa0a\xa0moment\xa0you\xa0should\xa0be\xa0able\xa0to\xa0reconnect\xa0to\xa0the\xa0database\xa0and\xa0repeat\xa0your\xa0command.\nserver\xa0closed\xa0the\xa0connection\xa0unexpectedly\n\xa0\xa0\xa0\xa0This\xa0probably\xa0means\xa0the\xa0server\xa0terminated\xa0abnormally\n\xa0\xa0\xa0\xa0before\xa0or\xa0while\xa0processing\xa0the\xa0request.\nThe\xa0connection\xa0to\xa0the\xa0server\xa0was\xa0lost.\xa0Attempting\xa0reset:\xa0Failed.\n!>\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u5230\u6b64\uff0c\u5173\u4e8e\u201cPostgreSQL\u7684\u540e\u53f0\u8fdb\u7a0bwalsender\u5206\u6790\u201d\u7684\u5b66\u4e60\u5c31\u7ed3\u675f\u4e86\uff0c\u5e0c\u671b\u80fd\u591f\u89e3\u51b3\u5927\u5bb6\u7684\u7591\u60d1\u3002\u7406\u8bba\u4e0e\u5b9e\u8df5\u7684\u642d\u914d\u80fd\u66f4\u597d\u7684\u5e2e\u52a9\u5927\u5bb6\u5b66\u4e60\uff0c\u5feb\u53bb\u8bd5\u8bd5\u5427\uff01\u82e5\u60f3\u7ee7\u7eed\u5b66\u4e60\u66f4\u591a\u76f8\u5173\u77e5\u8bc6\uff0c\u8bf7\u7ee7\u7eed\u5173\u6ce8\u4ebf\u901f\u4e91\u7f51\u7ad9\uff0c\u5c0f\u7f16\u4f1a\u7ee7\u7eed\u52aa\u529b\u4e3a\u5927\u5bb6\u5e26\u6765\u66f4\u591a\u5b9e\u7528\u7684\u6587\u7ae0\uff01"})]})}function g(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);