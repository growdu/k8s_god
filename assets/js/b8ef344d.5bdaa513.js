"use strict";(self.webpackChunkk_8_s_god=self.webpackChunkk_8_s_god||[]).push([[2229],{13601:(n,e,c)=>{c.r(e),c.d(e,{assets:()=>l,contentTitle:()=>r,default:()=>_,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"cluster/corosync/corosync\u7f16\u7a0b\u6307\u5357","title":"corosync\u7f16\u7a0b\u6307\u5357","description":"\u5b89\u88c5corosync","source":"@site/docs/cluster/corosync/corosync\u7f16\u7a0b\u6307\u5357.md","sourceDirName":"cluster/corosync","slug":"/cluster/corosync/corosync\u7f16\u7a0b\u6307\u5357","permalink":"/blog/docs/cluster/corosync/corosync\u7f16\u7a0b\u6307\u5357","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/cluster/corosync/corosync\u7f16\u7a0b\u6307\u5357.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"corosync\u6e90\u7801\u9605\u8bfb","permalink":"/blog/docs/cluster/corosync/corosync\u6e90\u7801\u9605\u8bfb"},"next":{"title":"disk-paxos\u8be6\u89e3","permalink":"/blog/docs/cluster/corosync/disk-paxos\u8be6\u89e3"}}');var s=c(74848),i=c(28453);const o={},r="corosync\u7f16\u7a0b\u6307\u5357",l={},d=[{value:"\u5b89\u88c5corosync",id:"\u5b89\u88c5corosync",level:2},{value:"corosync\u5206\u5e03\u5f0f\u5e94\u7528\u5f00\u53d1\u63a5\u53e3",id:"corosync\u5206\u5e03\u5f0f\u5e94\u7528\u5f00\u53d1\u63a5\u53e3",level:2},{value:"\u57fa\u4e8ecpg\u7684\u6d88\u606f\u53d1\u9001",id:"\u57fa\u4e8ecpg\u7684\u6d88\u606f\u53d1\u9001",level:3},{value:"\u57fa\u4e8equorum\u7684\u6295\u7968\u673a\u5236",id:"\u57fa\u4e8equorum\u7684\u6295\u7968\u673a\u5236",level:3},{value:"corosync\u5206\u5e03\u5f0f\u5e94\u7528\u5b9e\u73b0",id:"corosync\u5206\u5e03\u5f0f\u5e94\u7528\u5b9e\u73b0",level:2},{value:"FAQ",id:"faq",level:2}];function a(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"corosync\u7f16\u7a0b\u6307\u5357",children:"corosync\u7f16\u7a0b\u6307\u5357"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5b89\u88c5corosync",children:"\u5b89\u88c5corosync"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"https://github.com/corosync/corosync.git",children:"corosync"}),"\u7f16\u8bd1\u4f9d\u8d56",(0,s.jsx)(e.a,{href:"https://github.com/ClusterLabs/libqb",children:"libqb"}),"\u548c",(0,s.jsx)(e.a,{href:"https://github.com/kronosnet/kronosnet/",children:"kronosnet"}),"\u3002\u57fa\u4e8eubuntu20.04\u7f16\u8bd1\u3002"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7cfb\u7edf\u5e93\u4f9d\u8d56"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:" sudo apt-get install libgcrypt20-dev libzstd-dev liblzo2-dev liblzma-dev libbz2-dev libsctp-dev doxygen libnl-3-dev libnl-route-3-dev\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u7f16\u8bd1libqb"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"git clone https://github.com/ClusterLabs/libqb.git\ncd libqb\n./autogen.sh\n./configure\nmake -j 32\nsudo make install\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u7f16\u8bd1kronosnet"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"git clone https://github.com/kronosnet/kronosnet.git\ncd kronosnet\n./autogen.sh\n./configure\nmake -j 32\nsudo make install\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u7f16\u8bd1corosync"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"git clone https://github.com/corosync/corosync.git\ncd kronosnet\n./autogen.sh\n./configure\nmake -j 32\nsudo make install\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"corosync\u5206\u5e03\u5f0f\u5e94\u7528\u5f00\u53d1\u63a5\u53e3",children:"corosync\u5206\u5e03\u5f0f\u5e94\u7528\u5f00\u53d1\u63a5\u53e3"}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u4e8ecpg\u7684\u6d88\u606f\u53d1\u9001",children:"\u57fa\u4e8ecpg\u7684\u6d88\u606f\u53d1\u9001"}),"\n",(0,s.jsx)(e.p,{children:"corosync\u5b9e\u73b0\u4e86\u57fa\u4e8etotem\u534f\u8bae\u7684\u4e00\u81f4\u6027\u5206\u5e03\u5f0f\u7b97\u6cd5\uff0c\u63d0\u4f9b\u4e86\u5206\u5e03\u5f0f\u901a\u4fe1\u63a5\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u76f8\u5173\u7684API\u63a5\u53e3\u5f00\u53d1\u5206\u5e03\u5f0f\u5e94\u7528\u3002"}),"\n",(0,s.jsx)(e.p,{children:"corosync\u63d0\u4f9b\u4e86\u57fa\u4e8e\u5206\u7ec4\u7684\u901a\u4fe1\u673a\u5236\uff0c\u5728\u540c\u4e00\u4e2a\u5206\u7ec4\u5185\u7684\u8fdb\u7a0b\u8282\u70b9\u4f1a\u6536\u5230\u5206\u7ec4\u5185\u5404\u8282\u70b9\u7684\u7684\u6d88\u606f\u4ee5\u53ca\u914d\u7f6e\u53d8\u66f4\u901a\u77e5\uff0c\u5305\u62ec\u8282\u70b9\u52a0\u5165\u548c\u79fb\u9664\u3002\u5176\u4e3b\u8981\u63a5\u53e3\u5982\u4e0b\uff1a\uff08\u8981\u67e5\u770b\u76f8\u5173\u51fd\u6570\u63a5\u53e3\u4f7f\u7528\u8bf4\u660e\u53ef\u4ee5\u4f7f\u7528man + \u51fd\u6570\u540d\u7684\u65b9\u5f0f\u6765\u67e5\u770b\uff09"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"cpg_initialize"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <corosync/cpg.h>\n\nint cpg_initialize(cpg_handle_t *handle, cpg_callbacks_t *callbacks);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u521d\u59cb\u5316\u4e00\u4e2acpg\u7ec4\u6210\u5458\u7684handle\uff0c\u540e\u9762\u7684\u64cd\u4f5c\u90fd\u9700\u8981\u4f7f\u7528handle\u6765\u6807\u8bc6\uff1b\u540c\u65f6\u6ce8\u518c\u5e94\u7528\u5c42\u7684\u7ec4\u6210\u5458\u53d8\u66f4\u56de\u8c03\u548c\u6d88\u606f\u56de\u8c03\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"typedef void (*cpg_deliver_fn_t) (\n        cpg_handle_t handle,\n        const struct cpg_name *group_name,\n        uint32_t nodeid,\n        uint32_t pid,\n        const void *msg,\n        size_t msg_len);\n\ntypedef void (*cpg_confchg_fn_t) (\n        cpg_handle_t handle,\n        const struct cpg_name *group_name,\n        const struct cpg_address *member_list, size_t member_list_entries,\n        const struct cpg_address *left_list, size_t left_list_entries,\n        const struct cpg_address *joined_list, size_t joined_list_entries);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u5206\u7ec4\u5185\u6709\u6210\u5458\u53d8\u66f4\u65f6\uff0c\u5982\u6210\u5458join\u6216\u8005leave\u65f6\uff0c\u4f1a\u8c03\u7528cpg_confchg_fn_t\uff0c\u5e94\u7528\u5c42\u9700\u5b9e\u73b0\u8fd9\u4e2a\u51fd\u6570\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u6536\u5230\u7ec4\u5185\u8282\u70b9\u53d1\u9001\u7684\u6d88\u606f\u65f6\uff0c\u4f1a\u8c03\u7528cpg_deliver_fn_t\uff0c\u5e94\u7528\u5c42\u9700\u5b9e\u73b0\u8fd9\u4e2a\u51fd\u6570\uff0c\u5bf9\u6536\u5230\u7684\u6570\u636e\u8fdb\u884c\u5904\u7406\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)("font",{color:"red",children:"\u5f53cpg_deliver_fn_t\u88ab\u8c03\u7528\u65f6\uff0ccorosync\u5e76\u4e0d\u4fdd\u8bc1\u672c\u6761\u4fe1\u606f\u5df2\u7ecf\u88ab\u6240\u6709\u7ec4\u5185\u8282\u70b9\u786e\u8ba4\uff1b\u4f46corosync\u5e95\u5c42\u5b9e\u73b0\u53ef\u4ee5\u4fdd\u8bc1\u672c\u6761\u6d88\u606f\u4e4b\u524d\u7684\u6240\u6709\u6d88\u606f\u90fd\u5df2\u88ab\u7ec4\u5185\u6240\u6709\u8282\u70b9\u786e\u8ba4\u6536\u5230\u3002"}),"\u5f53\u672c\u6761\u6d88\u606f\u4e4b\u524d\u7684\u6d88\u606f\u8fd8\u6ca1\u6709\u88ab\u7ec4\u5185\u6240\u6709\u8282\u70b9\u786e\u8ba4\u65f6\uff0ccorosync\u4f1a\u7f13\u5b58\u6b64\u6d88\u606f\uff0c\u76f4\u5230\u7ec4\u5185\u6210\u5458\u5747\u786e\u8ba4\u672c\u6761\u6d88\u606f\u524d\u7684\u6d88\u606f\u5df2\u88ab\u63a5\u6536\u3002"]}),"\n",(0,s.jsx)("font",{color:"red",children:"\u8fdb\u7a0b\u8c03\u7528cpg_mcast_joined\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u672c\u8fdb\u7a0b\u4e5f\u4f1a\u89e6\u53d1\u56de\u8c03cpg_deliver_fn\u6536\u5230\u672c\u8fdb\u7a0b\u53d1\u51fa\u7684\u6d88\u606f\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u4ee3\u7801\u6837\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"tatic void cpg_deliver_fn (\n        cpg_handle_t handle,\n        const struct cpg_name *group_name,\n        uint32_t nodeid,\n        uint32_t pid,\n        void *m,\n        size_t msg_len)\n{\n}\n\nstatic void cpg_confchg_fn (\n        cpg_handle_t handle,\n        const struct cpg_name *group_name,\n        const struct cpg_address *member_list, size_t member_list_entries,\n        const struct cpg_address *left_list, size_t left_list_entries,\n        const struct cpg_address *joined_list, size_t joined_list_entries)\n{\n}\n\nstatic cpg_callbacks_t callbacks = {\n\tcpg_deliver_fn,\n\tcpg_confchg_fn\n};\n\nint result = cpg_initialize (&handle, &callbacks);\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"cpg_model_initialize"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <corosync/cpg.h>\n\ncs_error_t cpg_model_initialize(cpg_handle_t *handle, cpg_model_t model, cpg_model_data_t *model_data, void *context);\n"})}),"\n",(0,s.jsx)(e.p,{children:"cpg_model_initialize\u662fcpg_initialize\u7684\u65b0\u7248\u672c\uff0ccpg_initialize\u63a5\u53e3\u5df2\u8fc7\u671f\u3002cpg_model_initialize\u589e\u52a0\u4e86cpg_totem_confchg_fn_t\u56de\u8c03\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"typedef void (*cpg_deliver_fn_t) (\n        cpg_handle_t handle,\n        const struct cpg_name *group_name,\n        uint32_t nodeid,\n        uint32_t pid,\n        const void *msg,\n        size_t msg_len);\n\ntypedef void (*cpg_confchg_fn_t) (\n        cpg_handle_t handle,\n        const struct cpg_name *group_name,\n        const struct cpg_address *member_list, size_t member_list_entries,\n        const struct cpg_address *left_list, size_t left_list_entries,\n        const struct cpg_address *joined_list, size_t joined_list_entries);\n\ntypedef void (*cpg_totem_confchg_fn_t) (\n        cpg_handle_t handle,\n        struct cpg_ring_id ring_id,\n        uint32_t member_list_entries,\n        const uint32_t *member_list);\n\ntypedef struct {\n        cpg_model_t model;\n        cpg_deliver_fn_t cpg_deliver_fn;\n        cpg_confchg_fn_t cpg_confchg_fn;\n        cpg_totem_confchg_fn_t cpg_totem_confchg_fn;\nunsigned int flags;\n} cpg_model_v1_data_t;\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"cpg_join"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <corosync/cpg.h>\n\nint cpg_join(cpg_handle_t handle, struct cpg_name *group);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u5728cpg_initialize\u4e4b\u540e\u6267\u884c\uff0ccpg\u521d\u59cb\u5316\u5b8c\u6210\u540e\uff0c\u4f1a\u83b7\u53d6\u5230\u4e00\u4e2ahandle\uff0c\u901a\u8fc7\u8be5handle\u548ccpg_name\u5c06\u8be5\u8fdb\u7a0b\u52a0\u5165\u5230\u67d0\u4e2a\u8fdb\u7a0b\u7ec4\u5185\u3002\u8fd9\u6837\u5f53\u8be5\u8fdb\u7a0b\u7ec4\u5185\u6709\u8282\u70b9\u53d1\u9001\u6d88\u606f\u6216\u8005\u8282\u70b9\u53d8\u66f4\u65f6\u5c31\u4f1a\u6536\u5230\u6d88\u606f\u3002\u4e00\u822c\u8be5\u51fd\u6570\u7528\u4e8e\u5c06\u672c\u8fdb\u7a0b\u52a0\u5165\u5230\u67d0\u4e2a\u7279\u5b9a\u7684\u8fdb\u7a0b\u7ec4\u91cc\uff0c\u8ba2\u9605\u8fdb\u7a0b\u7ec4\u5185\u7684\u6d88\u606f\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5728corosync\u4e2d\uff0ccorosync\u662f\u4e00\u4e2a\u670d\u52a1\uff0c\u53ef\u4ee5\u57fa\u4e8ecorosync\u670d\u52a1\u521b\u5efa\u591a\u4e2a\u5e94\u7528\u8fdb\u7a0b\uff0c\u8fd8\u53ef\u4ee5\u628a\u5e94\u7528\u8fdb\u7a0b\u52a0\u5165\u5230\u4e0d\u540c\u7684\u5206\u7ec4\u91cc\u8fdb\u884c\u5206\u7ec4\u9694\u79bb\u3002\u8fdb\u7a0b\u53ef\u4ee5\u8ba2\u9605\u672c\u8fdb\u7a0b\u7ec4\u7684\u6d88\u606f\u548c\u914d\u7f6e\u53d8\u66f4\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u5904\u7406\uff0c\u4e5f\u53ef\u4ee5\u5411\u540c\u8fdb\u7a0b\u7ec4\u5185\u5e7f\u64ad\u6d88\u606f\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"cpg_mcast_joined"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <sys/uio.h> \n#include <corosync/cpg.h>\n\nint cpg_mcast_joined(cpg_handle_t handle, cpg_guarantee_t guarantee, struct iovec *iovec, int iov_len);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u5728cpg\u5206\u7ec4\u521d\u59cb\u5316\u5b8c\u6210\u5e76\u52a0\u5165\u5230\u67d0\u4e2a\u8fdb\u7a0b\u7ec4\u540e\u53ef\u4ee5\u8c03\u7528\uff0c\u4e00\u822c\u7528\u4e8e\u5e7f\u64ad\u6d88\u606f\u5230\u8fdb\u7a0b\u7ec4\u7684\u5176\u4ed6\u8282\u70b9\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"cpg_dispatch"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <corosync/cpg.h>\n\n/**\n * @brief  Dispatch messages and configuration changes\n * @param handle\n * @param dispatch_types\n * @return\n */\ncs_error_t cpg_dispatch (\n\tcpg_handle_t handle,\n\tcs_dispatch_flags_t dispatch_types);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u63a5\u6536\u8fdb\u7a0b\u7ec4\u5185\u7684\u6d88\u606f\u548c\u914d\u7f6e\u66f4\u6539\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"cpg_finalize"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <corosync/cpg.h>\n\nint cpg_finalize(cpg_handle_t handle);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u91ca\u653ecpg\u76f8\u5173\u8d44\u6e90\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u7efc\u5408\u6765\u770b\uff0c\u57fa\u4e8ecorosync\u670d\u52a1\u7684cpg\u5206\u7ec4\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u5f00\u53d1\u5927\u81f4\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(e.mermaid,{value:"graph TB\ncpg_initialize--\x3ecpg_join--\x3e|\u5e94\u7528\u5c42\u53d1\u9001\u6d88\u606f|cpg_mcast_joined\ncpg_join--\x3e|\u5faa\u73af\u63a5\u6536\u6d88\u606f|loop---\x3ecpg_dispatch--\x3eloop\ncpg_dispatch--\x3e|\u6d41\u7a0b\u7ed3\u675f\u91ca\u653e\u8d44\u6e90|cpg_finalize\n"}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u4e8equorum\u7684\u6295\u7968\u673a\u5236",children:"\u57fa\u4e8equorum\u7684\u6295\u7968\u673a\u5236"}),"\n",(0,s.jsx)(e.p,{children:"\u5206\u5e03\u5f0f\u96c6\u7fa4\u9700\u8981\u5904\u7406\u7684\u4e00\u4e2a\u6700\u4e3b\u8981\u95ee\u9898\u5c31\u662f\u201c\u8111\u88c2\u201d\uff0ccorosync\u901a\u8fc7quorum\u673a\u5236\u89e3\u51b3\u201c\u8111\u88c2\u7684\u95ee\u9898\u201d\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u4e00\u5957\u63a5\u53e3\u5bf9quorum\u8fdb\u884c\u914d\u7f6e\u548c\u83b7\u53d6quorum\u4fe1\u606f\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2acorosync\u670d\u52a1\u6765\u8bf4\uff0c\u5176quorum\u90fd\u6709\u4e24\u79cd\u72b6\u6001\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"with quorate"}),"\n",(0,s.jsx)(e.p,{children:"with quorate\u8868\u793a\u5f97\u5230\u4e86\u5927\u591a\u6570\u8282\u70b9\u7684\u6295\u7968\uff0c\u8868\u660e\u8fd9\u4e2a\u8282\u70b9\u53ef\u4ee5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"without quorate"}),"\n",(0,s.jsx)(e.p,{children:"without quorate\u8868\u793a\u6ca1\u6709\u5f97\u5230\u4e86\u5927\u591a\u6570\u8282\u70b9\u7684\u6295\u7968\uff0c\u8868\u660e\u8fd9\u4e2a\u8282\u70b9\u65e0\u6cd5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"votequorum_initialize"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"#include <corosync/votequorum.h>\n\nint votequorum_initialize(votequorum_handle_t *handle, votequorum_callbacks_t *callbacks);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u521d\u59cb\u5316\u4e0e\u57fa\u4e8equorum\u7684\u6295\u7968\u7cfb\u7edf\u7684\u63a5\u53e3\u3002\u5e76\u6ce8\u518c\u6295\u7968\u914d\u7f6e\u66f4\u6539\u7684\u56de\u8c03votequorum_notification_fn_t\uff0c\u8282\u70b9\u53d8\u66f4\u7684\u56de\u8c03votequorum_nodelist_notify_fn\u4ee5\u53ca\u671f\u671b\u7968\u6570\u53d8\u66f4\u7684\u56de\u8c03votequorum_expectedvotes_notify_fn\u3002\u5f53\u6295\u7968\u914d\u7f6e\u6216\u8282\u70b9\u53d8\u66f4\u65f6\u4f1a\u89e6\u53d1\u76f8\u5e94\u7684\u56de\u8c03\uff0c\u901a\u8fc7\u5b9e\u884c\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570\uff0c\u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u96c6\u7fa4\u7684\u5404\u4e2a\u8282\u70b9\u4fe1\u606f\u5df2\u7ecfquorum\u4fe1\u606f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"/**\n * @brief The votequorum_quorum_notification_fn_t callback\n */\ntypedef void (*votequorum_quorum_notification_fn_t) (\n\tvotequorum_handle_t handle,\n\tuint64_t context,\n\tuint32_t quorate,\n\tuint32_t node_list_entries,\n\tvotequorum_node_t node_list[]);\n\ntypedef void (*votequorum_nodelist_notification_fn_t) (\n\tvotequorum_handle_t handle,\n\tuint64_t context,\n\tvotequorum_ring_id_t ring_id,\n\tuint32_t node_list_entries,\n\tuint32_t node_list[]);\n\n/**\n * @brief The votequorum_expectedvotes_notification_fn_t callback\n */\ntypedef void (*votequorum_expectedvotes_notification_fn_t) (\n\tvotequorum_handle_t handle,\n\tuint64_t context,\n\tuint32_t expected_votes);\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"votequorum_trackstart"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"cs_error_t votequorum_trackstart (\n\tvotequorum_handle_t handle,\n\tuint64_t context,\n\tunsigned int flags);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u542f\u52a8votequorum\u63a5\u53e3\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"votequorum_getinfo"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"cs_error_t votequorum_getinfo (\n\tvotequorum_handle_t handle,\n\tunsigned int nodeid,\n\tstruct votequorum_info *info);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u83b7\u53d6votequorum\u7684\u76f8\u5173\u4fe1\u606f\u4ee5\u53ca\u8282\u70b9\u4fe1\u606f,\u76f8\u5173\u4fe1\u606f\u901a\u8fc7struct votequorum_info\u8fd4\u56de\u3002"}),"\n",(0,s.jsx)("font",{color:"red",children:"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528\u8be5\u51fd\u6570\u5224\u65ad\u5f53\u524d\u8282\u70b9\u7684quorate\u72b6\u6001\uff0c\u8fdb\u800c\u5224\u65ad\u5f53\u524d\u8282\u70b9\u662f\u5426\u80fd\u591f\u63d0\u4f9b\u670d\u52a1\u3002\u5f53\u8282\u70b9\u72b6\u6001\u4e3awithout quorate\uff0c\u8868\u9762\u8282\u70b9\u5df2\u4e0d\u5728\u591a\u6570\u6d3e\u96c6\u7fa4\u4e2d\uff0c\u5e94\u7528\u5c42\u4e0d\u5e94\u8be5\u518d\u53d1\u9001\u6d88\u606f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"/**\n * @brief The votequorum_info struct\n */\nstruct votequorum_info {\n\tunsigned int node_id;\n\tunsigned int node_state;\n\tunsigned int node_votes;\n\tunsigned int node_expected_votes;\n\tunsigned int highest_expected;\n\tunsigned int total_votes; // \u8282\u70b9\u6240\u5728\u96c6\u7fa4\u83b7\u5f97\u7684\u603b\u6295\u7968\u6570\n\tunsigned int quorum; // \u8282\u70b9\u6240\u5728\u96c6\u7fa4\u83b7\u5f97\u7684quorum\n\tunsigned int flags; // \u662f\u5426\u662fquorate\uff0c1\u4e3a\u662f\uff0c\u8868\u9762\u662f\u5426\u5c5e\u4e8e\u591a\u6570\u6d3e\u91cc\u7684\u8282\u70b9\n\tunsigned int qdevice_votes;\n\tchar qdevice_name[VOTEQUORUM_QDEVICE_MAX_NAME_LEN];\n};\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"votequorum_setexpected"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"cs_error_t votequorum_setexpected (\n\tvotequorum_handle_t handle,\n\tunsigned int expected_votes);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u66f4\u6539\u96c6\u7fa4\u4e2d\u7684\u9884\u671f\u6295\u7968**\u3002**\u9884\u671f\u6295\u7968\u7528\u4e8e\u8ba1\u7b97\u6cd5\u5b9a\u4eba\u6570\uff0c\u901a\u5e38\u5e94\u8be5\u662f\u6240\u6709\u9884\u671f\u8282\u70b9\u52a0\u5165\u65f6\u5c06\u5b58\u5728\u7684\u6295\u7968\u603b\u6570\u3002\u6cd5\u5b9a\u4eba\u6570\u901a\u5e38\u662f\u8fd9\u4e2a\u7684\u4e00\u534a\uff08\u56db\u820d\u4e94\u5165\uff09\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"votequorum_setvotes"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"cs_error_t votequorum_setvotes (\n\tvotequorum_handle_t handle,\n\tunsigned int nodeid,\n\tunsigned int votes);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u66f4\u6539\u8282\u70b9\u62e5\u6709\u7684\u6295\u7968\u6570\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"votequorum_dispatch"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"cs_error_t votequorum_dispatch (\n\tvotequorum_handle_t handle,\n\tcs_dispatch_flags_t dispatch_types);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u51fd\u6570\u7528\u4e8e\u8c03\u5ea6\u914d\u7f6e\u66f4\u6539\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u57fa\u4e8ecorosync\u5f00\u53d1\u5206\u5e03\u5f0f\u5e94\u7528\u65f6\uff0c\u9700\u8981\u5904\u7406\u4e24\u4e2a\u65b9\u9762\u7684\u95ee\u9898\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u6d88\u606f\u53d1\u9001\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u8111\u88c2\uff1b"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5176\u4e2d\u6d88\u606f\u53d1\u9001\u901a\u8fc7cpg\u673a\u5236\u89e3\u51b3\uff0c\u4f46\u57fa\u4e8ecpg\u5206\u7ec4\u7684\u6d88\u606f\u53d1\u9001\u5e95\u5c42\u4e0d\u4f1a\u53bb\u533a\u5206\u8282\u70b9\u662f\u5426\u5c5e\u4e8e\u591a\u6570\u6d3e\u96c6\u7fa4\uff0c\u56e0\u800c\u5f53\u53d1\u751f\u8111\u88c2\u65f6\uff0c\u82e5\u672c\u8282\u70b9corosync\u670d\u52a1\u672a\u6302\u6b7b\uff0c\u5c06\u4e0d\u4f1a\u5f71\u54cd\u5e94\u7528\u5c42\u7684\u6d88\u606f\u53d1\u9001\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsxs)("font",{color:"red",children:["\u5f53\u96c6\u7fa4\u53d1\u751f\u8111\u88c2\u65f6\uff0c\u5e94\u7528\u5c42\u5728\u53d1\u9001\u6d88\u606f\u524d\u5e94\u5148\u5224\u65ad\u5f53\u524d\u8282\u70b9\u7684\u72b6\u6001\uff0c\u82e5\u5f53\u524d\u8282\u70b9\u5df2\u7ecf\u4e0d\u5728\u591a\u6570\u6d3e\u96c6\u7fa4\u4e2d\uff0c\u5f53\u524d\u8282\u70b9\u5c06\u4e0d\u80fd\u53d1\u9001\u4efb\u4f55\u6570\u636e\uff0c\u4e5f\u65e0\u6cd5\u63a5\u6536\u4efb\u4f55\u6570\u636e\u3002",(0,s.jsx)(e.strong,{children:"\u8fd9\u4e2a\u5224\u65ad\u5e94\u8be5\u7531\u5e94\u7528\u5c42\u5224\u65ad\u3002"})]}),"\u5373\u5e94\u7528\u5c42\u5728\u8c03\u7528cpg_mcast_joined\u53d1\u9001\u6d88\u606f\u524d\uff0c\u5148\u8c03\u7528votequorum_getinfo\u83b7\u53d6\u8282\u70b9\u72b6\u6001\uff0c\u518d\u51b3\u5b9a\u662f\u5426\u80fd\u53d1\u9001\u6570\u636e\u3002\u6216\u8005\u5f53\u6ce8\u518cvotequorum_callbacks_t\u7684\u56de\u8c03\u88ab\u8c03\u7528\u65f6\uff0c\u9700\u5224\u65ad\u5f53\u524d\u8282\u70b9\u7684\u72b6\u6001\u3002",(0,s.jsx)("font",{color:"red",children:"\u603b\u4e4b\uff0c\u5e94\u7528\u5c42\u9700\u611f\u77e5\u672c\u8282\u70b9\u7684quorate\u72b6\u6001\u3002"})]}),"\n",(0,s.jsx)(e.p,{children:"\u8fdb\u800c\uff0c\u57fa\u4e8ecorosync\u670d\u52a1\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u5f00\u53d1\u5927\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(e.mermaid,{value:"graph TB\ncpg_initialize--\x3ecpg_join--\x3e|\u5224\u65ad\u5f53\u524d\u8282\u70b9\u72b6\u6001|votequorum_getinfo--\x3e|\u5e94\u7528\u5c42\u53d1\u9001\u6d88\u606f|cpg_mcast_joined\ncpg_join--\x3e|\u5faa\u73af\u63a5\u6536\u6d88\u606f|loop---\x3ecpg_dispatch--\x3eloop\ncpg_dispatch--\x3e|\u6d41\u7a0b\u7ed3\u675f\u91ca\u653e\u8d44\u6e90|cpg_finalize\n\n\nvotequorum_initialize--\x3evotequorum_trackstart"}),"\n",(0,s.jsx)(e.h2,{id:"corosync\u5206\u5e03\u5f0f\u5e94\u7528\u5b9e\u73b0",children:"corosync\u5206\u5e03\u5f0f\u5e94\u7528\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.p,{children:"\u57fa\u4e8ecorosync\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u5b9e\u73b0\u65f6\u9700\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u5e94\u7528\u5c42\u9700\u5904\u7406\u5f53\u524d\u8282\u70b9\u7684quorate\u72b6\u6001\uff0c\u5e76\u6839\u636e\u76f8\u5e94\u7684quorate\u8fdb\u884c\u76f8\u5173\u7684\u52a8\u4f5c\uff1b\u82e5\u5f53\u8fdb\u5165without quorate\u72b6\u6001\u65f6\uff0c\u662f\u5426\u9700\u8981\u89e6\u53d1\u5207\u6362\u64cd\u4f5c\uff0c\u662f\u5426\u6d89\u53ca\u9009\u4e3b\u64cd\u4f5c\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u5e94\u7528\u5c42\u9700\u6839\u636e\u5177\u4f53\u4e1a\u52a1\u5b9e\u73b0\u76f8\u5e94\u7684\u6d88\u606f\u901a\u4fe1\u548c\u6301\u4e45\u5316\u673a\u5236\uff0ccorosync\u4ec5\u4fdd\u8bc1\u6d88\u606f\u4e00\u5b9a\u4f1a\u53d1\u9001\u5230\u96c6\u7fa4\u7684\u5927\u591a\u6570\u8282\u70b9\uff1b"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"faq",children:"FAQ"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5982\u4f55\u4fee\u6539corosync\u76d1\u542c\u7aef\u53e3"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"totem {\n\tversion: 2\n\tsecauth: off\n\tcrypto_cipher: none\n\tcrypto_hash: none\n\tthreads: 0\n\tclear_node_high_bit: no\n\trrp_mode: none\n\ttransport: udp\n\ttoken: 1000\n\tinterface {\n\t\tringnumber: 0\n\t\tttl: 45\n\t\tmcastport: 5406\n\t}\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4fee\u6539\u540e\u6267\u884c\u7ed3\u679c\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"ha@ha-virtual-machine:~$ netstat -anp | grep udp\n(Not all processes could be identified, non-owned process info\n will not be shown, you would have to be root to see it all.)\nudp        0      0 0.0.0.0:51896           0.0.0.0:*                           -\nudp        0      0 127.0.0.53:53           0.0.0.0:*                           -\nudp        0      0 0.0.0.0:5353            0.0.0.0:*                           -\nudp        0   2304 192.168.145.130:5405    0.0.0.0:*                           -\nudp        0      0 0.0.0.0:631             0.0.0.0:*                           -\nudp6       0      0 :::41918                :::*                                -\nudp6       0      0 :::5353                 :::*                                -\nha@ha-virtual-machine:~$ sudo /etc/init.d/corosync stop\nha@ha-virtual-machine:~$ sudo vim /etc/corosync/corosync.conf\nha@ha-virtual-machine:~$ sudo /etc/init.d/corosync start\nStarting corosync (via systemctl): corosync.service.\nha@ha-virtual-machine:~$ netstat -anp | grep udp\n(Not all processes could be identified, non-owned process info\n will not be shown, you would have to be root to see it all.)\nudp        0      0 0.0.0.0:51896           0.0.0.0:*                           -\nudp        0      0 127.0.0.53:53           0.0.0.0:*                           -\nudp        0      0 0.0.0.0:5353            0.0.0.0:*                           -\nudp        0   2304 192.168.145.130:5406    0.0.0.0:*                           -\nudp        0      0 0.0.0.0:631             0.0.0.0:*                           -\nudp6       0      0 :::41918                :::*                                -\nudp6       0      0 :::5353                 :::*                                -\nha@ha-virtual-machine:~$\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5404\u8282\u70b9\u6301\u4e45\u5316\u5b8c\u6210\u540e\u4f1a\u4ee5\u5355\u64ad\u7684\u65b9\u5f0f\u544a\u8bc9\u53d1\u8d77\u8282\u70b9\u6301\u4e45\u5316\u7ed3\u679c\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u5176\u5b9e\u4e0d\u7ba1\u5ba2\u6237\u7aef\u6709\u6ca1\u6709\u8fd4\u56de\u6210\u529f\uff0c\u672c\u5730\u90fd\u5df2\u7ecf\u66f4\u65b0\u4e86\uff0c\u90a3\u5c31\u51fa\u73b0\u4e86\u4e2a\u8282\u70b9\u72b6\u6001\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff1f\u6240\u4ee5\u8bfb\u7684\u65f6\u5019\u8bfb\u7684\u662f\u66f4\u65b0\u524d\u7684\uff1f\u65b0\u7684\u4f1a\u56de\u6eda\u6389\uff1f"}),"\n",(0,s.jsx)(e.p,{children:"\u6301\u4e45\u5316\u9700\u8981\u5728cpg_deliver_fn_t\u56de\u8c03\u4e2d\u5b9e\u73b0\u6587\u4ef6\u5199\u5165\u64cd\u4f5c\uff0c\u5373\u6536\u5230\u6d88\u606f\u540e\u8fdb\u884c\u6587\u4ef6\u5199\u5165\u3002\u7531\u4e8ecorosync\u670d\u52a1\u80fd\u4fdd\u8bc1\u672c\u6761\u6d88\u606f\u4e4b\u524d\u7684\u6240\u6709\u6d88\u606f\u90fd\u5df2\u88ab\u5404\u8282\u70b9\u63a5\u6536\uff0c\u5373corosync\u53ea\u4fdd\u8bc1\u6d88\u606f\u9001\u8fbe\u5e94\u7528\u5c42\uff0c\u4e0d\u4fdd\u8bc1\u6d88\u606f\u9001\u5230\u5e94\u7528\u5c42\u540e\u4e00\u5b9a\u5199\u5165\u6210\u529f\u3002\u56e0\u800c\u9700\u8981\u8003\u8651\u6587\u4ef6\u5199\u5165\u5931\u8d25\u7684\u60c5\u51b5\uff0c\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\u53ef\u4ee5\u8003\u8651\u4e24\u79cd\u65b9\u6848\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u901a\u8fc7\u672c\u8fdb\u7a0b\u91cd\u5199\u6765\u4fdd\u8bc1\u5199\u6210\u529f\uff1b\u7531\u5199\u5165\u8fdb\u7a0b\u672c\u8eab\u4fdd\u8bc1\u6587\u4ef6\u5199\u5165\u6210\u529f\uff0c\u9700\u8981\u5199\u5165\u8fdb\u7a0b\u7ef4\u62a4\u4e00\u6bb5\u7f13\u51b2\u533a\uff0c\u4fdd\u5b58\u6536\u5230\u7684\u6d88\u606f\u5185\u5bb9\uff0c\u5199\u5165\u6210\u529f\u7684\u6d88\u606f\u624d\u80fd\u79fb\u9664\uff0c\u5199\u5165\u5931\u8d25\u7684\u9700\u8981\u8fdb\u884c\u91cd\u8bd5\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u901a\u8fc7\u786e\u8ba4\u673a\u5236\uff0c\u5e94\u7528\u5c42\u91cd\u4f20\u6765\u4fdd\u8bc1\u5199\u5165\u6210\u529f\uff1b"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u8282\u70b9\u5982\u4f55\u7ed1\u5b9a\u591a\u4e2a\u5206\u7ec4"}),"\n",(0,s.jsx)(e.p,{children:"\u6b64\u5904\u7684\u8282\u70b9\u5bf9\u5e94\u4e00\u53f0\u673a\u5668\uff0c\u6216\u8005\u8bf4\u5bf9\u5e94\u4e00\u4e2acorosync\u670d\u52a1\u3002\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u6709\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u52a0\u5165\u5230\u4e00\u4e2a\u5206\u7ec4\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"cpg_dispatch\u662f\u4e0d\u662f\u963b\u585e\u7684"}),"\n",(0,s.jsx)(e.p,{children:"cpg_dispatch\u652f\u6301\u56db\u79cd\u7c7b\u578b\u7684\u8c03\u5ea6\u65b9\u5f0f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"typedef enum {\n\tCS_DISPATCH_ONE = 1, // \u8c03\u5ea6\u81f3\u5c11\u4e00\u4e2a\u56de\u8c03\uff0c\u963b\u585e\u76f4\u5230\u56de\u8c03\u88ab\u8c03\u5ea6\n\tCS_DISPATCH_ALL = 2, // \u8c03\u5ea6\u6240\u6709\u7b49\u5f85\u7684\u56de\u8c03\u800c\u4e0d\u963b\u585e\u7b49\u5f85\u4efb\u4f55\u56de\u8c03\n\tCS_DISPATCH_BLOCKING = 3, // \u8c03\u5ea6\u6240\u6709\u56de\u8c03\uff0c\u65e0\u9650\u671f\u963b\u585e\u3002\u8fd9\u7528\u4e8e\u521b\u5efa\u7ebf\u7a0b\u7684\u65b9\u5f0f\u3002\n\tCS_DISPATCH_ONE_NONBLOCKING = 4 // \u6700\u591a\u53d1\u9001\u4e00\u4e2a\u56de\u8c03\u3002\u5982\u679c\u6ca1\u6709\u6302\u8d77\u7684\u56de\u8c03\uff0c\u5219\u8fd4\u56de CS_ERR_TRY_AGAIN\u3002\n} cs_dispatch_flags_t;\n"})}),"\n",(0,s.jsx)(e.p,{children:"cpg_dispatch\u662f\u5426\u963b\u585e\uff0c\u4e0e\u4f20\u5165\u7684cs_dispatch_flags_t\u7c7b\u578b\u6709\u5173\uff0cCS_DISPATCH_ALL\u548cCS_DISPATCH_ONE_NONBLOCKING\u4e3a\u975e\u963b\u585e\u65b9\u5f0f\uff0cCS_DISPATCH_ONE\u548cCS_DISPATCH_BLOCKING\u4e3a\u963b\u585e\u65b9\u5f0f\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"corosync\u5185\u90e8\u91cd\u4f20\u673a\u5236"}),"\n",(0,s.jsx)(e.p,{children:"corosync\u5185\u90e8\u57fa\u4e8etotem\u534f\u8bae\u901a\u8fc7\u8bfb\u53d6\u4ee4\u724c\u73af\u4fe1\u606f\u8fdb\u884c\u91cd\u4f20\u3002\u4ee4\u724c\u73af\u4e2d\u4f1a\u643a\u5e26\u6d88\u606f\u7684seq\uff0c\u82e5seq\u5c0f\u4e8e\u5f53\u524d\u8282\u70b9\u7684\u6700\u5927seq\uff0c\u5219\u5f53\u524d\u8282\u70b9\u4f1a\u5e7f\u64ad\u4e2d\u95f4\u76f8\u5dee\u7684seq\u6570\u636e\u8fdb\u884c\u91cd\u4f20\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"corosync\u6302\u6b7b\u5982\u4f55\u5904\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u4e0a\u5c42\u5e94\u7528\u9700\u8981\u4f7f\u7528corosync\u8fdb\u884c\u901a\u4fe1\uff0c\u5f53corosync\u6302\u6b7b\uff0c\u5e94\u7528\u7a0b\u5e8f\u65e0\u6cd5\u53d1\u9001\u6570\u636e\uff0c\u57fa\u4e8e\u8be5corosync\u7684\u6240\u6709\u4e0a\u5c42\u5e94\u7528\u5747\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\u3002\u9700\u91cd\u542fcorosync\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4e0d\u9700\u8981quorum\u7684\u5199\u63a5\u53e3\u662f\u4ec0\u4e48"}),"\n",(0,s.jsx)(e.p,{children:"\u57fa\u4e8ecpg\u7684\u6d88\u606f\u90fd\u662f\u4e0d\u9700\u8981quorum\u7684\u63a5\u53e3\uff0c\u4e0d\u7ba1\u5e95\u5c42\u8282\u70b9\u7684quorate\u72b6\u6001\u3002\u56e0\u800c\u5f53\u8282\u70b9\u4e3b\u52a8\u53d1\u9001\u6d88\u606f\u65f6\u9700\u5224\u65ad\u5176quorate\u72b6\u6001\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5e94\u7528\u5c42\u56de\u8c03\u7684\u89e6\u53d1\u573a\u666f\u548c\u6761\u4ef6\u662f\u4ec0\u4e48"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u6536\u5230\u6d88\u606f\u6216\u8005\u914d\u7f6e\u53d8\u66f4\u65f6\u4f1a\u89e6\u53d1\u5bf9\u5e94\u7684\u56de\u8c03\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h1,{id:"reference",children:"reference"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://linux.die.net/man/3/cpg_model_initialize",children:"https://linux.die.net/man/3/cpg_model_initialize"})}),"\n"]})]})}function _(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},28453:(n,e,c)=>{c.d(e,{R:()=>o,x:()=>r});var t=c(96540);const s={},i=t.createContext(s);function o(n){const e=t.useContext(i);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);