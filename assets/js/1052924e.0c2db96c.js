"use strict";(self.webpackChunkk_8_s_god=self.webpackChunkk_8_s_god||[]).push([[2301],{28453:(n,e,i)=>{i.d(e,{R:()=>d,x:()=>c});var t=i(96540);const r={},s=t.createContext(r);function d(n){const e=t.useContext(s);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),t.createElement(s.Provider,{value:e},n.children)}},94113:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>d,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"dpdk/dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0","title":"dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0","description":"rte_ring\u662fdpdk\u5185\u90e8\u63d0\u4f9b\u7684\u4e00\u79cd\u65e0\u9501\u961f\u5217\u5b9e\u73b0\u3002","source":"@site/docs/dpdk/dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0.md","sourceDirName":"dpdk","slug":"/dpdk/dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0","permalink":"/blog/docs/dpdk/dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/dpdk/dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"dpdk\u5e38\u7528\u63a5\u53e3\u6307\u5317","permalink":"/blog/docs/dpdk/dpdk\u5e38\u7528\u63a5\u53e3\u6307\u5317"},"next":{"title":"dpdk\u76f8\u5173","permalink":"/blog/docs/dpdk/dpdk\u76f8\u5173"}}');var r=i(74848),s=i(28453);const d={},c="dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0",l={},a=[{value:"vpp\u7ebf\u7a0b\u6a21\u578b",id:"vpp\u7ebf\u7a0b\u6a21\u578b",level:2},{value:"dpdk ring\u4f7f\u7528",id:"dpdk-ring\u4f7f\u7528",level:2},{value:"\u65e0\u9501\u961f\u5217\u5b9e\u73b0",id:"\u65e0\u9501\u961f\u5217\u5b9e\u73b0",level:2},{value:"\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u95ee\u9898",id:"\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u95ee\u9898",level:3}];function _(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0",children:"dpdk\u65e0\u9501\u961f\u5217\u5b9e\u73b0"})}),"\n",(0,r.jsx)(e.p,{children:"rte_ring\u662fdpdk\u5185\u90e8\u63d0\u4f9b\u7684\u4e00\u79cd\u65e0\u9501\u961f\u5217\u5b9e\u73b0\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"vpp\u7ebf\u7a0b\u6a21\u578b",children:"vpp\u7ebf\u7a0b\u6a21\u578b"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Main Thread\u505a\u7ba1\u7406\u3002\u5e38\u5e38\u4f7f\u7528\u534f\u7a0b\u9a71\u52a8\u5b9e\u73b0\u5355\u7ebf\u7a0b\u591a\u4efb\u52a1\uff08VPP\u5185\u90e8\u5b9e\u73b0\u4e86\u4e00\u5957\u7c7b\u4f3c\u4e8e\u534f\u7a0b\u7684\u8c03\u5ea6\u673a\u5236\uff0c\u4ee5\u6b64\u6765\u5b9e\u73b0\u5355\u7ebf\u7a0b\u591a\u4efb\u52a1\u7684\u8c03\u5ea6\uff09"}),"\n",(0,r.jsx)(e.li,{children:"fwd Thread\u505a\u7eaf\u8f6c\u53d1\u3002\u901a\u5e38\u4e3a\u4e86\u6027\u80fd\u8003\u8651\uff0c\u5728\u8f6c\u53d1\u8def\u5f84\u4e0a\u4e25\u7981\u6709\u5185\u5b58\u62f7\u8d1d\u548c\u7cfb\u7edf\u8c03\u7528\uff08\u4f46\u662f\u51e1\u4e8b\u90fd\u6709\u4f8b\u5916\uff09\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"dpdk-ring\u4f7f\u7528",children:"dpdk ring\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"// dpdk19.11\nvoid rte_ring_free(struct rte_ring *r) //\u91ca\u653e\u5df2\u7ecf\u521b\u5efa\u7684dpdk\u7684rte_ring\n    \nstruct rte_ring * rte_ring_lookup(const char *name) //\u53bb\u5bfb\u627e\u4e00\u4e2a\u5df2\u7ecf\u521b\u5efa\u597d\u7684dpdk\u7684rte_ring\n    \nstatic __rte_always_inline unsigned int __rte_ring_do_enqueue(struct rte_ring *r, void * const *obj_table, unsigned int n, enum rte_ring_queue_behavior behavior, unsigned int is_sp, unsigned int *free_space) //\u6b64\u51fd\u6570\u4e3a\u5185\u90e8\u65b9\u6cd5\uff0c\u6240\u6709\u5165\u961f\u51fd\u6570\u90fd\u662f\u6b64\u51fd\u6570\u7684\u4e0a\u5c42\u5c01\u88c5\n    \nstatic __rte_always_inline unsigned int __rte_ring_do_dequeue(struct rte_ring *r, void **obj_table, unsigned int n, enum rte_ring_queue_behavior behavior, unsigned int is_sc, unsigned int *available) //\u6b64\u51fd\u6570\u4e3a\u5185\u90e8\u65b9\u6cd5\uff0c\u6240\u6709\u51fa\u961f\u51fd\u6570\u90fd\u662f\u6b64\u51fd\u6570\u7684\u4e0a\u5c42\u5c01\u88c5\n    \nstatic __rte_always_inline unsigned int rte_ring_mp_enqueue_bulk(struct rte_ring *r, void * const *obj_table, unsigned int n, unsigned int *free_space) //\u6b64\u51fd\u6570\u4e3a\u6279\u91cf\u5165\u961f\u51fd\u6570\uff0c\u4e3a\u591a\u751f\u4ea7\u8005\u5b89\u5168(multi producer)\n    \nstatic __rte_always_inline unsigned int\nrte_ring_sp_enqueue_bulk(struct rte_ring *r, void * const *obj_table, unsigned int n, unsigned int *free_space) //\u6b64\u51fd\u6570\u4e3a\u6279\u91cf\u5165\u961f\u51fd\u6570\uff0c\u4e3a\u5355\u751f\u4ea7\u8005\u5b89\u5168(single producer)\n    \nstatic __rte_always_inline unsigned int rte_ring_enqueue_bulk(struct rte_ring *r, void * const *obj_table, unsigned int n, unsigned int *free_space) //\u6b64\u51fd\u6570\u4e3a\u6279\u91cf\u5165\u961f\u51fd\u6570\uff0c\u5177\u4f53\u5b89\u5168\u6027\u8d28\u53d6\u51b3\u4e8e\u521b\u5efa\u961f\u5217\u65f6\u7684\u6807\u5fd7(flags)\n    \nstatic __rte_always_inline unsigned int rte_ring_mc_dequeue_bulk(struct rte_ring *r, void **obj_table, unsigned int n, unsigned int *available) //\u6b64\u51fd\u6570\u4e3a\u6279\u91cf\u51fa\u961f\u51fd\u6570\uff0c\u4e3a\u591a\u6d88\u8d39\u8005\u5b89\u5168(multi consumer)\n    \nstatic __rte_always_inline unsigned int rte_ring_sc_dequeue_bulk(struct rte_ring *r, void **obj_table, unsigned int n, unsigned int *available) //\u6b64\u51fd\u6570\u4e3a\u6279\u91cf\u51fa\u961f\u51fd\u6570\uff0c\u4e3a\u5355\u6d88\u8d39\u8005\u5b89\u5168(single consumer)\n    \nstatic __rte_always_inline unsigned int rte_ring_dequeue_bulk(struct rte_ring *r, void **obj_table, unsigned int n, unsigned int *available) //\u6b64\u51fd\u6570\u4e3a\u6279\u91cf\u51fa\u961f\u51fd\u6570\uff0c\u5177\u4f53\u5b89\u5168\u6027\u8d28\u53d6\u51b3\u4e8e\u521b\u5efa\u961f\u5217\u65f6\u7684\u6807\u5fd7(flags)\n    \nstatic inline unsigned rte_ring_count(const struct rte_ring *r) //\u6b64\u51fd\u6570\u7528\u4e8e\u67e5\u770b\u961f\u5217\u4e2d\u5143\u7d20\u7684\u6570\u91cf\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u65e0\u9501\u961f\u5217\u5b9e\u73b0",children:"\u65e0\u9501\u961f\u5217\u5b9e\u73b0"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\u65e0\u9501\u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u6c47\u7f16\u6307\u4ee4: cmpxchg\n\u7ffb\u8bd1\u8fc7\u6765\u5c31\u662fcompare and change\n"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u95ee\u9898",children:"\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u95ee\u9898"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u591a\u4e2a\u751f\u4ea7\u8005\uff0c\u751f\u4ea7\u4f4d\u7f6e\u6709\u51b2\u7a81\uff0c\u6bd4\u5982\u751f\u4ea7\u8005A\u8981push 3\u4e2a\u5143\u7d20\uff0c\u751f\u4ea7\u8005B\u8981push 3\u4e2a\u5143\u7d20\uff0c\u5982\u4f55\u505a\u5230\u4e0d\u51b2\u7a81\u4e0d\u8986\u76d6\uff1f"}),"\n",(0,r.jsx)(e.li,{children:"\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\uff0c\u751f\u4ea7\u4e86\u4e4b\u540e\u8981\u8ba9\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\uff0c\u6d88\u8d39\u4e86\u4e4b\u540e\u8981\u8ba9\u751f\u4ea7\u8005\u8fdb\u884c\u751f\u4ea7\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u591a\u6d88\u8d39\u8005\uff0c\u548c\u591a\u751f\u4ea7\u8005\u7684\u95ee\u9898\u7c7b\u4f3c\uff0c\u6d88\u8d39\u4f4d\u7f6e\u51b2\u7a81\uff0c\u6bd4\u5982\u6d88\u8d39\u8005A\u8981\u6d88\u8d393\u4e2a\u5143\u7d20\uff0c\u6d88\u8d39\u8005B\u8981\u6d88\u8d393\u4e2a\u5143\u7d20\uff0c\u5982\u4f55\u505a\u5230\u6d88\u8d39\u4e0d\u51b2\u7a81\u8ba9\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u90fd\u80fd\u6709\u5143\u7d20\u53ef\u4ee5\u6d88\u8d39\uff1f"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"struct rte_ring {\n    char name[RTE_MEMZONE_NAMESIZE] __rte_cache_aligned; // ring\u7684\u540d\u79f0\uff0clookup\u7684\u65f6\u5019\u5c31\u662f\u6839\u636e\u540d\u79f0\u8fdb\u884c\u67e5\u627e\u5bf9\u5e94\u7684ring\n\n    int flags;                                           // \u6807\u8bb0\uff0c\u7528\u6765\u63cf\u8ff0\u961f\u5217\u662f\u5355/\u591a\u751f\u4ea7\u8005\u8fd8\u662f\u5355/\u591a\u6d88\u8d39\u8005\u5b89\u5168\n\n    const struct rte_memzone *memzone;                     // \u6240\u5c5e\u7684memzone\uff0cmemzone\u662fdpdk\u5185\u5b58\u7ba1\u7406\u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\n\n    uint32_t size;                                        // \u961f\u5217\u957f\uff0c\u4e3a2^n\u3002\u5982\u679cflags\u4e3aRING_F_EXACT_SZ\n                                                         // \u961f\u5217size\u4e3a\u521d\u59cb\u5316\u65f6\u961f\u5217\u957f\u5ea6\u7684\u5411\u4e0a\u53d62\u7684n\u6b21\u5e42\uff0c\u4f8b\u5982\u5982\u679c\u4e3a\n                                                         // 7\uff0c\u90a3\u4e48\u5411\u4e0a\u53d6\u6700\u8fd1\u76842^n\u5e42\u7684\u6570\u4e3a8.\u5982\u679cflags\u4e0d\u4e3a\n                                                         // RING_F_EXACT_SZ\uff0c\u90a3\u4e48\u521d\u59cb\u5316\u961f\u5217\u7684\u65f6\u5019\u961f\u5217\u957f\u5fc5\u987b\u4e3a2^n\u5e42                                                         \n\n    uint32_t mask;                                         // \u63a9\u7801\uff0c\u4e3a\u961f\u5217\u957f - 1\uff0c\u7528\u6765\u8ba1\u7b97\u4f4d\u7f6e\u7684\u65f6\u5019\u53d6\u4f59\u7528\n    uint32_t capacity;                                    // \u961f\u5217\u5bb9\u91cf\uff0c\u4e00\u822c\u4e0d\u7b49\u4e8e\u961f\u5217\u957f\u5ea6\uff0c\u628a\u961f\u5217\u5bb9\u91cf\u7406\u89e3\u4e3a\u5b9e\u9645\u53ef\u4ee5\n                                                         // \u4f7f\u7528\u7684\u5143\u7d20\u4e2a\u6570\u5373\u53ef\u3002\u4f8b\u5982\u521d\u59cb\u5316\u65f6count\u4e3a7\u5e76\u4e14\u6307\u5b9a\u6807\u5fd7\u4e3a\n                                                         // RING_F_EXACT_SZ\uff0c\u90a3\u4e48count\u6700\u540e\u4e3a8\uff0c\u4f46\u662fcapacity\u4e3a7\uff0c\u56e0\u4e3a\n                                                         // 8\u662f\u5411\u4e0a\u53d62^n\u5e42\u53d6\u51fa\u6765\u7684\uff0c\u5b9e\u9645\u4e0a\u4ecd\u7136\u662f\u521b\u5efa\u65f6\u6240\u9700\u7684\u4e2a\u6570\uff0c8.\n\n    char pad0 __rte_cache_aligned;                          // \u586b\u5145\uff0c\u8003\u8651\u5230\u6027\u80fd\uff0c\u8981\u4f7f\u7528\u586b\u5145\u6cd5\u4fdd\u8bc1cache line\n\n    struct rte_ring_headtail prod __rte_cache_aligned;   // \u751f\u4ea7\u8005\u4f4d\u7f6e\uff0c\u91cc\u9762\u6709\u4e00\u4e2a\u751f\u4ea7\u8005\u5934\uff0c\u5373prod.head\uff0c\u8fd8\u6709\u4e00\u4e2a\u751f\n                                                         // \u4ea7\u8005\u5c3e\uff0c\u5373prod.tail\u3002prod.head\u4ee3\u8868\u7740\u4e0b\u4e00\u6b21\u751f\u4ea7\u65f6\u7684\u8d77\u59cb\n                                                         // \u751f\u4ea7\u4f4d\u7f6e\u3002prod.tail\u4ee3\u8868\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u7684\u4f4d\u7f6e\u754c\u9650\uff0c\u5230\u8fbe\n                                                         // prod.tail\u540e\u5c31\u65e0\u6cd5\u7ee7\u7eed\u6d88\u8d39\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u751f\u4ea7\u5b8c\u6210\u540e\uff0c\n                                                         // prod.tail = prod.head\uff0c\u610f\u5473\u7740\u521a\u751f\u4ea7\u7684\u5143\u7d20\u7686\u53ef\u4ee5\u88ab\u6d88\u8d39\n\n    char pad1 __rte_cache_aligned;  \n    struct rte_ring_headtail cons __rte_cache_aligned;   // \u6d88\u8d39\u8005\u4f4d\u7f6e\uff0c\u91cc\u9762\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u5934\uff0c\u5373cons.head\uff0c\u8fd8\u6709\u4e00\u4e2a\u6d88\n                                                         // \u8d39\u8005\u5c3e\uff0c\u5373cons.tail\u3002cons.head\u4ee3\u8868\u7740\u4e0b\u4e00\u6b21\u6d88\u8d39\u65f6\u7684\u8d77\u59cb\n                                                         // \u6d88\u8d39\u4f4d\u7f6e\u3002cons.tail\u4ee3\u8868\u751f\u4ea7\u8005\u53ef\u4ee5\u751f\u4ea7\u7684\u4f4d\u7f6e\u754c\u9650\uff0c\u5230\u8fbe\n                                                         // cons.tail\u540e\u5c31\u65e0\u6cd5\u7ee7\u7eed\u751f\u4ea7\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u6d88\u8d39\u5b8c\u6210\u540e\uff0c\n                                                         // cons.tail = cons.head\uff0c\u610f\u5473\u7740\u521a\u6d88\u8d39\u7684\u4f4d\u7f6e\u7686\u53ef\u4ee5\u88ab\u751f\u4ea7\n                                                         \n    char pad2 __rte_cache_aligned; /**< empty cache line */\n};\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u751f\u4ea7\u8005\uff1a\u5148\u62a2\u5360\uff0c\u518d\u5199\u5165\uff0c\u518d\u66f4\u65b0\u6307\u9488"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5148\u504f\u79fb\u5934\u6307\u9488\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u62a2\u4f4d\u7f6e\u3002\u8fd9\u6b65\u4e3b\u8981\u662f\u4e3a\u4e86\u5bf9\u4ed8\u591a\u751f\u4ea7\u8005\u7684\u60c5\u51b5\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u62a2\u5230\u4f4d\u7f6e\u540e\u5199\u6570\u636e\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u66f4\u65b0\u5c3e\u6307\u9488\uff0c\u8ba9\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u521a\u585e\u5165\u7684\u6570\u636e"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"static __rte_always_inline unsigned int\n__rte_ring_move_prod_head(struct rte_ring *r, unsigned int is_sp,\n        unsigned int n, enum rte_ring_queue_behavior behavior,\n        uint32_t *old_head, uint32_t *new_head,\n        uint32_t *free_entries)\n{\n    const uint32_t capacity = r->capacity;\n    unsigned int max = n;\n    int success;\n\n    do {\n        //1.\u5148\u786e\u5b9a\u751f\u4ea7\u8005\u8981\u751f\u4ea7\u591a\u5c11\u4e2a\u5143\u7d20\n        n = max;\n        //2.\u62ff\u5230\u73b0\u5728\u751f\u4ea7\u8005\u7684head\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u5373\u5c06\u751f\u4ea7\u7684\u4f4d\u7f6e\n        *old_head = r->prod.head;\n\n        //\u5185\u5b58\u5c4f\u969c\n        rte_smp_rmb();\n\n        //3.\u8ba1\u7b97\u5269\u4f59\u7684\u7a7a\u95f4\n        *free_entries = (capacity + r->cons.tail - *old_head);\n\n        //4.\u6bd4\u8f83\u751f\u4ea7\u7684\u5143\u7d20\u4e2a\u6570\u548c\u5269\u4f59\u7a7a\u95f4\n        if (unlikely(n > *free_entries))\n            n = (behavior == RTE_RING_QUEUE_FIXED) ?\n                    0 : *free_entries;\n\n        if (n == 0)\n            return 0;\n        //5.\u8ba1\u7b97\u751f\u4ea7\u540e\u7684\u65b0\u4f4d\u7f6e\n        *new_head = *old_head + n;\n        if (is_sp)\n            r->prod.head = *new_head, success = 1;\n        else //6.\u5982\u679c\u662f\u591a\u751f\u4ea7\u8005\u7684\u8bdd\u8c03\u7528cpmset\u51fd\u6570\u5b9e\u73b0\u751f\u4ea7\u4f4d\u7f6e\u62a2\u5360\n            success = rte_atomic32_cmpset(&r->prod.head,\n                    *old_head, *new_head);\n    } while (unlikely(success == 0));\n    return n;\n}\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:'static inline int\nrte_atomic32_cmpset(volatile uint32_t *dst, uint32_t exp, uint32_t src)\n{\n    uint8_t res;\n\n    asm volatile(\n            MPLOCKED\n            "cmpxchgl %[src], %[dst];"\n            "sete %[res];"\n            : [res] "=a" (res),     /* output */\n              [dst] "=m" (*dst)\n            : [src] "r" (src),      /* input */\n              "a" (exp),\n              "m" (*dst)\n            : "memory");            /* no-clobber list */\n    return res;\n}\n'})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"cmpxchg\u6307\u4ee4\u7684\u610f\u601d\u5c31\u662f\u201ccompare and change\u201d\uff0c\u5373\u201c\u6bd4\u8f83\u5e76\u4ea4\u6362\u201d\u3002\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679cA\u7b49\u4e8eB\uff0c\u5219\u5c06C\u8d4b\u503c\u7ed9A\uff1b\u5982\u679cA\u4e0d\u7b49\u4e8eB\uff0c\u5219\u62d2\u7edd\u5c06C\u8d4b\u503c\u7ed9A\u3002\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\u5982\u679c\u751f\u4ea7\u4f4d\u7f6e\u6ca1\u6709\u53d8\u5316\uff08A\u7b49\u4e8eB\uff09\uff0c\u90a3\u4e48\u5c31\u5c06\u6700\u65b0\u7684\u751f\u4ea7\u4f4d\u7f6e\uff08\u8ba1\u7b97\u504f\u79fb\u540e\u7684\u751f\u4ea7\u4f4d\u7f6e\uff09\u8d4b\u503c\u7ed9\u751f\u4ea7\u8005\u6307\u9488\uff1b\u5982\u679c\u751f\u4ea7\u4f4d\u7f6e\u53d1\u751f\u4e86\u53d8\u5316\uff08\u6709\u5176\u4ed6\u751f\u4ea7\u8005\u4e5f\u5728\u751f\u4ea7\uff09\uff0c\u90a3\u4e48\u5c31\u53d6\u6d88\u66f4\u65b0\u751f\u4ea7\u8005\u6307\u9488\n"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"static __rte_always_inline void\nupdate_tail(struct rte_ring_headtail *ht, uint32_t old_val, uint32_t new_val,\n        uint32_t single, uint32_t enqueue)\n{\n    //1.\u5185\u5b58\u5c4f\u969c\n    if (enqueue)\n        rte_smp_wmb();\n    else\n        rte_smp_rmb();\n    //2.\u5982\u679c\u6709\u5176\u4ed6\u751f\u4ea7\u8005\u751f\u4ea7\u6570\u636e\uff0c\u90a3\u4e48\u9700\u8981\u7b49\u5f85\u5176\u5c06\u6570\u636e\u751f\u4ea7\u5b8c\u66f4\u65b0tail\u6307\u9488\u540e\uff0c\u672c\u751f\u4ea7\u8005\u624d\u80fd\u66f4\u65b0tail\u6307\u9488\n    if (!single)\n        while (unlikely(ht->tail != old_val))\n            rte_pause();\n    //3.\u66f4\u65b0tail\u6307\u9488\uff0c\u66f4\u65b0\u7684\u4f4d\u7f6e\u4e3a\u6700\u65b0\u7684\u751f\u4ea7\u4f4d\u7f6e\uff0c\u610f\u5473\u7740\u521a\u521a\u751f\u4ea7\u7684\u6570\u636e\u5df2\u7ecf\u5168\u90e8\u53ef\u4ee5\u88ab\u6d88\u8d39\u8005\u6d88\u8d39\n    ht->tail = new_val;\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u6d88\u8d39\u8005\uff1a\u5148\u6807\u8bb0\uff0c\u518d\u56de\u6536"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h1,{id:"reference",children:"reference"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.cnblogs.com/jungle1996/p/12194243.html",children:"https://www.cnblogs.com/jungle1996/p/12194243.html"})}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(_,{...n})}):_(n)}}}]);