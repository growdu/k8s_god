"use strict";(self.webpackChunkk_8_s_god=self.webpackChunkk_8_s_god||[]).push([[2530],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>d});var i=t(96540);const s={},r=i.createContext(s);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},69937:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>a,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"network/pmtu\u6982\u8ff0","title":"pmtu\u6982\u8ff0","description":"\u53d1\u8868\u4e8e 2017-12-19 \u66f4\u65b0\u4e8e 2019-04-17 \u5206\u7c7b\u4e8e c \u8bc4\u8bba\u6570\uff1a 0 Comments","source":"@site/docs/network/pmtu\u6982\u8ff0.md","sourceDirName":"network","slug":"/network/pmtu\u6982\u8ff0","permalink":"/blog/docs/network/pmtu\u6982\u8ff0","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/network/pmtu\u6982\u8ff0.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"mtu\u8def\u5f84\u53d1\u73b0pmtu\u8be6\u89e3","permalink":"/blog/docs/network/mtu\u8def\u5f84\u53d1\u73b0pmtu\u8be6\u89e3"},"next":{"title":"MonoCloudios\u4f7f\u7528\u6559\u7a0b","permalink":"/blog/docs/network/vpn/MonoCloudios\u4f7f\u7528\u6559\u7a0b"}}');var s=t(74848),r=t(28453);const l={},d=void 0,c={},o=[{value:"\u7ed3\u8bba",id:"\u7ed3\u8bba",level:2},{value:"\u5b9e\u9a8c\u7ed3\u679c",id:"\u5b9e\u9a8c\u7ed3\u679c",level:2},{value:"\u6807\u51c6",id:"\u6807\u51c6",level:2},{value:"Linux\u7684\u5904\u7406",id:"linux\u7684\u5904\u7406",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["\u53d1\u8868\u4e8e 2017-12-19 \u66f4\u65b0\u4e8e 2019-04-17 \u5206\u7c7b\u4e8e ",(0,s.jsx)(n.a,{href:"http://sunyongfeng.com/categories/c/",children:"c"})," \u8bc4\u8bba\u6570\uff1a ",(0,s.jsx)(n.a,{href:"http://sunyongfeng.com/201712/networks/path_mtu.html#comments",children:"0 Comments"})]}),"\n",(0,s.jsx)(n.p,{children:"Path MTU \u7b80\u8ff0\u3002"}),"\n",(0,s.jsxs)(n.h2,{id:"\u7ed3\u8bba",children:[(0,s.jsx)(n.a,{href:"http://sunyongfeng.com/201712/networks/path_mtu#%E7%BB%93%E8%AE%BA",title:"\u7ed3\u8bba"}),"\u7ed3\u8bba"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u6982\u5ff5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PMTU\uff0cPath MTU\uff0c\u4ee5\u8def\u7531\u4e3a\u5355\u4f4d\uff0c\u4f5c\u4e3a\u8def\u7531\u8868\u7684\u5c5e\u6027\u4fe1\u606f\u7f13\u5b58\u4e8e\u8def\u7531\u8868\u3002"}),"\n",(0,s.jsxs)(n.li,{children:["PMTU\u53d1\u73b0\u673a\u5236\uff0c\u82e5\u7f51\u7edc\u8bbe\u5907\u6536\u5230\u8d85MTU IP\u62a5\u6587\u4e14\u8be5IP\u62a5\u6587\u4e0d\u5141\u8bb8\u5206\u7247\uff0c\u5219\u8fd4\u56de\u4e00\u4e2aICMP type 3 code 4\u62a5\u6587\uff08",(0,s.jsx)(n.code,{children:"The datagram is too big. Packet fragmentation is required but the 'don't fragment' (DF) flag is on."}),"\uff09\uff0c\u5c06\u7f51\u7edc\u8bbe\u5907\u652f\u6301\u7684MTU\u5927\u5c0f\u9644\u5728ICMP\u62a5\u6587\u4e2d\uff0c\u8fd4\u56de\u7ed9\u62a5\u6587\u6e90\u4e3b\u673a\uff0c\u7531\u62a5\u6587\u6e90\u4e3b\u673a\u8c03\u6574\u8be5\u8def\u5f84\u7684PMTU\u3002\u8be5\u673a\u5236\u5229\u7528IP\u5934\u90e8",(0,s.jsx)(n.code,{children:"flags"}),"\u4e2d\u7684",(0,s.jsx)(n.code,{children:"Don't fragment"}),"\u4f4d\uff0c\u4e3a1\u65f6\u8868\u793a\u4e0d\u5141\u8bb8\u5206\u7247\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u5f71\u54cd\u3002\u5728GRE IP\u96a7\u9053\u53e0\u52a0\u7f51\u4e2d\uff0c\u62a5\u6587\u5c06\u5728IP\u5934\u90e8\u540e\u6dfb\u52a0\u4e0a24\u5b57\u8282GRE IP\u5934\u90e8\u3002\u4ee5\u9ed8\u8ba4IP MTU\u4e3a1500\u5b57\u8282\u4e3a\u4f8b\uff0c\u539f\u5148\u4e00\u4e2a1514\u5b57\u8282\u5927\u5c0f\u7684\u62a5\u6587\uff08IP\u5934\u90e8 + \u6570\u636e\u521a\u597d\u4e3aIP MTU 1500\u5b57\u8282\uff09\u5728\u516c\u7f51\u4e0a\u53ef\u4ee5\u6b63\u5e38\u4f20\u8f93\uff0c\u82e5\u6b64\u65f6\u5c06\u8def\u5f84\u5207\u6362\u5230GRE IP\u96a7\u9053\u53e0\u52a0\u7f51\uff0c\u5219\u62a5\u6587\u957f\u5ea6\u5c06\u53d8\u62101528\u5b57\u8282\uff08IP\u5934\u90e8 + \u6570\u636e = 1524\u5b57\u8282\uff09\uff0c\u5c06\u8d85\u8fc7\u9ed8\u8ba4IP MTU\u3002",(0,s.jsx)(n.br,{}),"\n","\u8be6\u89c1 H3C \u6587\u7ae0 ",(0,s.jsx)(n.a,{href:"http://www.h3c.com/cn/d_201411/921527_30005_0.htm",children:"\u770b\u62dbMTU!!!\u2014\u2014\u9ad8\u7aef\u8def\u7531\u5668GRE\u7ec4\u7f51\u4e2d\u9700\u8981\u6ce8\u610f\u7684\u95ee\u9898"}),"\u3002"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u5206\u7247\u53d1\u751f\u5728\u65c1\u6302\u8bbe\u5907\uff0c\u5219\u5c06\u5bfc\u81f4GRE IP\u62a5\u6587\u88ab\u5206\u7247\uff0c\u65e0\u6cd5\u5728\u96a7\u9053\u7ec8\u7ed3\u5904\u91cd\u7ec4\uff0c\u56e0\u4e3a\u7b2c\u4e8c\u4e2a\u5206\u7247\u4e0d\u5e26GRE\u5934\u90e8\u3002"}),"\n",(0,s.jsxs)(n.li,{children:["IP\u62a5\u6587\u4e0d\u5141\u8bb8\u5206\u7247","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5bf9\u4e8eTCP\u62a5\u6587","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5c06\u901a\u8fc7PMTU\u53d1\u73b0\u673a\u5236\uff0c\u8c03\u6574\u4e3b\u673aPMTU"}),"\n",(0,s.jsx)(n.li,{children:"\u901a\u8fc7\u5feb\u901f\u91cd\u4f20\u673a\u5236\uff0c\u8fc5\u901f\u6062\u590d"}),"\n",(0,s.jsx)(n.li,{children:"\u4e3b\u673a\u8c03\u6574TCP\u62a5\u6587\u5927\u5c0f\uff0c\u4ee5\u9002\u5e94PMTU"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5bf9\u4e8eUDP\u62a5\u6587","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5c06\u901a\u8fc7PMTU\u53d1\u73b0\u673a\u5236\uff0c\u8c03\u6574\u4e3b\u673aPMTU"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"\u4e22\u5f03\u8be5\u62a5\u6587"})}),"\n",(0,s.jsx)(n.li,{children:"\u540e\u7eed\u4f20\u8f93\u65f6\uff0c\u5bf9\u8d85\u8fc7PMTU\u7684\u62a5\u6587\uff0c\u5728\u4e3b\u673a\u5904\u4e3b\u52a8\u8fdb\u884c\u5206\u7247\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u82e5\u6709\u9700\u8981\uff0c\u8d85\u65f6\u91cd\u4f20\u3001\u8c03\u6574\u62a5\u6587\u5927\u5c0f\u7684\u673a\u5236\u7531UDP\u7684\u4e0a\u5c42\u534f\u8bae\u652f\u6301\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5bf9\u4e8e\u5176\u4ed6IP\u62a5\u6587\uff08\u4ee5ping\u62a5\u6587\u4e3a\u4f8b\uff09","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5c06\u901a\u8fc7PMTU\u53d1\u73b0\u673a\u5236\uff0c\u8c03\u6574\u4e3b\u673aPMTU"}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"\u4e22\u5f03\u8be5\u62a5\u6587"})}),"\n",(0,s.jsx)(n.li,{children:"\u540e\u7eed\u4f20\u8f93\u65f6\uff0c\u5728\u4e3b\u673a\u5904\u4e3b\u52a8\u5206\u7247\uff08\u4ee5Linux\u4e3a\u4f8b\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["IP\u62a5\u6587\u5141\u8bb8\u5206\u7247","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u4e1a\u52a1\u5f00\u59cb\u524d\uff0c\u4e3b\u673a\u5df2\u7ecf\u8c03\u6574PMTU\uff0c\u5219\u5206\u7247\u5728\u4e3b\u673a\u8fdb\u884c\uff0c\u4e1a\u52a1\u53ef\u6b63\u5e38\u8fd0\u884c\u3002"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5982\u679c\u4e3b\u673a\u672a\u8c03\u6574PMTU\uff0c\u5219\u5206\u7247\u5728\u65c1\u6302\u8bbe\u5907\u8fdb\u884c\uff0c\u5c06\u5bfc\u81f4\u4e1a\u52a1\u4e2d\u65ad"}),"\u3002\u6b64\u95ee\u9898\u5c06\u5f71\u54cd\u6574\u4e2a\u65b9\u6848\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u89c4\u907f\u624b\u6bb5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u89c4\u907f\u76ee\u6807\uff1a\u5c06\u5206\u7247\u7684\u884c\u4e3a\u8f6c\u79fb\u81f3\u4e3b\u673a\u4e0a\uff0c\u4e0d\u5141\u8bb8\u65c1\u6302\u8bbe\u5907\u4e0a\u8fdb\u884c\u4efb\u4f55\u5206\u7247\u884c\u4e3a\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u65b9\u6848\uff1a\u5bf9\u6240\u6709\u8d85IP MTU\u9001\u65c1\u6302\u8bbe\u5907CPU\u7684\u62a5\u6587\uff0c\u7686\u8fd4\u56deICMP type 3 code 4\u3002\u9700\u9a8c\u8bc1\u6b64\u89c4\u907f\u5bf9\u5141\u8bb8\u5206\u7247IP\u62a5\u6587\u7684\u5f71\u54cd\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u98ce\u9669\uff1a\u5bf9\u63a7\u5236\u9762\u548c\u7ba1\u7406\u9762\u7684\u5f71\u54cd\u5f85\u8bc4\u4f30\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5206\u6790"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Linux"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["PMTU\u53d1\u73b0\u673a\u5236\u9ed8\u8ba4\u4e3a",(0,s.jsx)(n.code,{children:"IP_PMTUDISC_WANT"}),"\uff0c\u5982\u679c\u62a5\u6587\u4e0d\u8d85\u8fc7PMTU\uff0c\u9ed8\u8ba4\u5f00\u542fPMTU\u53d1\u73b0\u673a\u5236\uff0c\u5982\u679c\u62a5\u6587\u8d85\u8fc7PMTU\uff0c\u5219\u4e3b\u52a8\u5728\u7ec8\u7aef\u8fdb\u884c\u5206\u7247\u5904\u7406\u3002\uff08",(0,s.jsx)(n.code,{children:"will fragment a datagram if needed according to the path MTU, or will set the don\u2019t-fragment flag otherwise."}),"\uff09"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Windows"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"TCP\u62a5\u6587\uff0c\u9ed8\u8ba4\u4e0d\u5141\u8bb8\u5206\u7247"}),"\n",(0,s.jsx)(n.li,{children:"\u5176\u4ed6\u62a5\u6587\uff0c\u9ed8\u8ba4\u5141\u8bb8\u5206\u7247"}),"\n",(0,s.jsx)(n.li,{children:"\u5bf9\u5141\u8bb8\u5206\u7247\u7684\u62a5\u6587\uff0c\u5982\u679c\u62a5\u6587\u957f\u5ea6\u8d85\u8fc7PMTU\uff0c\u5219\u4e3b\u52a8\u5728\u7ec8\u7aef\u5904\u8fdb\u884c\u5206\u7247"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u4e0d\u80fd\u5047\u5b9a\u7f51\u7edc\u4e0a\u7684\u6240\u6709\u7684TCP\u62a5\u6587\u90fd\u4e0d\u5141\u8bb8\u5206\u7247\uff08\u5982\u65b0\u6d6a\u7f51\uff0c\u9ed8\u8ba4TCP\u62a5\u6587\u5141\u8bb8\u5206\u7247\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"\u5b9e\u9a8c\u7ed3\u679c",children:[(0,s.jsx)(n.a,{href:"http://sunyongfeng.com/201712/networks/path_mtu#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C",title:"\u5b9e\u9a8c\u7ed3\u679c"}),"\u5b9e\u9a8c\u7ed3\u679c"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7cfb\u7edf"}),(0,s.jsx)(n.th,{children:"\u534f\u8bae"}),(0,s.jsx)(n.th,{children:"\u9ed8\u8ba4\u662f\u5426\u52a0DF"}),(0,s.jsx)(n.th,{children:"\u9ed8\u8ba4\u5bf9\u8d85PMTU\u7684\u5904\u7406"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Linux"}),(0,s.jsx)(n.td,{children:"TCP"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsx)(n.td,{children:"\u8c03\u6574TCP\u6bb5\u957f\u5ea6"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Linux"}),(0,s.jsx)(n.td,{children:"UDP"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsx)(n.td,{children:"\u4e0d\u505a\u5904\u7406\uff0c\u7528\u6237\u7a0b\u5e8f\u5904\u7406"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Linux"}),(0,s.jsx)(n.td,{children:"RTSP\uff08UDP\uff09"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsx)(n.td,{children:"\u4e22\u6389ICMP packet too big\u7684\u90a3\u51e0\u4e2a\u5305\uff0c\u540e\u7eed\u5206\u7247"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Linux"}),(0,s.jsx)(n.td,{children:"TFTP\uff08UDP\uff09"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsx)(n.td,{children:"\u7b49\u4e0d\u5230ACK\uff0ctimeout\u9000\u51fa"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Linux"}),(0,s.jsx)(n.td,{children:"ping"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsxs)(n.td,{children:["\u4e0d\u91cd\u4f20\u62a5\u6587\uff0c\u4e3b\u673a\u63d0\u793a",(0,s.jsx)(n.code,{children:"From 3.3.3.3 icmp_seq=93 Frag needed and DF set (mtu = 0)"}),"\uff0c\u540e\u5f00\u59cb\u5728\u4e3b\u673a\u5bf9ping\u62a5\u6587\u8fdb\u884c\u5206\u7247\uff0c\u5206\u7247\u540e\u7684\u62a5\u6587DF=0\uff1b\u5982\u679c\u5f3a\u5236\u8bbe\u7f6eDF\uff1a",(0,s.jsx)(n.code,{children:"-M = do"}),"\uff0c\u5219\u63d0\u793a",(0,s.jsx)(n.code,{children:"ping: local error: Message too long, mtu=552"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Linux"}),(0,s.jsx)(n.td,{children:"TCP(\u81ea\u5df1\u6784\u9020)"}),(0,s.jsx)(n.td,{children:"\u5426"}),(0,s.jsx)(n.td,{children:"\u9ed8\u8ba4\u5728\u4ea4\u6362\u673a\u4e2d\u9001CPU\u5206\u7247\uff0c\u5982\u679c\u6b64\u65f6\u6709\u4e00\u4e2aICMP packet too big\u8fd4\u56de\u81f3\u4e3b\u673a\uff08\u6bd4\u5982\u7531ping\u89e6\u53d1\uff09\uff0c\u5219\u4f1a\u8f6c\u5728\u4e3b\u673a\u5206\u7247"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Windows"}),(0,s.jsx)(n.td,{children:"TCP"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsx)(n.td,{children:"\u8c03\u6574TCP\u6bb5\u957f\u5ea6"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Windows"}),(0,s.jsx)(n.td,{children:"UDP"}),(0,s.jsx)(n.td,{children:"\u5426"}),(0,s.jsx)(n.td,{children:"\u88ab\u8def\u7531\u5668\u5206\u7247\u6216\u88ab\u4e3b\u673a\u5206\u7247"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Windows"}),(0,s.jsx)(n.td,{children:"ping"}),(0,s.jsx)(n.td,{children:"\u5426"}),(0,s.jsxs)(n.td,{children:["\u65e0\u5904\u7406\uff0c\u5728\u4ea4\u6362\u673a\u4e2d\u5206\u7247\uff0c\u5982\u679c\u6b64\u65f6\u6709ICMP packet too big\uff08\u5982TCP\u89e6\u53d1\uff09\uff0c\u5219\u4f1a\u4e3b\u52a8\u5728\u7ec8\u7aef\u5206\u7247\u3002\u5982\u679c\u5f3a\u5236\u8bbe\u7f6eDF\uff1a",(0,s.jsx)(n.code,{children:"-f"}),"\uff0c\u5219\u63d0\u793a",(0,s.jsx)(n.code,{children:"Packet needs to be fragmented but DF set."})]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u4e0a\u5b9e\u9a8c\u7ed3\u679c\uff0c\u5f97\u51fa\u4ee5\u4e0b\u7ed3\u8bba\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Linux\u4e0b\uff0cTCP/UDP\u62a5\u6587\u9ed8\u8ba4\u90fd\u7f6e\u4e0aDF\u4f4d\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"Windows\u4e0b\uff0cTCP\u62a5\u6587\u9ed8\u8ba4\u7f6e\u4e0aDF\u4f4d\uff0cUDP\u62a5\u6587\u9ed8\u8ba4\u4e0d\u7f6eDF\u4f4d\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"Linux\u4e0b\uff0cUDP\u7684\u5bf9ICMP packet too big\u62a5\u6587\u7684\u5904\u7406\u53d6\u51b3\u4e8e\u7528\u6237\uff0cLinux\u5185\u6838\u4e0d\u8fdb\u884c\u5904\u7406"}),"\n",(0,s.jsx)(n.li,{children:"\u4e0d\u7ba1Linux\u8fd8\u662fWindows\u4e0b\uff0c\u5982\u679c\u8981\u53d1\u51fa\u7684UDP\u62a5\u6587\u5927\u4e8ePMTU\uff0c\u5219\u4f1a\u4e3b\u52a8\u5728HOST\u7aef\u8fdb\u884c\u5206\u7247\u3002"}),"\n",(0,s.jsx)(n.li,{children:"PMTU\u4ee5\u8def\u7531\uff08SIP + DIP + TOS\uff09\u4e3a\u5355\u4f4d\u5f71\u54cd\u7cfb\u7edf\uff0cUDP\u867d\u7136\u6ca1\u6709\u4e3b\u52a8\u8c03\u6574\u6570\u636e\u62a5\u7684\u5927\u5c0f\uff0c\u4f46\u662f\u56e0UDP\u62a5\u6587\u8fd4\u56de\u7684ICMP packet too big\u62a5\u6587\u4f1a\u5f71\u54cd\u5bf9\u5e94\u8def\u7531\u7684PMTU\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"\u6807\u51c6",children:[(0,s.jsx)(n.a,{href:"http://sunyongfeng.com/201712/networks/path_mtu#%E6%A0%87%E5%87%86",title:"\u6807\u51c6"}),"\u6807\u51c6"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://tools.ietf.org/html/rfc1191",children:"RFC 1191 Path MTU Discovery"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"http://tools.ietf.org/html/rfc4821",children:"RFC 4821 Packetization Layer Path MTU Discovery"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u6309RFC 1191\u7684\u5b9a\u4e49\uff0cPMTU\u53d1\u73b0\u673a\u5236\u4e3aPacketization Protocol\u670d\u52a1\uff0cTCP\u662f\u8fd9\u79cd\u53ef\u8c03\u8282\u62a5\u6587\u5927\u5c0f\u7684\u534f\u8bae\uff0c\u56e0\u6b64\u53ef\u76f4\u63a5\u4f7f\u7528\uff1b\u800cUDP\u534f\u8bae\u9700\u8981\u9760\u4e0a\u5c42\u534f\u8bae\u6765\u5b9e\u73b0\u62a5\u6587\u5927\u5c0f\u8c03\u6574\u3002"}),"\n",(0,s.jsx)(n.p,{children:"RFC 1191 \u7b2c6\u7ae0\u201cHost Implementation\u201d\u8bb2\u8ff0PMTU Discovery\u5bf9\u7ec8\u7aef\u7684\u5efa\u8bae\uff08\u4ec5\u4ec5\u662fsuggestion\uff0c\u4e0d\u662fspecification\uff09\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5728\u54ea\u4e2a\u6216\u54ea\u4e9b\u5c42\u6b21\u5b9e\u73b0PMTU\u53d1\u73b0\u673a\u5236\uff1b","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7531IP\u4ee5\u4e0a\u5c42\u6b21\u51b3\u5b9a\u62a5\u6587\u8981\u53d1\u591a\u5927\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"Pakcetization Protocol\u5fc5\u987b\u80fd\u5f71\u54cdPMTU\u53d8\u5316\uff0c\u542b\u66f4\u65b0\u62a5\u6587\u5927\u5c0f\u3001\u63a7\u5236DF\u4f4d\u3002\uff08IP\u5c42\u4e0d\u63a7\u5236DF\u4f4d\uff09"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["PMTU\u4fe1\u606f\u7f13\u5b58\u5728\u54ea\uff1b","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u628aPMTU\u505a\u4e3a\u8def\u7531\u8868\u9879\u7684\u4e00\u4e2a\u5c5e\u6027\u6210\u5458\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u5bf9\u4e8eUDP\u8fd9\u79cd\u65e0\u8fde\u63a5\u7684\u62a5\u6587\uff0c\u82e5\u8fd4\u56deICMP packet too big\uff0c\u9700\u8981\u5176\u4e0a\u5c42\u534f\u8bae\u901a\u8fc7\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u91cd\u4f20\u88abdropped\u7684\u62a5\u6587\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u65e7PMTU\u4fe1\u606f\u5982\u4f55\u88ab\u8001\u5316\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"PMTU\u5982\u4f55\u4e0a\u6da8\uff1b"}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"linux\u7684\u5904\u7406",children:[(0,s.jsx)(n.a,{href:"http://sunyongfeng.com/201712/networks/path_mtu#Linux%E7%9A%84%E5%A4%84%E7%90%86",title:"Linux\u7684\u5904\u7406"}),"Linux\u7684\u5904\u7406"]}),"\n",(0,s.jsxs)(n.p,{children:["Linux Kernel\u7684\u5b9e\u73b0\u53c2\u8003\uff1a",(0,s.jsx)(n.a,{href:"http://linux.die.net/man/7/ip",children:"man 7 ip"})," \u4e2d\u5173\u4e8e",(0,s.jsx)(n.code,{children:"IP_MTU_DISCOVER"}),"\u7684\u63cf\u8ff0\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["IP_MTU_DISCOVER (since Linux 2.2)",(0,s.jsx)(n.br,{}),"\n","Set or receive the Path MTU Discovery setting for a socket. ",(0,s.jsx)(n.strong,{children:"When enabled, Linux will perform Path MTU Discovery as defined in RFC 1191 on SOCK_STREAM sockets. For non-SOCK_STREAM sockets, IP_PMTUDISC_DO forces the don\u2019t-fragment flag to be set on all outgoing packets. It is the user\u2019s responsibility to packetize the data in MTU-sized chunks and to do the retransmits if necessary. The kernel will reject (with EMSGSIZE) datagrams that are bigger than the known path MTU. IP_PMTUDISC_WANT will fragment a datagram if needed according to the path MTU, or will set the don\u2019t-fragment flag otherwise."}),(0,s.jsx)(n.br,{}),"\n","The system-wide default can be toggled between IP_PMTUDISC_WANT and IP_PMTUDISC_DONT by writing (respectively, zero and nonzero values) to the /proc/sys/net/ipv4/ip_no_pmtu_disc file."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"When PMTU discovery is enabled, the kernel automatically keeps track of the path MTU per destination host."})," When it is connected to a specific peer with connect(2), the currently known path MTU can be retrieved conveniently using the IP_MTU socket option (e.g., after an EMSGSIZE error occurred). The path MTU may change over time. For connectionless sockets with many destinations, the new MTU for a given destination can also be accessed using the error queue (see IP_RECVERR). A new error will be queued for every incoming MTU update."]}),"\n",(0,s.jsx)(n.p,{children:"While MTU discovery is in progress, initial packets from datagram sockets may be dropped. Applications using UDP should be aware of this and not take it into account for their packet retransmit strategy."}),"\n",(0,s.jsx)(n.p,{children:"To bootstrap the path MTU discovery process on unconnected sockets, it is possible to start with a big datagram size (up to 64K-headers bytes long) and let it shrink by updates of the path MTU."}),"\n",(0,s.jsx)(n.p,{children:"To get an initial estimate of the path MTU, connect a datagram socket to the destination address using connect(2) and retrieve the MTU by calling getsockopt(2) with the IP_MTU option."}),"\n",(0,s.jsx)(n.p,{children:"It is possible to implement RFC 4821 MTU probing with SOCK_DGRAM or SOCK_RAW sockets by setting a value of IP_PMTUDISC_PROBE (available since Linux 2.6.22). This is also particularly useful for diagnostic tools such as tracepath(8) that wish to deliberately send probe packets larger than the observed Path MTU."})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);